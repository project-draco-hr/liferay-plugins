{
  Message message=new MimeMessage(getSession());
  Folder draftsFolder=getDraftsFolder();
  message.setFrom(new InternetAddress(from));
  if (Validator.isNotNull(to)) {
    message.setRecipients(Message.RecipientType.TO,InternetAddress.parse(to,false));
  }
  if (Validator.isNotNull(cc)) {
    message.setRecipients(Message.RecipientType.CC,InternetAddress.parse(cc,false));
  }
  if (Validator.isNotNull(bcc)) {
    message.setRecipients(Message.RecipientType.BCC,InternetAddress.parse(bcc,false));
  }
  message.setSentDate(new Date());
  message.setSubject(subject);
  MimeMultipart multipart=new MimeMultipart();
  BodyPart messageBodyPart=new MimeBodyPart();
  messageBodyPart.setContent(body,ContentTypes.TEXT_HTML);
  multipart.addBodyPart(messageBodyPart);
  if (Validator.isNotNull(files)) {
    for (    File file : files) {
      String fileName=file.getName();
      DataSource dataSource=new FileDataSource(file);
      BodyPart messageAttachmentPart=new MimeBodyPart();
      messageAttachmentPart.setDataHandler(new DataHandler(dataSource));
      messageAttachmentPart.setFileName(fileName);
      multipart.addBodyPart(messageAttachmentPart);
    }
  }
  message.setContent(multipart);
  long newDraftMessageUid=((IMAPFolder)draftsFolder).getUIDNext();
  draftsFolder.appendMessages(new Message[]{message});
  draftsFolder.close(true);
  storeMessageToDisk(getMessageByUid(draftsFolder,newDraftMessageUid));
  if (Validator.isNotNull(oldDraftMessageUid)) {
    deleteMessage(draftsFolder,GetterUtil.getLong(oldDraftMessageUid),true);
  }
  return newDraftMessageUid;
}
