{
  MailAccount fromMailAccount=new MailAccount(_user,fromAccountId);
  msg.setFrom(new InternetAddress(fromMailAccount.getEmailAddress()));
  if (!to.trim().equals(StringPool.BLANK)) {
    msg.setRecipients(Message.RecipientType.TO,InternetAddress.parse(to,false));
  }
  if (!cc.trim().equals(StringPool.BLANK)) {
    msg.setRecipients(Message.RecipientType.CC,InternetAddress.parse(cc,false));
  }
  if (!bcc.trim().equals(StringPool.BLANK)) {
    msg.setRecipients(Message.RecipientType.BCC,InternetAddress.parse(bcc,false));
  }
  msg.setSubject(subject);
  msg.setSentDate(new Date());
  if (mp != null) {
    msg.setContent(mp);
  }
 else {
    msg.setText(content);
  }
  msg.saveChanges();
  Transport t=getOutgoingSession(fromMailAccount).getTransport("smtp");
  try {
    t.connect(fromMailAccount.getUsername(),fromMailAccount.getPassword());
    t.sendMessage(msg,msg.getAllRecipients());
  }
  finally {
    t.close();
  }
}
