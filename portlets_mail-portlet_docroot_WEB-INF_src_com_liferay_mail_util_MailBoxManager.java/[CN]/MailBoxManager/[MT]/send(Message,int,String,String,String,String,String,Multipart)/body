{
  MailAccount fromMailAccount=new MailAccount(_user,fromAccountId);
  message.setFrom(new InternetAddress(fromMailAccount.getEmailAddress()));
  if (!to.trim().equals(StringPool.BLANK)) {
    message.setRecipients(Message.RecipientType.TO,InternetAddress.parse(to,false));
  }
  if (!cc.trim().equals(StringPool.BLANK)) {
    message.setRecipients(Message.RecipientType.CC,InternetAddress.parse(cc,false));
  }
  if (!bcc.trim().equals(StringPool.BLANK)) {
    message.setRecipients(Message.RecipientType.BCC,InternetAddress.parse(bcc,false));
  }
  message.setSubject(subject);
  message.setSentDate(new Date());
  if (multipart != null) {
    message.setContent(multipart);
  }
 else {
    message.setText(content);
  }
  message.saveChanges();
  Transport t=getOutgoingSession(fromMailAccount).getTransport("smtp");
  try {
    t.connect(fromMailAccount.getUsername(),fromMailAccount.getPassword());
    t.sendMessage(message,message.getAllRecipients());
  }
  finally {
    t.close();
  }
}
