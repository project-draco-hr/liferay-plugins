{
  MailAccount fromMailAccount=new MailAccount(_user,fromAccountId);
  message.setSentDate(new Date());
  message.setFrom(new InternetAddress(fromMailAccount.getEmailAddress()));
  if (Validator.isNotNull(to)) {
    message.setRecipients(Message.RecipientType.TO,InternetAddress.parse(to,false));
  }
  if (Validator.isNotNull(cc)) {
    message.setRecipients(Message.RecipientType.CC,InternetAddress.parse(cc,false));
  }
  if (Validator.isNotNull(bcc)) {
    message.setRecipients(Message.RecipientType.BCC,InternetAddress.parse(bcc,false));
  }
  message.setSubject(subject);
  if (multipart != null) {
    message.setContent(multipart);
  }
 else {
    message.setText(content);
  }
  message.saveChanges();
  Session session=getOutgoingSession(fromMailAccount);
  Transport transport=session.getTransport("smtp");
  try {
    transport.connect(fromMailAccount.getUsername(),fromMailAccount.getPassword());
    transport.sendMessage(message,message.getAllRecipients());
  }
  finally {
    transport.close();
  }
}
