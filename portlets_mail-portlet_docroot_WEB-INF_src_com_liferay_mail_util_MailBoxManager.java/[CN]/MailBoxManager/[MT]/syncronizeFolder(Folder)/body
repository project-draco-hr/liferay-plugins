{
  JSONObject jsonObj=MailDiskManager.getJSONFolder(_user,_mailAccount.getEmailAddress(),folder.getFullName());
  long latestMessageUid=MailDiskManager.getNewestStoredMessageUID(_user,_mailAccount.getEmailAddress(),folder.getFullName());
  boolean initialized=false;
  if ((jsonObj != null) && jsonObj.optBoolean("initialized")) {
    initialized=true;
  }
  folder=openFolder(folder);
  int messageCount=folder.getMessageCount();
  Message[] messages=null;
  if (!initialized || (latestMessageUid == -1)) {
    if (messageCount < _messagesToPrefetch) {
      messages=folder.getMessages(1,messageCount);
    }
 else {
      messages=folder.getMessages((messageCount - _messagesToPrefetch + 1),messageCount);
    }
    storeMessagesToDisk(folder,messages);
    storeFolderToDisk(folder,true,new Date());
  }
 else {
    Message message=((IMAPFolder)folder).getMessageByUID(latestMessageUid);
    int messageNumber=message.getMessageNumber();
    messages=folder.getMessages(messageNumber,messageCount);
    storeMessagesToDisk(folder,messages);
    storeFolderToDisk(folder,true,new Date());
  }
}
