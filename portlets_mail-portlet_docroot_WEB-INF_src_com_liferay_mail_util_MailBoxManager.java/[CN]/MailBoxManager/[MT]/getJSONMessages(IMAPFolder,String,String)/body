{
  int[] messageNumbersArray=GetterUtil.getIntegerValues(messageNumbersToGet.split("\\s*,\\s*"));
  int[] messageUidsArray=GetterUtil.getIntegerValues(messageUidsToExclude.split("\\s*,\\s*"));
  JSONObject jsonObj=new JSONObject();
  JSONArray jsonArray=new JSONArray();
  JSONUtil.put(jsonObj,"messages",jsonArray);
  for (  int messageNumber : messageNumbersArray) {
    Message message=folder.getMessage(messageNumber);
    long messageUid=folder.getUID(message);
    for (    int curMessageUid : messageUidsArray) {
      if (curMessageUid == messageUid) {
        try {
          jsonArray.put((int)messageUid,StringPool.BLANK);
        }
 catch (        JSONException jsone) {
          if (_log.isWarnEnabled()) {
            _log.warn(jsone,jsone);
          }
        }
        continue;
      }
    }
    try {
      jsonArray.put((int)messageUid,getJSONMessage(folder,message,true));
    }
 catch (    JSONException jsone) {
      if (_log.isWarnEnabled()) {
        _log.warn(jsone,jsone);
      }
    }
  }
  return jsonObj.toString();
}
