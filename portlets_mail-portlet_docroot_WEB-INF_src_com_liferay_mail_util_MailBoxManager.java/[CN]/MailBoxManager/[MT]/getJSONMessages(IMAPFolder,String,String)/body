{
  int[] messageNumbersArray=GetterUtil.getIntegerValues(messageNumbersToInclude.split("\\s*,\\s*"));
  int[] messageUidsArray=GetterUtil.getIntegerValues(messageUidsToExclude.split("\\s*,\\s*"));
  JSONObject jsonObj=new JSONObject();
  JSONArray jsonArray=new JSONArray();
  JSONUtil.put(jsonObj,"messages",jsonArray);
  for (  int messageNumber : messageNumbersArray) {
    Message message=folder.getMessage(messageNumber);
    long messageUid=folder.getUID(message);
    try {
      for (      int curMessageUid : messageUidsArray) {
        if (curMessageUid == messageUid) {
          jsonArray.put((int)messageUid,StringPool.BLANK);
          continue;
        }
      }
      jsonArray.put((int)messageUid,getJSONMessage(folder,message,true));
    }
 catch (    JSONException jsone) {
      if (_log.isWarnEnabled()) {
        _log.warn(jsone,jsone);
      }
    }
  }
  return jsonObj.toString();
}
