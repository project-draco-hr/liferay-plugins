{
  try {
    String contentType=messagePart.getContentType().toLowerCase();
    if (messagePart.getContent() instanceof Multipart) {
      Multipart multipart=(Multipart)messagePart.getContent();
      for (int i=0; i < multipart.getCount(); i++) {
        Part curPart=multipart.getBodyPart(i);
        if (getBodyMulitipart(contentType,curPart,contentPath + StringPool.PERIOD + i,sb,attachments)) {
          break;
        }
      }
    }
 else     if (Validator.isNull(messagePart.getFileName())) {
      if (contentType.startsWith(ContentTypes.TEXT_PLAIN)) {
        if (sb.length() > 0) {
          sb.append(StringPool.NEW_LINE + StringPool.NEW_LINE);
        }
        String messageText=messagePart.getContent().toString();
        sb.append(messageText.replaceAll("\r\n","<br />"));
      }
 else       if (contentType.startsWith(ContentTypes.TEXT_HTML)) {
        if (sb.length() > 0) {
          sb.append("<hr />");
        }
        try {
          sb.append(stripUnsafeHtmlAndCss(messagePart.getContent().toString()));
        }
 catch (        IOException ioe) {
        }
      }
 else       if (contentType.startsWith(ContentTypes.MESSAGE_RFC822)) {
      }
    }
 else {
      Object[] attachment=new Object[]{contentPath + StringPool.PERIOD + -1,messagePart.getFileName()};
      attachments.add(attachment);
    }
  }
 catch (  Exception e) {
    sb.append("Error retrieving message content");
  }
}
