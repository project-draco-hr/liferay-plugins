{
  if (!isAccountExists()) {
    return;
  }
  JSONObject jsonObj=MailDiskManager.getJSONFolder(_user,_mailAccount.getEmailAddress(),folder.getFullName());
  boolean initialized=false;
  if ((jsonObj != null) && jsonObj.getBoolean("initialized")) {
    initialized=true;
  }
  folder=openFolder(folder);
  if (Validator.isNull(folder)) {
    return;
  }
  int messageCount=folder.getMessageCount();
  Message[] messages=null;
  if (!initialized) {
    if (messageCount < _MESSAGES_TO_PREFETCH) {
      messages=folder.getMessages(1,messageCount);
    }
 else {
      messages=folder.getMessages((messageCount - _MESSAGES_TO_PREFETCH + 1),messageCount);
    }
    if (Validator.isNotNull(messages)) {
      storeMessages(messages);
    }
    storeFolder(folder);
  }
 else {
    Message newestStoredMessage=getNewestOrOldestStoredMessage(folder,true);
    if (Validator.isNotNull(newestStoredMessage)) {
      int messageNumber=newestStoredMessage.getMessageNumber();
      if (messageNumber != messageCount) {
        messages=folder.getMessages(messageNumber,messageCount);
        storeMessages(messages);
        storeFolder(folder);
      }
    }
    Message oldestStoredMessage=getNewestOrOldestStoredMessage(folder,false);
    if (Validator.isNotNull(oldestStoredMessage)) {
      int messageNumber=oldestStoredMessage.getMessageNumber();
      if (messageCount != 1) {
        if ((messageNumber - _MESSAGES_TO_PREFETCH) < 0) {
          messages=folder.getMessages(1,messageNumber);
        }
 else {
          messages=folder.getMessages((messageNumber - _MESSAGES_TO_PREFETCH),messageNumber);
        }
        storeMessages(messages);
        storeFolder(folder);
      }
    }
  }
}
