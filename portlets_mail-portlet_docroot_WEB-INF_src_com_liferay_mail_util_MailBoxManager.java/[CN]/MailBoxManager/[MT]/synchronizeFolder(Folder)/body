{
  JSONObject jsonObj=MailDiskManager.getJSONFolder(_user,_mailAccount.getEmailAddress(),folder.getFullName());
  boolean initialized=false;
  if ((jsonObj != null) && jsonObj.getBoolean("initialized")) {
    initialized=true;
  }
  folder=openFolder(folder);
  if (Validator.isNull(folder)) {
    return;
  }
  int messageCount=folder.getMessageCount();
  Message[] messages=null;
  if (!initialized) {
    if (messageCount < _messagesToPrefetch) {
      messages=folder.getMessages(1,messageCount);
    }
 else {
      messages=folder.getMessages((messageCount - _messagesToPrefetch + 1),messageCount);
    }
    if (Validator.isNotNull(messages)) {
      storeMessagesToDisk(messages);
    }
    storeFolderToDisk(folder,true,new Date());
  }
 else {
    Message newestStoredMessage=getNewestOrOldestStoredMessage(folder,true);
    if (Validator.isNotNull(newestStoredMessage)) {
      int messageNumber=newestStoredMessage.getMessageNumber();
      if (messageNumber != messageCount) {
        messages=folder.getMessages(messageNumber,messageCount);
        storeMessagesToDisk(messages);
        storeFolderToDisk(folder,true,new Date());
      }
    }
    Message oldestStoredMessage=getNewestOrOldestStoredMessage(folder,false);
    if (Validator.isNotNull(oldestStoredMessage)) {
      int messageNumber=oldestStoredMessage.getMessageNumber();
      if (messageCount != 1) {
        if ((messageNumber - _messagesToPrefetch) < 0) {
          messages=folder.getMessages(1,messageNumber);
        }
 else {
          messages=folder.getMessages((messageNumber - _messagesToPrefetch),messageNumber);
        }
      }
      storeMessagesToDisk(messages);
      storeFolderToDisk(folder,true,new Date());
    }
  }
}
