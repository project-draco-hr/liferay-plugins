{
  JSONObject jsonObj=MailDiskManager.getJSONFolder(_user,_mailAccount.getEmailAddress(),folder.getFullName());
  Message latestMessage=MailDiskManager.getNewestStoredMessage(_user,_mailAccount.getEmailAddress(),folder.getFullName());
  boolean initialized=false;
  if ((jsonObj != null) && jsonObj.getBoolean("initialized")) {
    initialized=true;
  }
  folder=openFolder(folder);
  if (Validator.isNull(folder)) {
    return;
  }
  int messageCount=folder.getMessageCount();
  Message[] messages=null;
  if (!initialized || (Validator.isNull(latestMessage))) {
    if (messageCount < _messagesToPrefetch) {
      messages=folder.getMessages(1,messageCount);
    }
 else {
      messages=folder.getMessages((messageCount - _messagesToPrefetch + 1),messageCount);
    }
    storeMessagesToDisk(messages);
    storeFolderToDisk(folder,true,new Date());
  }
 else {
    int messageNumber=latestMessage.getMessageNumber();
    messages=folder.getMessages(messageNumber,messageCount);
    storeMessagesToDisk(messages);
    storeFolderToDisk(folder,true,new Date());
  }
}
