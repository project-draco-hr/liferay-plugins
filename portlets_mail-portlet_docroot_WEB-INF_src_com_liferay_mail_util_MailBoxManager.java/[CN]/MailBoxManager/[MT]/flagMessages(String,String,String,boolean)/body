{
  if (!isAccountExists()) {
    return null;
  }
  long[] messageUidsArray=GetterUtil.getLongValues(messageUids.split("\\s*,\\s*"));
  if (Validator.isNull(messageUidsArray)) {
    return _failureJSON;
  }
  try {
    Folder folder=getFolder(folderName);
    for (    long messageUid : messageUidsArray) {
      try {
        if (!isAccountExists()) {
          return null;
        }
        Message message=getMessageByUid(folder,messageUid);
        if (flag.equals("answered")) {
          message.setFlag(Flags.Flag.ANSWERED,value);
        }
 else         if (flag.equals("flagged")) {
          message.setFlag(Flags.Flag.FLAGGED,value);
        }
 else         if (flag.equals("seen")) {
          message.setFlag(Flags.Flag.SEEN,value);
        }
        updateJSONMessageFlag(_user,_mailAccount,folderName,messageUid,flag,value);
      }
 catch (      MessagingException me) {
        _log.error(me,me);
      }
    }
    folder.close(true);
    return _successJSON;
  }
 catch (  MessagingException me) {
    _log.error(me,me);
    return _failureJSON;
  }
}
