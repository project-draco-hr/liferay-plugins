{
  long companyId=PortalUtil.getCompanyId(actionRequest);
  String[] contextNames=StringUtil.split(ParamUtil.getString(actionRequest,"contextNames"));
  boolean active=ParamUtil.getBoolean(actionRequest,"active");
  for (  String contextName : contextNames) {
    ServletContext servletContext=ServletContextPool.get(contextName);
    List<LayoutTemplate> layoutTemplates=(List<LayoutTemplate>)servletContext.getAttribute("PLUGIN_LAYOUT_TEMPLATES");
    if (layoutTemplates != null) {
      for (      LayoutTemplate layoutTemplate : layoutTemplates) {
        PluginSetting pluginSetting=PluginSettingLocalServiceUtil.getPluginSetting(companyId,layoutTemplate.getLayoutTemplateId(),Plugin.TYPE_LAYOUT_TEMPLATE);
        PluginSettingServiceUtil.updatePluginSetting(companyId,layoutTemplate.getLayoutTemplateId(),Plugin.TYPE_LAYOUT_TEMPLATE,pluginSetting.getRoles(),active);
      }
    }
    List<Portlet> portlets=(List<Portlet>)servletContext.getAttribute("PLUGIN_PORTLETS");
    if (portlets != null) {
      for (      Portlet portlet : portlets) {
        PortletServiceUtil.updatePortlet(companyId,portlet.getPortletId(),StringPool.BLANK,active);
      }
    }
    List<Theme> themes=(List<Theme>)servletContext.getAttribute("PLUGIN_THEMES");
    if (themes != null) {
      for (      Theme theme : themes) {
        PluginSetting pluginSetting=PluginSettingLocalServiceUtil.getPluginSetting(companyId,theme.getThemeId(),Plugin.TYPE_THEME);
        PluginSettingServiceUtil.updatePluginSetting(companyId,theme.getThemeId(),Plugin.TYPE_THEME,pluginSetting.getRoles(),active);
      }
    }
  }
}
