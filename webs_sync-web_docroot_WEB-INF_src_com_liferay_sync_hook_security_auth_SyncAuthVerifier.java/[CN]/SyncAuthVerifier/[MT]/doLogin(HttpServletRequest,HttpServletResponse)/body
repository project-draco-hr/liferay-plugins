{
  String token=request.getHeader(_TOKEN_HEADER);
  if (Validator.isNotNull(token)) {
    String userId=getUserId(token);
    if (userId != null) {
      return new String[]{userId,null};
    }
  }
  Thread currentThread=Thread.currentThread();
  ClassLoader contextClassLoader=currentThread.getContextClassLoader();
  ClassLoader portalClassLoader=PortalClassLoaderUtil.getClassLoader();
  try {
    currentThread.setContextClassLoader(portalClassLoader);
    for (    String autoLoginClassName : _autoLoginClassNames) {
      Class<?> clazz=portalClassLoader.loadClass(autoLoginClassName);
      Object object=clazz.newInstance();
      Method method=ReflectionUtil.getDeclaredMethod(clazz,"doLogin",HttpServletRequest.class,HttpServletResponse.class);
      String[] credentials=(String[])method.invoke(object,request,response);
      if (credentials != null) {
        token=createToken(GetterUtil.getLong(credentials[0]));
        if (token != null) {
          response.addHeader(_TOKEN_HEADER,token);
        }
        return credentials;
      }
    }
  }
  finally {
    currentThread.setContextClassLoader(contextClassLoader);
  }
  return null;
}
