{
  long userId=portletDataContext.getUserId(calendarResource.getUserUuid());
  StagedModelDataHandlerUtil.importReferenceStagedModels(portletDataContext,calendarResource,Calendar.class);
  ServiceContext serviceContext=portletDataContext.createServiceContext(calendarResource);
  long classPK=getClassPK(portletDataContext,calendarResource,userId);
  Group sourceGroup=GroupLocalServiceUtil.getGroup(portletDataContext.getSourceGroupId());
  Group newGroup=GroupLocalServiceUtil.getGroup(portletDataContext.getScopeGroupId());
  String sourceCalendarResourceName=calendarResource.getName(LocaleUtil.getDefault());
  Map<Locale,String> calendarResourceNameMap=calendarResource.getNameMap();
  CalendarResource importedCalendarResource=null;
  if (sourceCalendarResourceName.equals(sourceGroup.getName())) {
    calendarResourceNameMap=new HashMap<Locale,String>();
    calendarResourceNameMap.put(LocaleUtil.getDefault(),newGroup.getName());
  }
  if (portletDataContext.isDataStrategyMirror()) {
    CalendarResource existingCalendarResource=CalendarResourceLocalServiceUtil.fetchCalendarResourceByUuidAndGroupId(calendarResource.getUuid(),portletDataContext.getScopeGroupId());
    if (existingCalendarResource == null) {
      existingCalendarResource=CalendarResourceLocalServiceUtil.fetchCalendarResource(calendarResource.getClassNameId(),classPK);
    }
    if (existingCalendarResource == null) {
      serviceContext.setUuid(calendarResource.getUuid());
      importedCalendarResource=CalendarResourceLocalServiceUtil.addCalendarResource(userId,portletDataContext.getScopeGroupId(),calendarResource.getClassNameId(),classPK,calendarResource.getClassUuid(),calendarResource.getCode(),calendarResourceNameMap,calendarResource.getDescriptionMap(),calendarResource.isActive(),serviceContext);
    }
 else {
      importedCalendarResource=CalendarResourceLocalServiceUtil.updateCalendarResource(existingCalendarResource.getCalendarResourceId(),calendarResource.getNameMap(),calendarResource.getDescriptionMap(),calendarResource.isActive(),serviceContext);
    }
  }
 else {
    importedCalendarResource=CalendarResourceLocalServiceUtil.addCalendarResource(userId,portletDataContext.getScopeGroupId(),calendarResource.getClassNameId(),classPK,calendarResource.getClassUuid(),calendarResource.getCode(),calendarResourceNameMap,calendarResource.getDescriptionMap(),calendarResource.isActive(),serviceContext);
  }
  updateCalendars(portletDataContext,calendarResource,importedCalendarResource);
  portletDataContext.importClassedModel(calendarResource,importedCalendarResource);
}
