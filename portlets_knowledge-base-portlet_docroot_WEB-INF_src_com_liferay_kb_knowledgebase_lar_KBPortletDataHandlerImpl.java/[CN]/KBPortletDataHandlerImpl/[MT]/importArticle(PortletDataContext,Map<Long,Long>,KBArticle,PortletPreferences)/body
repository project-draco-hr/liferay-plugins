{
  long userId=context.getUserId(article.getUserUuid());
  long groupId=context.getGroupId();
  String[] tagsEntries=null;
  if (context.getBooleanParameter(_NAMESPACE,"tags")) {
    tagsEntries=context.getTagsEntries(KBArticle.class,article.getResourcePrimKey());
  }
  ThemeDisplay themeDisplay=null;
  KBArticle existingArticle=null;
  if (context.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR)) {
    existingArticle=KBArticleUtil.fetchByUUID_G(article.getUuid(),context.getGroupId());
    if (existingArticle == null) {
      existingArticle=KBArticleLocalServiceUtil.addArticle(article.getUuid(),userId,groupId,article.getTitle(),article.getHtmlTitle(),article.getVersion(),article.getContent(),article.getDescription(),article.isMinorEdit(),article.isHead(),article.isTemplate(),article.isDraft(),article.getParentResourcePrimKey(),tagsEntries,prefs,themeDisplay);
    }
 else {
      existingArticle=KBArticleLocalServiceUtil.updateArticle(userId,existingArticle.getResourcePrimKey(),article.getVersion(),article.getTitle(),article.getHtmlTitle(),article.getContent(),article.getDescription(),article.isMinorEdit(),article.isTemplate(),article.isDraft(),article.getParentResourcePrimKey(),tagsEntries,prefs,themeDisplay);
    }
  }
 else {
    existingArticle=KBArticleLocalServiceUtil.addArticle(userId,groupId,article.getTitle(),article.getContent(),article.getDescription(),article.isMinorEdit(),article.isTemplate(),article.isDraft(),article.getParentResourcePrimKey(),tagsEntries,prefs,themeDisplay);
  }
  articlePKs.put(article.getResourcePrimKey(),existingArticle.getResourcePrimKey());
}
