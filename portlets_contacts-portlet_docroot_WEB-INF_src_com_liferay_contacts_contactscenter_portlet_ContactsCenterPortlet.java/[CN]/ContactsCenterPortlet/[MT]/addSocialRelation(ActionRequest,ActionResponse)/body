{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long userId=ParamUtil.getLong(actionRequest,"userId");
  int type=ParamUtil.getInteger(actionRequest,"type");
  boolean blocked=SocialRelationLocalServiceUtil.hasRelation(userId,themeDisplay.getUserId(),SocialRelationConstants.TYPE_UNI_ENEMY);
  if (type == SocialRelationConstants.TYPE_UNI_ENEMY) {
    List<SocialRelation> relations=SocialRelationLocalServiceUtil.getRelations(themeDisplay.getUserId(),userId,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
    for (    SocialRelation relation : relations) {
      SocialRelationLocalServiceUtil.deleteRelation(relation);
    }
  }
 else   if (blocked) {
    return;
  }
  SocialRelationLocalServiceUtil.addRelation(themeDisplay.getUserId(),userId,type);
  if (blocked) {
    SocialRelationLocalServiceUtil.addRelation(userId,themeDisplay.getUserId(),type);
  }
}
