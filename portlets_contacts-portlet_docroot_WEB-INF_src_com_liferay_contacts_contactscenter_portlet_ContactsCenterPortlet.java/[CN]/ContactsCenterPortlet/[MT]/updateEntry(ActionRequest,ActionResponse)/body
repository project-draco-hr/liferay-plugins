{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long entryId=ParamUtil.getLong(actionRequest,"entryId");
  String fullName=ParamUtil.getString(actionRequest,"fullName");
  String emailAddress=ParamUtil.getString(actionRequest,"emailAddress");
  String comments=ParamUtil.getString(actionRequest,"comments");
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
  try {
    Entry entry=null;
    String message=StringPool.BLANK;
    if (entryId > 0) {
      entry=EntryLocalServiceUtil.updateEntry(entryId,fullName,emailAddress,comments);
      message="you-have-successfully-updated-the-contact";
    }
 else {
      entry=EntryLocalServiceUtil.addEntry(themeDisplay.getUserId(),fullName,emailAddress,comments);
      message="you-have-successfully-added-a-new-contact";
    }
    jsonObject.put("entryId",entry.getEntryId());
    jsonObject.put("success",true);
    SessionMessages.add(actionRequest,"request_processed",themeDisplay.translate(message));
  }
 catch (  Exception e) {
    String message=null;
    if (e instanceof EntryEmailAddressException) {
      message="please-enter-a-valid-email-address";
    }
 else     if (e instanceof ContactFullNameException) {
      message="full-name-cannot-be-empty";
    }
 else     if (e instanceof DuplicateEntryEmailAddressException) {
      message="there-is-already-a-contact-with-this-email-address";
    }
 else {
      message="an-error-occurred-while-processing-the-requested-resource";
    }
    jsonObject.put("message",themeDisplay.translate(message));
    jsonObject.put("success",false);
  }
  writeJSON(actionRequest,actionResponse,jsonObject);
}
