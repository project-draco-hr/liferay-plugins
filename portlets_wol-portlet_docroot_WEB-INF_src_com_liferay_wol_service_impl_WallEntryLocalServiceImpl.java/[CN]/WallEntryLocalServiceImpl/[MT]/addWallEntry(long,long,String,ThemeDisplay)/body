{
  Group group=GroupLocalServiceUtil.getGroup(groupId);
  User user=UserLocalServiceUtil.getUserById(userId);
  Date now=new Date();
  long wallEntryId=CounterLocalServiceUtil.increment();
  WallEntry wallEntry=wallEntryPersistence.create(wallEntryId);
  wallEntry.setGroupId(groupId);
  wallEntry.setCompanyId(user.getCompanyId());
  wallEntry.setUserId(user.getUserId());
  wallEntry.setUserName(user.getFullName());
  wallEntry.setCreateDate(now);
  wallEntry.setModifiedDate(now);
  wallEntry.setComments(comments);
  wallEntryPersistence.update(wallEntry,false);
  try {
    sendEmail(wallEntry,themeDisplay);
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
  String activityType=WallActivityKeys.ADD_ENTRY;
  long receiverUserId=group.getClassPK();
  SocialActivityLocalServiceUtil.addActivity(userId,groupId,WallEntry.class.getName(),wallEntryId,activityType,StringPool.BLANK,receiverUserId);
  return wallEntry;
}
