{
  HttpServletRequest request=PortalUtil.getHttpServletRequest(resourceRequest);
  HttpServletResponse response=PortalUtil.getHttpServletResponse(resourceResponse);
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long calendarId=ParamUtil.getLong(resourceRequest,"calendarId");
  Calendar calendar=CalendarLocalServiceUtil.getCalendar(calendarId);
  String fileName=calendar.getName(themeDisplay.getLocale()) + CharPool.PERIOD + String.valueOf(CalendarDataFormat.ICAL);
  CalendarDataHandler calendarDataHandler=CalendarDataHandlerFactory.getCalendarDataHandler(CalendarDataFormat.ICAL);
  String data=calendarDataHandler.exportCalendar(calendarId);
  String contentType=MimeTypesUtil.getContentType(fileName);
  ServletResponseUtil.sendFile(request,response,fileName,data.getBytes(),contentType);
}
