{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String keywords=ParamUtil.getString(resourceRequest,"keywords");
  JSONArray jsonArray=JSONFactoryUtil.createJSONArray();
  long[] groupIds=new long[]{themeDisplay.getCompanyGroupId(),themeDisplay.getScopeGroupId()};
  long classNameId=PortalUtil.getClassNameId(CalendarResource.class);
  List<CalendarResource> calendarResources=CalendarResourceServiceUtil.search(themeDisplay.getCompanyId(),groupIds,new long[]{classNameId},keywords,true,true,0,SearchContainer.DEFAULT_DELTA,new CalendarResourceNameComparator());
  for (  CalendarResource calendarResource : calendarResources) {
    addCalendarJSONObject(resourceRequest,jsonArray,calendarResource.getClassNameId(),calendarResource.getClassPK());
  }
  long groupClassNameId=PortalUtil.getClassNameId(Group.class);
  String[] params={"usersGroups:" + themeDisplay.getUserId() + ":long"};
  String name=StringUtil.merge(CustomSQLUtil.keywords(keywords),StringPool.BLANK);
  List<Group> groups=GroupServiceUtil.search(themeDisplay.getCompanyId(),name,null,params,0,SearchContainer.DEFAULT_DELTA);
  for (  Group group : groups) {
    addCalendarJSONObject(resourceRequest,jsonArray,groupClassNameId,group.getGroupId());
  }
  long userClassNameId=PortalUtil.getClassNameId(User.class);
  List<User> users=UserLocalServiceUtil.search(themeDisplay.getCompanyId(),keywords,0,null,0,SearchContainer.DEFAULT_DELTA,new UserFirstNameComparator());
  for (  User user : users) {
    addCalendarJSONObject(resourceRequest,jsonArray,userClassNameId,user.getUserId());
  }
  writeJSON(resourceRequest,resourceResponse,jsonArray);
}
