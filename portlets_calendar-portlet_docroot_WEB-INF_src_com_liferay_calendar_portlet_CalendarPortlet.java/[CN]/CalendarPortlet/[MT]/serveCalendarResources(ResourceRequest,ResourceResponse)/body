{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String keywords=ParamUtil.getString(resourceRequest,"keywords");
  Set<Calendar> calendarSet=new LinkedHashSet<Calendar>();
  JSONArray jsonArray=JSONFactoryUtil.createJSONArray();
  Hits hits=search(themeDisplay.getCompanyId(),themeDisplay.getUserId(),keywords);
  for (  Document document : hits.getDocs()) {
    long calendarId=GetterUtil.getLong(document.get(Field.ENTRY_CLASS_PK));
    Calendar calendar=CalendarServiceUtil.getCalendar(calendarId);
    calendarSet.add(calendar);
  }
  long groupClassNameId=PortalUtil.getClassNameId(Group.class);
  String name=StringUtil.merge(CustomSQLUtil.keywords(keywords),StringPool.BLANK);
  LinkedHashMap<String,Object> params=new LinkedHashMap<String,Object>();
  params.put("usersGroups",themeDisplay.getUserId());
  List<Group> groups=GroupLocalServiceUtil.search(themeDisplay.getCompanyId(),name,null,params,true,0,SearchContainer.DEFAULT_DELTA);
  for (  Group group : groups) {
    addCalendar(resourceRequest,calendarSet,groupClassNameId,group.getGroupId());
  }
  long userClassNameId=PortalUtil.getClassNameId(User.class);
  List<User> users=UserLocalServiceUtil.search(themeDisplay.getCompanyId(),keywords,0,null,0,SearchContainer.DEFAULT_DELTA,new UserFirstNameComparator());
  for (  User user : users) {
    addCalendar(resourceRequest,calendarSet,userClassNameId,user.getUserId());
  }
  for (  Calendar calendar : calendarSet) {
    JSONObject jsonObject=CalendarUtil.toCalendarJSONObject(themeDisplay,calendar);
    jsonArray.put(jsonObject);
  }
  writeJSON(resourceRequest,resourceResponse,jsonArray);
}
