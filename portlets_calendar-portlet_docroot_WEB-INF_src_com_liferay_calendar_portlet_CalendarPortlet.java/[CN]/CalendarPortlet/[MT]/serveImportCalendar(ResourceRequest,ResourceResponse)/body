{
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(resourceRequest);
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long calendarId=ParamUtil.getLong(uploadPortletRequest,"calendarId");
  File file=uploadPortletRequest.getFile("file");
  String data=FileUtil.read(file);
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
  if (Validator.isNotNull(data)) {
    try {
      CalendarDataHandler calendarDataHandler=CalendarDataHandlerFactory.getCalendarDataHandler(CalendarDataFormat.ICAL);
      calendarDataHandler.importCalendar(calendarId,data);
      jsonObject.put("success",true);
    }
 catch (    Exception e) {
      jsonObject.put("error",themeDisplay.translate("an-unexpected-error-occurred-while-importing-your-file"));
    }
  }
 else {
    jsonObject.put("error",themeDisplay.translate("failed-to-import-empty-file"));
  }
  writeJSON(resourceRequest,resourceResponse,jsonObject);
}
