{
  String json=null;
  try {
    long bundleId=ParamUtil.getLong(resourceRequest,"bundleId");
    Bundle bundle=_bundleContext.getBundle(bundleId);
    String resourceID=resourceRequest.getResourceID();
    if (resourceID.equals("setBundleStartLevel")) {
      int startLevel=ParamUtil.getInteger(resourceRequest,"startLevel");
      BundleStartLevel bundleStartLevel=bundle.adapt(BundleStartLevel.class);
      bundleStartLevel.setStartLevel(startLevel);
    }
 else     if (resourceID.equals("startBundle")) {
      bundle.start();
    }
 else     if (resourceID.equals("stopBundle")) {
      bundle.stop();
    }
 else     if (resourceID.equals("uninstallBundle")) {
      bundle.uninstall();
    }
 else     if (resourceID.equals("updateBundle")) {
      bundle.update();
    }
    int state=bundle.getState();
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
    if (state == Bundle.ACTIVE) {
      jsonObject.put("state","active");
    }
 else     if (state == Bundle.INSTALLED) {
      jsonObject.put("state","installed");
    }
 else     if (state == Bundle.RESOLVED) {
      jsonObject.put("state","resolved");
    }
 else     if (state == Bundle.STARTING) {
      jsonObject.put("state","starting");
    }
 else     if (state == Bundle.STOPPING) {
      jsonObject.put("state","stopping");
    }
 else     if (state == Bundle.UNINSTALLED) {
      jsonObject.put("state","uninstalled");
    }
 else {
      jsonObject.put("state",StringPool.BLANK);
    }
    json=jsonObject.toString();
  }
 catch (  BundleException be) {
    json=JSONFactoryUtil.serializeThrowable(be);
  }
  writeJSON(resourceRequest,resourceResponse,json);
}
