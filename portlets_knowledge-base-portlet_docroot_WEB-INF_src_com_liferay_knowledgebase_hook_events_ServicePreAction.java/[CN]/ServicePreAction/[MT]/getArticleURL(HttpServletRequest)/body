{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  long resourcePrimKey=ParamUtil.getLong(request,NAMESPACE + "resourcePrimKey");
  Article article=null;
  try {
    article=ArticleLocalServiceUtil.getLatestArticle(resourcePrimKey,WorkflowConstants.STATUS_ANY);
  }
 catch (  NoSuchArticleException nsae) {
    return getDisplayPortletURL(resourcePrimKey,request);
  }
  boolean viewPermission=ArticlePermission.contains(themeDisplay.getPermissionChecker(),article,ActionKeys.VIEW);
  if (!viewPermission) {
    return getDisplayPortletURL(resourcePrimKey,request);
  }
  String articleURL=null;
  if (article.getGroupId() == themeDisplay.getScopeGroupId()) {
    articleURL=getArticleURL(false,resourcePrimKey,themeDisplay);
    if (articleURL == null) {
      articleURL=getArticleURL(true,resourcePrimKey,themeDisplay);
    }
  }
  if (articleURL == null) {
    articleURL=getAdminPortletURL(resourcePrimKey,themeDisplay);
  }
  if (articleURL == null) {
    articleURL=getDisplayPortletURL(resourcePrimKey,request);
  }
  return articleURL;
}
