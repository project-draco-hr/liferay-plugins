{
  int status=tasksEntry.getStatus();
  if ((status != TasksEntryConstants.STATUS_OPEN) && (status != TasksEntryConstants.STATUS_RESOLVED) && (status != TasksEntryConstants.STATUS_REOPENED)) {
    return;
  }
  long senderUserId=serviceContext.getUserId();
  long assigneeUserId=tasksEntry.getAssigneeUserId();
  long creatorUserId=tasksEntry.getUserId();
  List<Long> receiverUserIds=new ArrayList<Long>();
  if (creatorUserId != senderUserId) {
    receiverUserIds.add(creatorUserId);
  }
  if (assigneeUserId != senderUserId && !receiverUserIds.contains(assigneeUserId)) {
    receiverUserIds.add(assigneeUserId);
  }
  if (previousAssigneeUserId != 0 && previousAssigneeUserId != senderUserId && !receiverUserIds.contains(assigneeUserId)) {
    receiverUserIds.add(previousAssigneeUserId);
  }
  JSONObject notificationEventJSON=JSONFactoryUtil.createJSONObject();
  notificationEventJSON.put("body",tasksEntry.getTitle());
  notificationEventJSON.put("entryId",tasksEntry.getTasksEntryId());
  notificationEventJSON.put("portletId","1_WAR_tasksportlet");
  notificationEventJSON.put("senderUserId",senderUserId);
  for (  long receiverUserId : receiverUserIds) {
    User receiverUser=UserLocalServiceUtil.getUserById(receiverUserId);
    String title=StringPool.BLANK;
    if (assigneeUserId != previousAssigneeUserId) {
      if (receiverUserId == previousAssigneeUserId) {
        title="reassigned-your-task";
      }
 else {
        title="assigned-you-a-task";
      }
    }
 else     if (status != previousStatus) {
      String statusLabel=TasksEntryConstants.getStatusLabel(tasksEntry.getStatus());
      title=statusLabel + "-the-task";
    }
 else {
      title="modified-the-task";
    }
    notificationEventJSON.put("title",title);
    NotificationEvent notificationEvent=NotificationEventFactoryUtil.createNotificationEvent(System.currentTimeMillis(),"6_WAR_soportlet",notificationEventJSON);
    notificationEvent.setDeliveryRequired(0);
    ChannelHubManagerUtil.sendNotificationEvent(receiverUser.getCompanyId(),receiverUserId,notificationEvent);
  }
}
