{
  String snippet=StringPool.BLANK;
  String localizedContentName=DocumentImpl.getLocalizedName(locale,fieldName);
  HighlightField highlightField=highlightFields.get(localizedContentName);
  String snippetField=localizedContentName;
  if (highlightField == null) {
    highlightField=highlightFields.get(fieldName);
    snippetField=fieldName;
  }
  if (highlightField != null) {
    Text[] texts=highlightField.fragments();
    StringBundler sb=new StringBundler(texts.length * 2);
    for (    Text text : texts) {
      sb.append(text);
      sb.append(StringPool.TRIPLE_PERIOD);
    }
    snippet=sb.toString();
  }
  Pattern pattern=Pattern.compile(_HIGHLIGHTED_TEXT_PATTERN);
  Matcher matcher=pattern.matcher(snippet);
  while (matcher.find()) {
    queryTerms.add(matcher.group(1));
  }
  snippet=StringUtil.replace(snippet,_OPEN_HIGHLIGHT_TAG,StringPool.BLANK);
  snippet=StringUtil.replace(snippet,_CLOSE_HIGHLIGHT_TAG,StringPool.BLANK);
  document.addText(Field.SNIPPET.concat(StringPool.UNDERLINE).concat(snippetField),snippet);
}
