{
  String pluginId=PortletConstants.getRootPortletId(portletId);
  if (pluginId.equals(PortletKeys.KNOWLEDGE_BASE_ADMIN)) {
    Article article=ArticleLocalServiceUtil.getLatestArticle(resourcePrimKey,WorkflowConstants.STATUS_ANY);
    String layoutFullURL=PortalUtil.getControlPanelFullURL(article.getGroupId(),PortletKeys.KNOWLEDGE_BASE_ADMIN,null);
    return getArticleURL(portletId,resourcePrimKey,layoutFullURL,false);
  }
  Object[] plidAndWindowState=getPlidAndWindowState(portletId,pluginId,resourcePrimKey,portalURL);
  long plid=(Long)plidAndWindowState[0];
  WindowState windowState=(WindowState)plidAndWindowState[1];
  if (plid == LayoutConstants.DEFAULT_PLID) {
    return StringPool.BLANK;
  }
  Layout layout=LayoutLocalServiceUtil.getLayout(plid);
  String layoutActualURL=PortalUtil.getLayoutActualURL(layout);
  String layoutFullURL=portalURL + layoutActualURL;
  boolean maximized=windowState.equals(WindowState.MAXIMIZED);
  return getArticleURL(portletId,resourcePrimKey,layoutFullURL,maximized);
}
