{
  String rootPortletId=PortletConstants.getRootPortletId(portletId);
  if (!rootPortletId.equals(PortletKeys.KNOWLEDGE_BASE_DISPLAY)) {
    return null;
  }
  Layout layout=LayoutLocalServiceUtil.getLayout(plid);
  Group group=layout.getGroup();
  PortletPreferences jxPreferences=PortletPreferencesFactoryUtil.getPortletSetup(layout,portletId,StringPool.BLANK);
  String selectionMethod=jxPreferences.getValue("selection-method","group");
  long[] resourcePrimKeys=GetterUtil.getLongValues(jxPreferences.getValues("resource-prim-keys",null));
  boolean allArticles=GetterUtil.getBoolean(jxPreferences.getValue("all-articles",null),true);
  String orderByColumn=jxPreferences.getValue("order-by-column","modified-date");
  boolean orderByAscending=GetterUtil.getBoolean(jxPreferences.getValue("order-by-ascending",null));
  OrderByComparator orderByComparator=null;
  if (orderByColumn.equals("create-date")) {
    orderByComparator=new ArticleCreateDateComparator(orderByAscending);
  }
 else   if (orderByColumn.equals("modified-date")) {
    orderByComparator=new ArticleModifiedDateComparator(orderByAscending);
  }
  List<Article> articles=new ArrayList<Article>();
  if (selectionMethod.equals("articles")) {
    List<AssetEntry> assetEntries=getAssetEntries(plid,portletId,assetCategoryId,assetTagName);
    if (assetEntries != null) {
      long[] classPKs=StringUtil.split(ListUtil.toString(assetEntries,"classPK"),0L);
      Set<Long> classPKsSet=SetUtil.fromArray(classPKs);
      Set<Long> resourcePrimKeysSet=SetUtil.fromArray(resourcePrimKeys);
      resourcePrimKeysSet.retainAll(classPKsSet);
      resourcePrimKeys=StringUtil.split(StringUtil.merge(resourcePrimKeysSet),0L);
    }
    articles=getArticles(group.getGroupId(),resourcePrimKeys,0,1,true);
  }
 else   if (selectionMethod.equals("group")) {
    List<AssetEntry> assetEntries=getAssetEntries(plid,portletId,assetCategoryId,assetTagName);
    if (assetEntries != null) {
      long[] classPKs=StringUtil.split(ListUtil.toString(assetEntries,"classPK"),0L);
      articles=ArticleServiceUtil.getArticles(group.getGroupId(),classPKs,WorkflowConstants.STATUS_APPROVED,null,0,1,orderByComparator);
    }
 else     if (!allArticles) {
      articles=ArticleServiceUtil.getSiblingArticles(group.getGroupId(),ArticleConstants.DEFAULT_PARENT_RESOURCE_PRIM_KEY,WorkflowConstants.STATUS_APPROVED,0,1,orderByComparator);
    }
 else {
      articles=ArticleServiceUtil.getGroupArticles(group.getGroupId(),WorkflowConstants.STATUS_APPROVED,null,0,1,orderByComparator);
    }
  }
  if (articles.isEmpty()) {
    return null;
  }
  return articles.get(0);
}
