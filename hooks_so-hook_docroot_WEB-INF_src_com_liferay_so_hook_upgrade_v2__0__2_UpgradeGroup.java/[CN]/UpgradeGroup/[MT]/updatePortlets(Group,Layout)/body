{
  String prefix=PortletPropsKeys.SITE_TEMPLATE_PORTLETS;
  Filter filter=new Filter(layout.getFriendlyURL());
  if (group.isUser()) {
    prefix=PortletPropsKeys.USER_LAYOUT_PORTLETS;
  }
  LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
  LayoutTemplate layoutTemplate=layoutTypePortlet.getLayoutTemplate();
  List<String> columns=layoutTemplate.getColumns();
  for (  String column : columns) {
    String[] portletIds=PortletProps.getArray(prefix + column,filter);
    String portlets=StringPool.BLANK;
    for (    String portletId : portletIds) {
      portlets=StringUtil.add(portlets,portletId);
    }
    layoutTypePortlet.setPortletIds(column,portlets);
  }
  LayoutLocalServiceUtil.updateLayout(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId(),layout.getTypeSettings());
  if (!layoutTypePortlet.hasPortletId("1_WAR_soportlet")) {
    return;
  }
  PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,"1_WAR_soportlet");
  portletSetup.setValue("portlet-setup-show-borders",String.valueOf(Boolean.TRUE));
  portletSetup.store();
}
