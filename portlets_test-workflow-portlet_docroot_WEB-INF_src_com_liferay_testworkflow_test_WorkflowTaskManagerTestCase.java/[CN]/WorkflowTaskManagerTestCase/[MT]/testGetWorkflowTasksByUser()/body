{
  List<WorkflowTask> workflowTasks=WorkflowTaskManagerUtil.getWorkflowTasksByUser(companyId,defaultUserId,null,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new WorkflowTaskNameComparator(true));
  assertEquals(0,workflowTasks.size());
  WorkflowInstance workflowInstance=WorkflowInstanceManagerUtil.startWorkflowInstance(companyId,defaultUserId,DEFINITION_NAME_3,_workflowDefinition.getVersion(),null,null);
  List<WorkflowInstance> childrenWorkflowInstances=workflowInstance.getChildrenWorkflowInstances();
  for (  WorkflowInstance childWorkflowInstance : childrenWorkflowInstances) {
    List<WorkflowTask> childWorkflowTasks=WorkflowTaskManagerUtil.getWorkflowTasksByWorkflowInstance(companyId,childWorkflowInstance.getWorkflowInstanceId(),null,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new WorkflowTaskNameComparator(true));
    assertEquals(1,childWorkflowTasks.size());
    WorkflowTask childWorkflowTask=childWorkflowTasks.get(0);
    assertEquals(0L,childWorkflowTask.getAssigneeRoleId());
    childWorkflowTask=WorkflowTaskManagerUtil.assignWorkflowTaskToRole(companyId,defaultUserId,childWorkflowTask.getWorkflowTaskId(),guestRoleId,null,null);
    childWorkflowTask=WorkflowTaskManagerUtil.assignWorkflowTaskToUser(companyId,defaultUserId,childWorkflowTask.getWorkflowTaskId(),defaultUserId,null,null);
    assertEquals(defaultUserId,childWorkflowTask.getAssigneeUserId());
  }
  workflowTasks=WorkflowTaskManagerUtil.getWorkflowTasksByUser(companyId,defaultUserId,null,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new WorkflowTaskNameComparator(true));
  assertEquals(3,workflowTasks.size());
  WorkflowTask workflowTask1=workflowTasks.get(0);
  assertEquals(defaultUserId,workflowTask1.getAssigneeUserId());
  assertNull(workflowTask1.getCompletionDate());
  assertEquals("Task3-1",workflowTask1.getName());
  WorkflowTask workflowTask2=workflowTasks.get(1);
  assertEquals(defaultUserId,workflowTask2.getAssigneeUserId());
  assertNull(workflowTask2.getCompletionDate());
  assertEquals("Task3-2",workflowTask2.getName());
  WorkflowTask workflowTask3=workflowTasks.get(2);
  assertEquals(defaultUserId,workflowTask3.getAssigneeUserId());
  assertNull(workflowTask3.getCompletionDate());
  assertEquals("Task3-3",workflowTask3.getName());
  workflowTasks=WorkflowTaskManagerUtil.getWorkflowTasksByUser(companyId,defaultUserId,Boolean.TRUE,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new WorkflowTaskNameComparator(true));
  assertEquals(0,workflowTasks.size());
  workflowTasks=WorkflowTaskManagerUtil.getWorkflowTasksByUser(companyId,defaultUserId,Boolean.FALSE,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new WorkflowTaskNameComparator(true));
  assertEquals(3,workflowTasks.size());
  workflowTask1=workflowTasks.get(0);
  assertEquals(defaultUserId,workflowTask1.getAssigneeUserId());
  assertNull(workflowTask1.getCompletionDate());
  assertEquals("Task3-1",workflowTask1.getName());
  workflowTask2=workflowTasks.get(1);
  assertEquals(defaultUserId,workflowTask2.getAssigneeUserId());
  assertNull(workflowTask2.getCompletionDate());
  assertEquals("Task3-2",workflowTask2.getName());
  workflowTask3=workflowTasks.get(2);
  assertEquals(defaultUserId,workflowTask3.getAssigneeUserId());
  assertNull(workflowTask3.getCompletionDate());
  assertEquals("Task3-3",workflowTask3.getName());
  for (  WorkflowInstance childWorkflowInstance : childrenWorkflowInstances) {
    List<WorkflowTask> childWorkflowTasks=WorkflowTaskManagerUtil.getWorkflowTasksByWorkflowInstance(companyId,childWorkflowInstance.getWorkflowInstanceId(),null,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new WorkflowTaskNameComparator(true));
    assertEquals(1,childWorkflowTasks.size());
    WorkflowTask childWorkflowTask=childWorkflowTasks.get(0);
    WorkflowTaskManagerUtil.completeWorkflowTask(companyId,defaultUserId,childWorkflowTask.getWorkflowTaskId(),null,null,null);
  }
  workflowTasks=WorkflowTaskManagerUtil.getWorkflowTasksByUser(companyId,defaultUserId,null,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new WorkflowTaskNameComparator(true));
  assertEquals(4,workflowTasks.size());
  workflowTask1=workflowTasks.get(0);
  assertEquals(defaultUserId,workflowTask1.getAssigneeUserId());
  assertNotNull(workflowTask1.getCompletionDate());
  assertEquals("Task3-1",workflowTask1.getName());
  workflowTask2=workflowTasks.get(1);
  assertEquals(defaultUserId,workflowTask2.getAssigneeUserId());
  assertNotNull(workflowTask2.getCompletionDate());
  assertEquals("Task3-2",workflowTask2.getName());
  workflowTask3=workflowTasks.get(2);
  assertEquals(defaultUserId,workflowTask3.getAssigneeUserId());
  assertNotNull(workflowTask3.getCompletionDate());
  assertEquals("Task3-3",workflowTask3.getName());
  WorkflowTask workflowTask4=workflowTasks.get(3);
  assertEquals(0L,workflowTask4.getAssigneeUserId());
  assertNull(workflowTask4.getCompletionDate());
  assertEquals("Task3-4",workflowTask4.getName());
  workflowTasks=WorkflowTaskManagerUtil.getWorkflowTasksByUser(companyId,defaultUserId,Boolean.TRUE,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new WorkflowTaskNameComparator(true));
  assertEquals(3,workflowTasks.size());
  workflowTask1=workflowTasks.get(0);
  assertEquals(defaultUserId,workflowTask1.getAssigneeUserId());
  assertNotNull(workflowTask1.getCompletionDate());
  assertEquals("Task3-1",workflowTask1.getName());
  workflowTask2=workflowTasks.get(1);
  assertEquals(defaultUserId,workflowTask2.getAssigneeUserId());
  assertNotNull(workflowTask2.getCompletionDate());
  assertEquals("Task3-2",workflowTask2.getName());
  workflowTask3=workflowTasks.get(2);
  assertEquals(defaultUserId,workflowTask3.getAssigneeUserId());
  assertNotNull(workflowTask3.getCompletionDate());
  assertEquals("Task3-3",workflowTask3.getName());
  workflowTasks=WorkflowTaskManagerUtil.getWorkflowTasksByUser(companyId,defaultUserId,Boolean.FALSE,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new WorkflowTaskNameComparator(true));
  assertEquals(1,workflowTasks.size());
  workflowTask4=workflowTasks.get(0);
  assertEquals(0L,workflowTask4.getAssigneeUserId());
  assertNull(workflowTask4.getCompletionDate());
  assertEquals("Task3-4",workflowTask4.getName());
  WorkflowInstanceManagerUtil.deleteWorkflowInstance(companyId,workflowInstance.getWorkflowInstanceId());
}
