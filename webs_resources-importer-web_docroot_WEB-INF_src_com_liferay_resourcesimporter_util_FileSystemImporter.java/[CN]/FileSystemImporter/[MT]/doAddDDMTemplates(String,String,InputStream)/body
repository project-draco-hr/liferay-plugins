{
  String ddmTemplateKey=getJournalId(fileName);
  String name=FileUtil.stripExtension(fileName);
  Map<Locale,String> nameMap=getMap(name);
  String xsl=StringUtil.read(inputStream);
  xsl=replaceFileEntryURL(xsl);
  setServiceContext(fileName);
  long journalArticleClassNameId=PortalUtil.getClassNameId(JournalArticle.class);
  DDMStructure ddmStructure=DDMStructureLocalServiceUtil.getStructure(groupId,journalArticleClassNameId,ddmStructureKey);
  long ddmStructureClassNameId=PortalUtil.getClassNameId(DDMStructure.class);
  DDMTemplate ddmTemplate=DDMTemplateLocalServiceUtil.addTemplate(userId,groupId,ddmStructureClassNameId,ddmStructure.getStructureId(),ddmTemplateKey,nameMap,null,DDMTemplateConstants.TEMPLATE_TYPE_DISPLAY,DDMTemplateConstants.TEMPLATE_MODE_CREATE,TemplateConstants.LANG_TYPE_XSD,xsl,false,false,null,null,serviceContext);
  addJournalArticles(ddmStructureKey,ddmTemplate.getTemplateKey(),_JOURNAL_ARTICLES_DIR_NAME + name);
}
