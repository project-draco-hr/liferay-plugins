{
  String name=FileUtil.stripExtension(fileName);
  String xsl=StringUtil.read(inputStream);
  setServiceContext(fileName);
  DDMStructure ddmStructure=DDMStructureLocalServiceUtil.getStructure(groupId,PortalUtil.getClassNameId(JournalArticle.class),ddmStructureKey);
  DDMTemplate ddmTemplate=DDMTemplateLocalServiceUtil.fetchTemplate(groupId,PortalUtil.getClassNameId(DDMStructure.class),getTemplateKey(name));
  if (ddmTemplate != null) {
    if (_log.isInfoEnabled()) {
      _log.info("Template already exists for " + fileName + " with version "+ version);
    }
    if (!developerModeEnabled) {
      return;
    }
    DDMTemplateLocalServiceUtil.deleteTemplate(ddmTemplate);
  }
  ddmTemplate=DDMTemplateLocalServiceUtil.addTemplate(userId,groupId,PortalUtil.getClassNameId(DDMStructure.class),ddmStructure.getStructureId(),getTemplateKey(fileName),getMap(name),null,DDMTemplateConstants.TEMPLATE_TYPE_DISPLAY,null,getDDMTemplateLanguage(fileName),replaceFileEntryURL(xsl),false,false,null,null,serviceContext);
  addJournalArticles(ddmStructureKey,ddmTemplate.getTemplateKey(),_JOURNAL_ARTICLES_DIR_NAME + name);
}
