{
  Map parameterMap=portletDataContext.getParameterMap();
  boolean exportData=portletDataContext.getBooleanParameter(_NAMESPACE,"export-sample-lar-portlet-data");
  if (_log.isDebugEnabled()) {
    if (exportData) {
      _log.debug("Exporting data is enabled");
    }
 else {
      _log.debug("Exporting data is disabled");
    }
  }
  if (!exportData) {
    return null;
  }
  try {
    long exportDate=System.currentTimeMillis();
    if (_log.isInfoEnabled()) {
      _log.info("Exporting LAR on " + new Date(exportDate));
    }
    preferences.setValue("last-export-date",String.valueOf(exportDate));
    preferences.store();
    String data="<data-file />";
    ZipWriter zipWriter=portletDataContext.getZipWriter();
    if (zipWriter != null) {
      boolean createReadMe=portletDataContext.getBooleanParameter(_NAMESPACE,"create-readme");
      if (createReadMe) {
        if (_log.isInfoEnabled()) {
          _log.info("Writing to zip");
        }
        zipWriter.addEntry(portletId + "/README.txt","Test writing to zip.");
      }
      String dataType=MapUtil.getString(parameterMap,"data-type","xml");
      if (Validator.equals(dataType,"csv")) {
        StringBuilder csv=new StringBuilder();
        csv.append("data 1," + new Date() + "\n");
        csv.append("data 2," + new Date() + "\n");
        String filePath=portletId + "/data.csv";
        data="<data-file>" + filePath + "</data-file>";
        zipWriter.addEntry(filePath,csv.toString());
      }
 else       if (Validator.equals(dataType,"xml")) {
        StringBuilder xml=new StringBuilder();
        xml.append("<?xml version=\"1.0\"?>\n\n");
        xml.append("<records>\n");
        xml.append("\t<record>\n");
        xml.append("\t\t<field>data 1</field>\n");
        xml.append("\t\t<field>" + new Date() + "</field>\n");
        xml.append("\t</record>\n");
        xml.append("\t<record>\n");
        xml.append("\t\t<field>data 2</field>\n");
        xml.append("\t\t<field>" + new Date() + "</field>\n");
        xml.append("\t</record>\n");
        xml.append("</records>");
        String filePath=portletId + "/data.xml";
        data="<data-file>" + filePath + "</data-file>";
        zipWriter.addEntry(filePath,xml.toString());
      }
    }
    return data;
  }
 catch (  Exception e) {
    throw new PortletDataException(e);
  }
}
