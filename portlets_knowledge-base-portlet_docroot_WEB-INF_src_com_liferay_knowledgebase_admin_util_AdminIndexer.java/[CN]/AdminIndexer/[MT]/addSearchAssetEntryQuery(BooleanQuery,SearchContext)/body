{
  boolean assetEntryQueryContains=(Boolean)searchContext.getAttribute("KNOWLEDGE_BASE_ASSET_ENTRY_QUERY_CONTAINS");
  boolean assetEntryQueryAndOperator=(Boolean)searchContext.getAttribute("KNOWLEDGE_BASE_ASSET_ENTRY_QUERY_AND_OPERATOR");
  String assetEntryQueryName=(String)searchContext.getAttribute("KNOWLEDGE_BASE_ASSET_ENTRY_QUERY_NAME");
  long[] assetCategoryIds=(long[])searchContext.getAttribute("KNOWLEDGE_BASE_ASSET_CATEGORY_IDS");
  String[] assetTagNames=(String[])searchContext.getAttribute("KNOWLEDGE_BASE_ASSET_TAG_NAMES");
  if ((assetEntryQueryName.equals("asset-categories")) && (assetCategoryIds.length > 0)) {
    BooleanQuery booleanQuery=BooleanQueryFactoryUtil.create();
    for (    long assetCategoryId : assetCategoryIds) {
      if (searchContext.getUserId() > 0) {
        try {
          AssetCategoryServiceUtil.getCategory(assetCategoryId);
        }
 catch (        Exception e) {
          continue;
        }
      }
      if (assetEntryQueryAndOperator) {
        TermQuery termQuery=TermQueryFactoryUtil.create(Field.ASSET_CATEGORY_IDS,assetCategoryId);
        booleanQuery.add(termQuery,BooleanClauseOccur.MUST);
      }
 else {
        booleanQuery.addExactTerm(Field.ASSET_CATEGORY_IDS,assetCategoryId);
      }
    }
    if (assetEntryQueryContains) {
      contextQuery.add(booleanQuery,BooleanClauseOccur.MUST);
    }
 else {
      contextQuery.add(booleanQuery,BooleanClauseOccur.MUST_NOT);
    }
  }
  if ((assetEntryQueryName.equals("asset-tags")) && (assetTagNames.length > 0)) {
    BooleanQuery booleanQuery=BooleanQueryFactoryUtil.create();
    for (    String assetTagName : assetTagNames) {
      if (assetEntryQueryAndOperator) {
        TermQuery termQuery=TermQueryFactoryUtil.create(Field.ASSET_TAG_NAMES,assetTagName);
        booleanQuery.add(termQuery,BooleanClauseOccur.MUST);
      }
 else {
        booleanQuery.addExactTerm(Field.ASSET_TAG_NAMES,assetTagName);
      }
    }
    if (assetEntryQueryContains) {
      contextQuery.add(booleanQuery,BooleanClauseOccur.MUST);
    }
 else {
      contextQuery.add(booleanQuery,BooleanClauseOccur.MUST_NOT);
    }
  }
}
