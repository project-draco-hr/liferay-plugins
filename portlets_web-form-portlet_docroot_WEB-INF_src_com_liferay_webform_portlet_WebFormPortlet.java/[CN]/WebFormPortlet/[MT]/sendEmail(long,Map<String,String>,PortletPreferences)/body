{
  try {
    String emailAddresses=preferences.getValue("emailAddress",StringPool.BLANK);
    if (Validator.isNull(emailAddresses)) {
      _log.error("The web form email cannot be sent because no email " + "address is configured");
      return false;
    }
    String subject=preferences.getValue("subject",StringPool.BLANK);
    String body=getMailBody(fieldsMap);
    String fromNamePref=WebFormUtil.getEmailFromName(preferences,companyId);
    String fromAddressPref=WebFormUtil.getEmailFromAddress(preferences,companyId);
    InternetAddress fromAddress=new InternetAddress(fromAddressPref,fromNamePref);
    InternetAddress[] toAddresses=InternetAddress.parse(emailAddresses);
    MailMessage mailMessage=new MailMessage(fromAddress,subject,body,false);
    mailMessage.setTo(toAddresses);
    MailServiceUtil.sendEmail(mailMessage);
    return true;
  }
 catch (  Exception e) {
    _log.error("The web form email could not be sent",e);
    return false;
  }
}
