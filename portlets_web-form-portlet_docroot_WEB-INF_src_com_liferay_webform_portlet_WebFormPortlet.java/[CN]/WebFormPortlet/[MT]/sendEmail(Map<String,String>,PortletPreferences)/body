{
  try {
    String subject=preferences.getValue("subject",StringPool.BLANK);
    String emailAddress=preferences.getValue("emailAddress",StringPool.BLANK);
    if (Validator.isNull(emailAddress)) {
      _log.error("The web form email cannot be sent because no email " + "address is configured");
      return false;
    }
    String body=getMailBody(fieldsMap);
    InternetAddress fromAddress=null;
    try {
      String smtpUser=PropsUtil.get(PropsKeys.MAIL_SESSION_MAIL_SMTP_USER);
      if (Validator.isNotNull(smtpUser)) {
        fromAddress=new InternetAddress(smtpUser);
      }
    }
 catch (    Exception e) {
      _log.error(e);
    }
    if (fromAddress == null) {
      fromAddress=new InternetAddress(emailAddress);
    }
    InternetAddress toAddress=new InternetAddress(emailAddress);
    MailMessage mailMessage=new MailMessage(fromAddress,toAddress,subject,body,false);
    MailServiceUtil.sendEmail(mailMessage);
    return true;
  }
 catch (  Exception e) {
    _log.error("The web form email could not be sent",e);
    return false;
  }
}
