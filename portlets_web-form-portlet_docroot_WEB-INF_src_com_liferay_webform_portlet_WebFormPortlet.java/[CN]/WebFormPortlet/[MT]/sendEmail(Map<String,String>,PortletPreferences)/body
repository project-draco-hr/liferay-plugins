{
  try {
    String subject=preferences.getValue("subject",StringPool.BLANK);
    String emailAddresses=preferences.getValue("emailAddress",StringPool.BLANK);
    if (Validator.isNull(emailAddresses)) {
      _log.error("The web form email cannot be sent because no email " + "address is configured");
      return false;
    }
    String body=getMailBody(fieldsMap);
    InternetAddress fromAddress=null;
    try {
      String smtpUser=PropsUtil.get(PropsKeys.MAIL_SESSION_MAIL_SMTP_USER);
      if (Validator.isNotNull(smtpUser)) {
        fromAddress=new InternetAddress(smtpUser);
      }
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
    InternetAddress[] toAddress=InternetAddress.parse(emailAddresses);
    if (fromAddress == null) {
      fromAddress=toAddress[0];
    }
    MailMessage mailMessage=new MailMessage(fromAddress,subject,body,false);
    mailMessage.setTo(toAddress);
    MailServiceUtil.sendEmail(mailMessage);
    return true;
  }
 catch (  Exception e) {
    _log.error("The web form email could not be sent",e);
    return false;
  }
}
