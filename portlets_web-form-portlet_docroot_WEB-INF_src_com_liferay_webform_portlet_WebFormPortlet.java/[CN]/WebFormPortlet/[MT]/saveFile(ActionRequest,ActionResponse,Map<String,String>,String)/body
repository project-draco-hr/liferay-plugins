{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PortletPreferences preferences=PortletPreferencesFactoryUtil.getPortletSetup(actionRequest);
  StringBundler sb=new StringBundler();
  List<String> fieldLabels=new ArrayList<>();
  if (!FileUtil.exists(fileName)) {
    for (int i=1; true; i++) {
      String fieldLabel=preferences.getValue("fieldLabel" + i,StringPool.BLANK);
      String localizedfieldLabel=LocalizationUtil.getPreferencesValue(preferences,"fieldLabel" + i,themeDisplay.getLanguageId());
      if (Validator.isNull(fieldLabel)) {
        break;
      }
      fieldLabels.add(fieldLabel);
      sb.append(getCSVFormattedValue(localizedfieldLabel));
      sb.append(PortletPropsValues.CSV_SEPARATOR);
    }
    sb.setIndex(sb.index() - 1);
    sb.append(CharPool.NEW_LINE);
  }
  for (  String fieldLabel : fieldsMap.keySet()) {
    String fieldValue=fieldsMap.get(fieldLabel);
    sb.append(getCSVFormattedValue(fieldValue));
    sb.append(PortletPropsValues.CSV_SEPARATOR);
  }
  sb.setIndex(sb.index() - 1);
  sb.append(CharPool.NEW_LINE);
  try {
    FileUtil.write(fileName,sb.toString(),false,true);
    return true;
  }
 catch (  Exception e) {
    _log.error("The web form data could not be saved to a file",e);
    return false;
  }
}
