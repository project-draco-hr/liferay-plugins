{
  List<ResourcePermission> resourcePermissions=resourcePermissionPersistence.findByC_N_S(companyId,oldClassName,scope);
  for (  ResourcePermission resourcePermission : resourcePermissions) {
    long roleId=resourcePermission.getRoleId();
    Role role=roleLocalService.getRole(roleId);
    if (role.getModifiedDate().after(role.getCreateDate())) {
      continue;
    }
    long actionIds=convertActionId(resourcePermission,oldClassName,oldAction,newClassName,newAction);
    if (scope == ResourceConstants.SCOPE_GROUP) {
      resourceBlockLocalService.addGroupScopePermissions(companyId,GetterUtil.getLong(resourcePermission.getPrimKey()),newClassName,roleId,actionIds);
    }
 else {
      resourceBlockLocalService.addCompanyScopePermissions(companyId,newClassName,roleId,actionIds);
    }
    roleIds.add(roleId);
  }
}
