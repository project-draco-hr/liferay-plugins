{
  JSONObject notificationEventJSONObject=JSONFactoryUtil.createJSONObject();
  notificationEventJSONObject.put("body",mbMessage.getBody());
  notificationEventJSONObject.put("entryId",mbMessage.getThreadId());
  notificationEventJSONObject.put("entryKeyName","mbThreadId");
  notificationEventJSONObject.put("mvcPath","/view.jsp");
  notificationEventJSONObject.put("portletId",PortletKeys.PRIVATE_MESSAGING);
  notificationEventJSONObject.put("title","x-sent-you-a-message");
  notificationEventJSONObject.put("userId",mbMessage.getUserId());
  List<UserThread> userThreads=UserThreadLocalServiceUtil.getMBThreadUserThreads(mbMessage.getThreadId());
  for (  UserThread userThread : userThreads) {
    if (userThread.getUserId() == mbMessage.getUserId()) {
      continue;
    }
    NotificationEvent notificationEvent=NotificationEventFactoryUtil.createNotificationEvent(System.currentTimeMillis(),"6_WAR_soportlet",notificationEventJSONObject);
    notificationEvent.setDeliveryRequired(0);
    ChannelHubManagerUtil.sendNotificationEvent(mbMessage.getCompanyId(),userThread.getUserId(),notificationEvent);
  }
}
