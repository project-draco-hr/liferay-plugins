{
  User user=UserLocalServiceUtil.getUser(userId);
  String[] recipients=StringUtil.split(to);
  List<User> users=new ArrayList<User>();
  for (  String recipient : recipients) {
    int x=recipient.indexOf(CharPool.LESS_THAN);
    int y=recipient.indexOf(CharPool.GREATER_THAN);
    try {
      if ((x != -1) && (y != -1)) {
        String screenName=recipient.substring(x + 1,y);
        users.add(UserLocalServiceUtil.getUserByScreenName(user.getCompanyId(),screenName));
      }
 else {
        users.add(UserLocalServiceUtil.getUserByScreenName(user.getCompanyId(),recipient));
      }
    }
 catch (    NoSuchUserException nsue) {
    }
  }
  return users;
}
