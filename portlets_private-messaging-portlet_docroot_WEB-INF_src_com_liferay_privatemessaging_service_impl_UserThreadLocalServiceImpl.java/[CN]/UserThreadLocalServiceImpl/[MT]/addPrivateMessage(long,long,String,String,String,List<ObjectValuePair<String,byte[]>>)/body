{
  long parentMessageId=MBMessageConstants.DEFAULT_PARENT_MESSAGE_ID;
  if (mbThreadId != 0) {
    List<MBMessage> mbMessages=MBMessageLocalServiceUtil.getThreadMessages(mbThreadId,WorkflowConstants.STATUS_ANY);
    MBMessage lastMessage=mbMessages.get(mbMessages.size() - 1);
    parentMessageId=lastMessage.getMessageId();
    subject=lastMessage.getSubject();
  }
  long[] recipientUserIds=GetterUtil.getLongValues(StringUtil.split(to,StringPool.COMMA));
  return addPrivateMessage(userId,mbThreadId,parentMessageId,recipientUserIds,subject,body,files);
}
