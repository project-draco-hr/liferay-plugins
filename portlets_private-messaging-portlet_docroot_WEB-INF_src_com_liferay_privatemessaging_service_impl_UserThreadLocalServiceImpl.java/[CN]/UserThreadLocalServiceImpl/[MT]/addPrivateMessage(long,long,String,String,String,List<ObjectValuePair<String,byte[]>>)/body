{
  long parentMBMessageId=MBMessageConstants.DEFAULT_PARENT_MESSAGE_ID;
  if (mbThreadId != 0) {
    List<MBMessage> mbMessages=MBMessageLocalServiceUtil.getThreadMessages(mbThreadId,WorkflowConstants.STATUS_ANY);
    MBMessage lastMBMessage=mbMessages.get(mbMessages.size() - 1);
    parentMBMessageId=lastMBMessage.getMessageId();
    subject=lastMBMessage.getSubject();
  }
  long[] recipientUserIds=GetterUtil.getLongValues(StringUtil.split(to));
  return addPrivateMessage(userId,mbThreadId,parentMBMessageId,recipientUserIds,subject,body,files);
}
