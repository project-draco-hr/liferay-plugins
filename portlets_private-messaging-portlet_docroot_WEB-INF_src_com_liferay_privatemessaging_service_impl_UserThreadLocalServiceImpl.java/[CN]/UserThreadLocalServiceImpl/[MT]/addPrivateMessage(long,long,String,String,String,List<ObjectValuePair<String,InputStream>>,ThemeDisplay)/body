{
  long parentMBMessageId=MBMessageConstants.DEFAULT_PARENT_MESSAGE_ID;
  if (mbThreadId != 0) {
    List<MBMessage> mbMessages=MBMessageLocalServiceUtil.getThreadMessages(mbThreadId,WorkflowConstants.STATUS_ANY);
    MBMessage lastMBMessage=mbMessages.get(mbMessages.size() - 1);
    parentMBMessageId=lastMBMessage.getMessageId();
    subject=lastMBMessage.getSubject();
  }
  List<User> recipients=parseRecipients(userId,to);
  if (recipients.isEmpty()) {
    return null;
  }
  return addPrivateMessage(userId,mbThreadId,parentMBMessageId,recipients,subject,body,inputStreamOVPs,themeDisplay);
}
