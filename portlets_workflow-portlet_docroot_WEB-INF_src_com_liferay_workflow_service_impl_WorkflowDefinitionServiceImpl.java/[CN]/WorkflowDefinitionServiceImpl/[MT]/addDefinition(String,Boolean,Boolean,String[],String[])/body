{
  User user=getUser();
  long definitionId=GetterUtil.getLong(workflowComponentService.deploy(xml));
  long companyId=user.getCompanyId();
  String portletId=CompanyConstants.SYSTEM_STRING;
  long groupId=GroupConstants.DEFAULT_PARENT_GROUP_ID;
  long repositoryId=CompanyConstants.SYSTEM;
  String dirName="workflow/definitions";
  String fileName=dirName + "/" + definitionId+ ".xml";
  long fileEntryId=0;
  String properties=StringPool.BLANK;
  Date modifiedDate=new Date();
  ServiceContext serviceContext=new ServiceContext();
  byte[] bytes=xml.getBytes();
  try {
    DLServiceUtil.addDirectory(companyId,repositoryId,dirName);
  }
 catch (  DuplicateDirectoryException dde) {
  }
  DLServiceUtil.addFile(companyId,portletId,groupId,repositoryId,fileName,fileEntryId,properties,modifiedDate,serviceContext,bytes);
  if ((addCommunityPermissions != null) && (addGuestPermissions != null)) {
    addDefinitionResources(user,definitionId,addCommunityPermissions.booleanValue(),addGuestPermissions.booleanValue());
  }
 else {
    addDefinitionResources(user,definitionId,communityPermissions,guestPermissions);
  }
  return getDefinition(definitionId);
}
