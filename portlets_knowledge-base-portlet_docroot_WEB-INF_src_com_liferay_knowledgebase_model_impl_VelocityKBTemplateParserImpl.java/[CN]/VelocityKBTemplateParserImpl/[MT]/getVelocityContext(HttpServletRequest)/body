{
  VelocityContext velocityContext=VelocityEngineUtil.getWrappedStandardToolsContext();
  VelocityVariablesUtil.insertVariables(velocityContext,request);
  KBArticle kbArticle=(KBArticle)request.getAttribute(WebKeys.KNOWLEDGE_BASE_KB_ARTICLE);
  if (kbArticle != null) {
    velocityContext.put("kbArticle",kbArticle);
  }
 else {
    velocityContext.put("kbArticle",new KBArticleImpl());
  }
  String[] restrictedVariables=PortletPropsValues.ADMIN_KB_TEMPLATE_RESTRICTED_VARIABLES;
  for (  String restrictedVariable : restrictedVariables) {
    velocityContext.put(restrictedVariable,StringPool.BLANK);
  }
  return velocityContext;
}
