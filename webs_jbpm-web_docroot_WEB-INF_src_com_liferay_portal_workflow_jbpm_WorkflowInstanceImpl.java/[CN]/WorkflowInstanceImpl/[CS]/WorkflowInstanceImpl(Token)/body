{
  ProcessInstance processInstance=token.getProcessInstance();
  ProcessDefinition processDefinition=processInstance.getProcessDefinition();
  Map<String,Object> context=processInstance.getContextInstance().getVariables(token);
  if (context == null) {
    context=new HashMap<String,Object>();
  }
  Map<String,Serializable> serializables=new HashMap<String,Serializable>();
  for (  Map.Entry<String,Object> contextEntry : context.entrySet()) {
    serializables.put(contextEntry.getKey(),(Serializable)contextEntry.getValue());
  }
  setContext(Collections.unmodifiableMap(serializables));
  setEndDate(token.getEnd());
  setStartDate(token.getStart());
  setState(token.getNode().getName());
  setWorkflowDefinitionName(processDefinition.getName());
  setWorkflowDefinitionVersion(processDefinition.getVersion());
  setWorkflowInstanceId(token.getId());
}
