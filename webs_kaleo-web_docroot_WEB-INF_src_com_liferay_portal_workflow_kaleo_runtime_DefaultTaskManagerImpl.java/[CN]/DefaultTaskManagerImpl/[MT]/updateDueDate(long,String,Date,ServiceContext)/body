{
  try {
    KaleoTaskInstanceToken kaleoTaskInstanceToken=kaleoTaskInstanceTokenLocalService.getKaleoTaskInstanceToken(workflowTaskInstanceId);
    if (kaleoTaskInstanceToken.isCompleted()) {
      throw new WorkflowException("Cannot update due date for completed task " + workflowTaskInstanceId);
    }
    if (dueDate != null) {
      kaleoTaskInstanceTokenLocalService.updateDueDate(workflowTaskInstanceId,dueDate,serviceContext);
    }
    Map<String,Serializable> workflowContext=WorkflowContextUtil.convert(kaleoTaskInstanceToken.getWorkflowContext());
    kaleoLogLocalService.addTaskAssignmentKaleoLog(kaleoTaskInstanceToken,kaleoTaskInstanceToken,comment,workflowContext,serviceContext);
    return new WorkflowTaskAdapter(kaleoTaskInstanceToken,workflowContext);
  }
 catch (  Exception e) {
    throw new WorkflowException(e);
  }
}
