{
  Date now=new Date();
  validate(name);
  portletIds=buildInstanceablePortletIds(portletIds);
  long wsrpProducerId=CounterLocalServiceUtil.increment();
  WSRPProducer wsrpProducer=wsrpProducerPersistence.create(wsrpProducerId);
  wsrpProducer.setCompanyId(companyId);
  wsrpProducer.setCreateDate(now);
  wsrpProducer.setModifiedDate(now);
  wsrpProducer.setName(name);
  wsrpProducer.setPortletIds(portletIds);
  createWSRPCommunity(companyId,userId);
  wsrpProducerPersistence.update(wsrpProducer,false);
  return wsrpProducer;
}
