{
  User user=userPersistence.findByPrimaryKey(userId);
  portletIds=transformPortletIds(portletIds);
  Date now=new Date();
  validate(name);
  long wsrpProducerId=CounterLocalServiceUtil.increment();
  WSRPProducer wsrpProducer=wsrpProducerPersistence.create(wsrpProducerId);
  wsrpProducer.setGroupId(groupId);
  wsrpProducer.setCompanyId(user.getCompanyId());
  wsrpProducer.setCreateDate(now);
  wsrpProducer.setModifiedDate(now);
  wsrpProducer.setName(name);
  wsrpProducer.setVersion(version);
  wsrpProducer.setPortletIds(portletIds);
  if (serviceContext != null) {
    String uuid=serviceContext.getUuid();
    if (Validator.isNotNull(uuid)) {
      wsrpProducer.setUuid(uuid);
    }
  }
  wsrpProducerPersistence.update(wsrpProducer,false);
  return wsrpProducer;
}
