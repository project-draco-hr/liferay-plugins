{
  Map<String,Map<String,Object>> bundles=new HashMap<String,Map<String,Object>>();
  try {
    MBeanServer mBeanServer=ManagementFactory.getPlatformMBeanServer();
    ObjectName objectName=new ObjectName(_BUNDLE_STATE_OBJECT_NAME);
    TabularData tabularData=(TabularData)mBeanServer.invoke(objectName,"listBundles",null,null);
    Collection<CompositeData> values=(Collection<CompositeData>)tabularData.values();
    for (    CompositeData compositeData : values) {
      String state=(String)compositeData.get("State");
      if (!state.equals("ACTIVE")) {
        continue;
      }
      String symbolicName=(String)compositeData.get("SymbolicName");
      String version=(String)compositeData.get("Version");
      if (Validator.isNull(symbolicName) && Validator.isNull(version)) {
        continue;
      }
      Map<String,Object> bundleData=new HashMap<String,Object>();
      bundleData.put("bundleId",compositeData.get("Identifier"));
      bundleData.put("location",compositeData.get("Location"));
      bundleData.put("state",state);
      bundleData.put("version",version);
      bundles.put(symbolicName,bundleData);
    }
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
  return bundles;
}
