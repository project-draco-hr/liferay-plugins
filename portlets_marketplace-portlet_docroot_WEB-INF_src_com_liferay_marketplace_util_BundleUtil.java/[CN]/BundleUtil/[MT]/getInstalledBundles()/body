{
  Map<String,Map> bundles=new HashMap<String,Map>();
  try {
    MBeanServer mBeanServer=ManagementFactory.getPlatformMBeanServer();
    ObjectName objectName=new ObjectName(_BUNDLE_STATE_OBJECT_NAME);
    TabularData data=(TabularData)mBeanServer.invoke(objectName,"listBundles",null,null);
    Collection<CompositeData> values=(Collection<CompositeData>)data.values();
    for (    CompositeData compositeData : values) {
      String state=(String)compositeData.get("State");
      if (!state.equals("ACTIVE")) {
        continue;
      }
      String bundleSymbolicName=(String)compositeData.get("SymbolicName");
      if (Validator.isNull(bundleSymbolicName)) {
        continue;
      }
      Map<String,Object> bundleData=new HashMap<String,Object>();
      bundleData.put("bundleId",compositeData.get("Identifier"));
      bundleData.put("location",compositeData.get("Location"));
      bundleData.put("state",state);
      bundleData.put("version",compositeData.get("Version"));
      bundles.put(bundleSymbolicName,bundleData);
    }
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
  return bundles;
}
