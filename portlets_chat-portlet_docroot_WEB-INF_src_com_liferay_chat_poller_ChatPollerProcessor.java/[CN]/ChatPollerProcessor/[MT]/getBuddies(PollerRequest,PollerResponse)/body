{
  List<Object[]> buddies=BuddyFinderUtil.getBuddies(pollerRequest.getCompanyId(),pollerRequest.getUserId());
  JSONArray buddiesJSONArray=JSONFactoryUtil.createJSONArray();
  for (  Object[] buddy : buddies) {
    long userId=(Long)buddy[0];
    String screenName=(String)buddy[1];
    String firstName=(String)buddy[2];
    String middleName=(String)buddy[3];
    String lastName=(String)buddy[4];
    long portraitId=(Long)buddy[5];
    boolean awake=(Boolean)buddy[6];
    User user=UserLocalServiceUtil.getUser(userId);
    long groupId=user.getGroupId();
    String fullName=ContactConstants.getFullName(firstName,middleName,lastName);
    Status buddyStatus=StatusLocalServiceUtil.getUserStatus(userId);
    awake=buddyStatus.getAwake();
    String statusMessage=buddyStatus.getMessage();
    JSONObject curUserJSONObject=JSONFactoryUtil.createJSONObject();
    curUserJSONObject.put("userId",userId);
    curUserJSONObject.put("groupId",groupId);
    curUserJSONObject.put("screenName",screenName);
    curUserJSONObject.put("fullName",fullName);
    curUserJSONObject.put("portraitId",portraitId);
    curUserJSONObject.put("awake",awake);
    curUserJSONObject.put("statusMessage",statusMessage);
    buddiesJSONArray.put(curUserJSONObject);
  }
  pollerResponse.setParameter("buddies",buddiesJSONArray);
}
