{
  List<Object[]> buddies=BuddyFinderUtil.getBuddies(pollerRequest.getCompanyId(),pollerRequest.getUserId());
  JSONArray buddiesJSONArray=JSONFactoryUtil.createJSONArray();
  for (  Object[] buddy : buddies) {
    String userUuid=(String)buddy[0];
    long userId=(Long)buddy[1];
    String screenName=(String)buddy[2];
    String firstName=(String)buddy[3];
    String middleName=(String)buddy[4];
    String lastName=(String)buddy[5];
    long portraitId=(Long)buddy[6];
    boolean awake=(Boolean)buddy[7];
    JSONObject curUserJSONObject=JSONFactoryUtil.createJSONObject();
    Status buddyStatus=StatusLocalServiceUtil.getUserStatus(userId);
    awake=buddyStatus.getAwake();
    curUserJSONObject.put("awake",awake);
    String fullName=ContactConstants.getFullName(firstName,middleName,lastName);
    curUserJSONObject.put("fullName",fullName);
    User user=UserLocalServiceUtil.getUser(userId);
    curUserJSONObject.put("groupId",user.getGroupId());
    curUserJSONObject.put("portraitId",portraitId);
    String portraitURL=UserConstants.getPortraitURL(StringPool.BLANK,user.isMale(),portraitId,userUuid);
    curUserJSONObject.put("portraitURL",portraitURL);
    curUserJSONObject.put("screenName",screenName);
    String statusMessage=buddyStatus.getMessage();
    curUserJSONObject.put("statusMessage",statusMessage);
    curUserJSONObject.put("userId",userId);
    buddiesJSONArray.put(curUserJSONObject);
  }
  pollerResponse.setParameter("buddies",buddiesJSONArray);
}
