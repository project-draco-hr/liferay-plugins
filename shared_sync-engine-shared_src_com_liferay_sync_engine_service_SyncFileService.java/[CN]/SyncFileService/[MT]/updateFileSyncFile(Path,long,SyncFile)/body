{
  Path deltaFilePath=null;
  String changeLog=String.valueOf(Double.valueOf(syncFile.getVersion()) + .1);
  String name=String.valueOf(filePath.getFileName());
  String sourceChecksum=syncFile.getChecksum();
  String sourceFileName=syncFile.getName();
  String sourceVersion=syncFile.getVersion();
  String targetChecksum=FileUtil.getChecksum(filePath);
  if (!sourceChecksum.equals(targetChecksum) && !IODeltaUtil.isIgnoredFilePatchingExtension(syncFile)) {
    deltaFilePath=Files.createTempFile(String.valueOf(filePath.getFileName()),"tmp");
    IODeltaUtil.delta(filePath,IODeltaUtil.getChecksumsFilePath(syncFile),deltaFilePath);
  }
  syncFile.setChangeLog(changeLog);
  syncFile.setChecksum(targetChecksum);
  syncFile.setFilePathName(FilePathNameUtil.getFilePathName(filePath));
  syncFile.setName(name);
  syncFile.setUiEvent(SyncFile.UI_EVENT_UPDATED_LOCAL);
  update(syncFile);
  Map<String,Object> parameters=new HashMap<String,Object>();
  parameters.put("changeLog",changeLog);
  parameters.put("checksum",targetChecksum);
  parameters.put("description",syncFile.getDescription());
  parameters.put("fileEntryId",syncFile.getTypePK());
  parameters.put("majorVersion",false);
  parameters.put("mimeType",syncFile.getMimeType());
  parameters.put("sourceFileName",name);
  parameters.put("syncFile",syncFile);
  parameters.put("title",name);
  if (!sourceChecksum.equals(targetChecksum)) {
    if ((deltaFilePath != null) && (Files.size(filePath) / Files.size(deltaFilePath)) >= PropsValues.SYNC_FILE_PATCHING_SIZE_RATIO_THRESHOLD) {
      parameters.put("deltaFilePath",deltaFilePath);
      parameters.put("sourceFileName",sourceFileName);
      parameters.put("sourceVersion",sourceVersion);
      PatchFileEntryEvent patchFileEntryEvent=new PatchFileEntryEvent(syncAccountId,parameters);
      patchFileEntryEvent.run();
      return syncFile;
    }
    parameters.put("filePath",filePath);
  }
  UpdateFileEntryEvent updateFileEntryEvent=new UpdateFileEntryEvent(syncAccountId,parameters);
  updateFileEntryEvent.run();
  return syncFile;
}
