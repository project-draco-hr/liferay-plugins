{
  String view=null;
  Boolean decorate=Boolean.TRUE;
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(com.liferay.portal.kernel.util.WebKeys.THEME_DISPLAY);
  try {
    PortletPreferences prefs=renderRequest.getPreferences();
    long nodeId=GetterUtil.getLong(prefs.getValue("node-id",StringPool.BLANK));
    String title=prefs.getValue("title",null);
    String type=prefs.getValue("type",WebKeys.TREE_VIEW);
    int displayDepth=GetterUtil.getInteger(prefs.getValue("displayDepth",StringPool.BLANK));
    String selectedTitle=ParamUtil.getString(renderRequest,"title");
    List<EntryDisplay> entries=Collections.EMPTY_LIST;
    view="view_" + type;
    if (!themeDisplay.getPortletDisplay().isShowConfigurationIcon() && type.equals(WebKeys.MENU_VIEW)) {
      decorate=Boolean.FALSE;
    }
    if (Validator.isNotNull(title)) {
      WikiPage wikiPage=null;
      try {
        wikiPage=WikiPageServiceUtil.getPage(nodeId,title);
      }
 catch (      NoSuchPageException nspe) {
        wikiPage=WikiPageServiceUtil.getPage(nodeId,"FRONT_PAGE");
      }
      entries=_buildNavigationTree(wikiPage,renderResponse.createActionURL());
    }
 else     if (nodeId != 0) {
      int total=WikiPageLocalServiceUtil.getPagesCount(nodeId,true);
      List<WikiPage> wikiPages=WikiPageLocalServiceUtil.getPages(nodeId,true,0,total);
      entries=_buildNavigationTree(wikiPages,themeDisplay.getPermissionChecker(),selectedTitle,renderResponse.createActionURL(),displayDepth,0);
    }
 else {
      view="portlet_not_setup";
      decorate=Boolean.TRUE;
    }
    renderRequest.setAttribute(WebKeys.ENTRIES,entries);
  }
 catch (  NoSuchNodeException nsne) {
    view="portlet_not_setup";
  }
catch (  Exception pe) {
    view="error";
    SessionErrors.add(renderRequest,pe.getClass().getName());
  }
  renderRequest.setAttribute(WebKeys.VIEW,view);
  renderRequest.setAttribute(WebKeys.PORTLET_DECORATE,decorate);
  super.doView(renderRequest,renderResponse);
}
