{
  PortletSession portletSession=actionRequest.getPortletSession();
  String redirectURL=blockingInteractionResponse.getRedirectURL();
  if (Validator.isNotNull(redirectURL)) {
    sendRedirect(actionResponse,redirectURL);
    return;
  }
  UpdateResponse updateResponse=blockingInteractionResponse.getUpdateResponse();
  if (updateResponse == null) {
    return;
  }
  portletSession.setAttribute(WebKeys.MARKUP_CONTEXT,updateResponse.getMarkupContext());
  NavigationalContext navigationalContext=updateResponse.getNavigationalContext();
  if (navigationalContext != null) {
    String opaqueValue=navigationalContext.getOpaqueValue();
    if (opaqueValue != null) {
      actionResponse.setRenderParameter("wsrp-navigationalState",opaqueValue);
    }
    NamedString[] publicValues=navigationalContext.getPublicValues();
    if ((publicValues != null) && (publicValues.length > 0)) {
      int lastIndex=publicValues.length - 2;
      StringBuilder sb=new StringBuilder();
      for (int i=0; i < publicValues.length; i++) {
        NamedString publicValue=publicValues[i];
        sb.append(publicValue.getName());
        String value=publicValue.getValue();
        if (Validator.isNotNull(value)) {
          sb.append(StringPool.EQUAL);
          sb.append(publicValue.getValue());
        }
        if (i < lastIndex) {
          sb.append(StringPool.AMPERSAND);
        }
      }
      actionResponse.setRenderParameter("wsrp-navigationalValues",sb.toString());
    }
  }
  PortletContext portletContext=updateResponse.getPortletContext();
  if (portletContext != null) {
    portletSession.setAttribute(WebKeys.PORTLET_CONTEXT,portletContext);
  }
  SessionContext sessionContext=updateResponse.getSessionContext();
  if (sessionContext != null) {
    portletSession.setAttribute(WebKeys.SESSION_CONTEXT,sessionContext);
  }
  String portletMode=updateResponse.getNewMode();
  if (Validator.isNotNull(portletMode)) {
    actionResponse.setPortletMode(getPortletMode(portletMode));
  }
  String windowState=updateResponse.getNewWindowState();
  if (Validator.isNotNull(windowState)) {
    actionResponse.setWindowState(getWindowState(windowState));
  }
}
