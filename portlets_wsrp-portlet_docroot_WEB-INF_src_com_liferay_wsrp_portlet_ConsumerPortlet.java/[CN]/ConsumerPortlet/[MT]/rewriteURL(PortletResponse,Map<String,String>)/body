{
  LiferayPortletResponse liferayPortletResponse=(LiferayPortletResponse)portletResponse;
  String lifecycle=parameterMap.get("wsrp-urlType");
  LiferayPortletURL liferayPortletURL=null;
  if (lifecycle.equals("blockingAction")) {
    liferayPortletURL=(LiferayPortletURL)liferayPortletResponse.createActionURL();
  }
 else   if (lifecycle.equals("render")) {
    liferayPortletURL=(LiferayPortletURL)liferayPortletResponse.createRenderURL();
  }
 else   if (lifecycle.equals("resource")) {
    liferayPortletURL=(LiferayPortletURL)liferayPortletResponse.createResourceURL();
  }
  boolean encodeURL=false;
  for (  Map.Entry<String,String> parameter : parameterMap.entrySet()) {
    String name=parameter.getKey();
    String value=parameter.getValue();
    if (name.equals("wsrp-extensions") && value.equals("encodeURL")) {
      encodeURL=true;
    }
 else     if (name.equals("wsrp-mode")) {
      liferayPortletURL.setPortletMode(getPortletMode(value));
    }
 else     if (name.equals("wsrp-navigationalValues")) {
      Matcher navigationalValuesMatcher=_navigationalValuesPattern.matcher(value);
      while (navigationalValuesMatcher.find()) {
        String navigationalValuesName=navigationalValuesMatcher.group(1);
        String navigationalValuesValue=navigationalValuesMatcher.group(2);
        if (Validator.isNull(navigationalValuesValue)) {
          liferayPortletURL.removePublicRenderParameter(navigationalValuesName);
        }
 else {
          liferayPortletURL.setParameter(navigationalValuesName,navigationalValuesValue,true);
        }
      }
    }
 else     if (name.equals("wsrp-resourceID")) {
      liferayPortletURL.setResourceID(value);
    }
 else     if (name.equals("wsrp-urlType")) {
    }
 else     if (name.equals("wsrp-windowState")) {
      liferayPortletURL.setWindowState(getWindowState(value));
    }
 else {
      liferayPortletURL.setParameter(name,value);
    }
  }
  String url=liferayPortletURL.toString();
  if (encodeURL) {
    url=HttpUtil.encodeURL(url);
  }
  return url;
}
