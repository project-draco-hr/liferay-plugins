{
  List<KaleoTaskAssignmentInstance> kaleoTaskAssignmentInstances=new ArrayList<KaleoTaskAssignmentInstance>(kaleoTaskAssignments.size());
  for (  KaleoTaskAssignment kaleoTaskAssignment : kaleoTaskAssignments) {
    String assigneeClassName=kaleoTaskAssignment.getAssigneeClassName();
    if (assigneeClassName.equals(ResourceAction.class.getName())) {
      String entryClassName=(String)workflowContext.get(WorkflowConstants.CONTEXT_ENTRY_CLASS_NAME);
      String entryClassPK=(String)workflowContext.get(WorkflowConstants.CONTEXT_ENTRY_CLASS_PK);
      String assigneeActionId=kaleoTaskAssignment.getAssigneeActionId();
      setResourceAssignees(entryClassName,entryClassPK,assigneeActionId,kaleoTaskInstanceToken,serviceContext);
      continue;
    }
    User user=userPersistence.findByPrimaryKey(serviceContext.getUserId());
    Date now=new Date();
    long kaleoTaskAssignmentInstanceId=counterLocalService.increment();
    KaleoTaskAssignmentInstance kaleoTaskAssignmentInstance=kaleoTaskAssignmentInstancePersistence.create(kaleoTaskAssignmentInstanceId);
    kaleoTaskAssignmentInstance.setGroupId(kaleoTaskInstanceToken.getGroupId());
    kaleoTaskAssignmentInstance.setCompanyId(user.getCompanyId());
    kaleoTaskAssignmentInstance.setUserId(user.getUserId());
    kaleoTaskAssignmentInstance.setUserName(user.getFullName());
    kaleoTaskAssignmentInstance.setCreateDate(now);
    kaleoTaskAssignmentInstance.setModifiedDate(now);
    kaleoTaskAssignmentInstance.setKaleoDefinitionId(kaleoTaskInstanceToken.getKaleoDefinitionId());
    kaleoTaskAssignmentInstance.setKaleoInstanceId(kaleoTaskInstanceToken.getKaleoInstanceId());
    kaleoTaskAssignmentInstance.setKaleoTaskInstanceTokenId(kaleoTaskInstanceToken.getKaleoTaskInstanceTokenId());
    kaleoTaskAssignmentInstance.setKaleoTaskId(kaleoTaskInstanceToken.getKaleoTaskId());
    kaleoTaskAssignmentInstance.setKaleoTaskName(kaleoTaskInstanceToken.getKaleoTaskName());
    kaleoTaskAssignmentInstance.setAssigneeClassName(assigneeClassName);
    if ((kaleoTaskAssignment.getAssigneeClassPK() == 0) && assigneeClassName.equals(User.class.getName())) {
      KaleoInstance kaleoInstance=kaleoInstanceLocalService.getKaleoInstance(kaleoTaskInstanceToken.getKaleoInstanceId());
      kaleoTaskAssignmentInstance.setAssigneeClassPK(kaleoInstance.getUserId());
    }
 else {
      kaleoTaskAssignmentInstance.setAssigneeClassPK(kaleoTaskAssignment.getAssigneeClassPK());
    }
    kaleoTaskAssignmentInstancePersistence.update(kaleoTaskAssignmentInstance,false);
    kaleoTaskAssignmentInstances.add(kaleoTaskAssignmentInstance);
  }
  return kaleoTaskAssignmentInstances;
}
