{
  Criteria criteria=_session.createCriteria(ProcessInstanceExtensionImpl.class);
  criteria.add(Restrictions.eq("companyId",companyId));
  if (userId != null) {
    criteria.add(Restrictions.eq("userId",userId));
  }
  if (Validator.isNotNull(assetClassName)) {
    criteria.add(Restrictions.like("className",assetClassName));
  }
  if (Validator.isNotNull(assetClassPK)) {
    criteria.add(Restrictions.eq("classPK",assetClassPK));
  }
  if (completed != null) {
    Criteria completionCriteria=criteria.createCriteria("processInstance");
    if (completed) {
      completionCriteria.add(Restrictions.isNotNull("end"));
    }
 else {
      completionCriteria.add(Restrictions.isNull("end"));
    }
  }
  return criteria;
}
