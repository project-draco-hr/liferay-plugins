{
  try {
    Criteria criteria=_session.createCriteria(ProcessDefinition.class);
    if (latest) {
      ProjectionList projectionList=Projections.projectionList();
      projectionList.add(Projections.groupProperty("name"));
      projectionList.add(Projections.max("version"));
      criteria.setProjection(projectionList);
      addOrder(criteria,orderByComparator,"version");
    }
    if (name != null) {
      criteria.add(Restrictions.eq("name",name));
      addOrder(criteria,orderByComparator,"name");
    }
    if (latest == false && name == null) {
      addOrder(criteria,orderByComparator);
    }
    addPagination(criteria,start,end);
    if (latest) {
      List<Object[]> list=criteria.list();
      List<String> names=new ArrayList<String>(list.size());
      for (      Object[] array : list) {
        names.add((String)array[0]);
      }
      return findProcessDefinitions(names);
    }
 else {
      return criteria.list();
    }
  }
 catch (  Exception e) {
    throw new JbpmException(e);
  }
}
