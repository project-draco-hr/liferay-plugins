{
  long userIdLong=GetterUtil.getLong(userId.getUserId(securityToken));
  User user=UserLocalServiceUtil.getUserById(userIdLong);
  Group group=user.getGroup();
  long groupIdLong=group.getGroupId();
  DLFolder dlFolder=DLAppLocalServiceUtil.getFolder(GetterUtil.getLong(albumId));
  dlFolder.setDescription(album.getDescription());
  dlFolder.setName(album.getTitle());
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddCommunityPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  serviceContext.setScopeGroupId(groupIdLong);
  if (albumId == null) {
    DLAppLocalServiceUtil.addFolder(userIdLong,groupIdLong,DLFolderConstants.DEFAULT_PARENT_FOLDER_ID,album.getTitle(),album.getDescription(),serviceContext);
  }
 else {
    DLAppLocalServiceUtil.updateFolder(dlFolder.getFolderId(),dlFolder.getParentFolderId(),dlFolder.getName(),dlFolder.getDescription(),serviceContext);
  }
}
