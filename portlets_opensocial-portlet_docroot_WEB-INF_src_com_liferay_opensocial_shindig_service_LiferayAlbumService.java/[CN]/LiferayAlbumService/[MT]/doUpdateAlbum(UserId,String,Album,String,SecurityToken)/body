{
  long userIdLong=GetterUtil.getLong(userId.getUserId(securityToken));
  User user=UserLocalServiceUtil.getUserById(userIdLong);
  Group group=user.getGroup();
  long groupIdLong=group.getGroupId();
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddCommunityPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  serviceContext.setScopeGroupId(groupIdLong);
  if (albumId == null) {
    DLAppLocalServiceUtil.addFolder(userIdLong,groupIdLong,DLFolderConstants.DEFAULT_PARENT_FOLDER_ID,album.getTitle(),album.getDescription(),serviceContext);
  }
 else {
    Folder folder=DLAppLocalServiceUtil.getFolder(GetterUtil.getLong(albumId));
    DLAppLocalServiceUtil.updateFolder(folder.getFolderId(),folder.getParentFolderId(),album.getTitle(),album.getDescription(),serviceContext);
  }
}
