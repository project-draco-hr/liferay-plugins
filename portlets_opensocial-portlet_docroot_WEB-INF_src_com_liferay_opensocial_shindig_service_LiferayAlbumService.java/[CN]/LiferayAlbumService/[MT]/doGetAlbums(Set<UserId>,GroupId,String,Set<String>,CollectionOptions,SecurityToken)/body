{
  List<Album> albums=new ArrayList<Album>();
  for (  UserId userId : userIds) {
    String userIdString=userId.getUserId(securityToken);
    long userIdLong=GetterUtil.getLong(userIdString);
    User user=UserLocalServiceUtil.getUserById(userIdLong);
    List<DLFolder> dlFolders=new ArrayList<DLFolder>();
    GroupId.Type groupIdType=groupId.getType();
    if (groupIdType.equals(GroupId.Type.all) || groupIdType.equals(GroupId.Type.friends) || groupIdType.equals(GroupId.Type.groupId)) {
      List<User> socialUsers=UserLocalServiceUtil.getSocialUsers(user.getUserId(),SocialRelationConstants.TYPE_BI_FRIEND,QueryUtil.ALL_POS,QueryUtil.ALL_POS,null);
      for (      User socialUser : socialUsers) {
        Group group=socialUser.getGroup();
        List<DLFolder> friendDLFolders=DLAppLocalServiceUtil.getFolders(group.getGroupId(),DLFolderConstants.DEFAULT_PARENT_FOLDER_ID);
        dlFolders.addAll(friendDLFolders);
      }
    }
 else     if (groupIdType.equals(GroupId.Type.self)) {
      Group group=user.getGroup();
      dlFolders=DLAppLocalServiceUtil.getFolders(group.getGroupId(),DLFolderConstants.DEFAULT_PARENT_FOLDER_ID);
    }
    for (    DLFolder dlFolder : dlFolders) {
      Album album=new AlbumImpl();
      album.setDescription(dlFolder.getDescription());
      album.setId(Long.toString(dlFolder.getFolderId()));
      album.setOwnerId(Long.toString(dlFolder.getUserId()));
      album.setTitle(dlFolder.getName());
      albums.add(album);
    }
  }
  return new RestfulCollection<Album>(albums,collectionOptions.getFirst(),albums.size(),collectionOptions.getMax());
}
