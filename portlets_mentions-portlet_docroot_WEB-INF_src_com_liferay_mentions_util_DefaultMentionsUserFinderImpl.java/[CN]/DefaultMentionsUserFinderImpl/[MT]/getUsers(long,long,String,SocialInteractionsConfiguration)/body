{
  if (!configuration.isSocialInteractionsEnabled()) {
    return Collections.emptyList();
  }
  if (configuration.isSocialInteractionsAnyUserEnabled()) {
    LinkedHashMap<String,Object> params=new LinkedHashMap<String,Object>();
    params.put("wildcardMode",WildcardMode.TRAILING);
    return UserLocalServiceUtil.search(companyId,query,WorkflowConstants.STATUS_APPROVED,params,0,_MAX_USERS,new UserScreenNameComparator());
  }
  int[] types=getRelationTypes(configuration);
  long[] groupIds=getGroupIds(userId,configuration);
  boolean searchBySocialRelation=configuration.isSocialInteractionsSocialRelationTypesEnabled() && types.length > 0;
  boolean searchByGroup=configuration.isSocialInteractionsSitesEnabled() && groupIds.length > 0;
  if (searchBySocialRelation && searchByGroup) {
    return UserLocalServiceUtil.searchSocial(groupIds,userId,types,query,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  }
  if (searchByGroup) {
    return UserLocalServiceUtil.searchSocial(companyId,groupIds,query,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  }
  if (searchBySocialRelation) {
    return UserLocalServiceUtil.searchSocial(userId,types,query,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  }
  return Collections.emptyList();
}
