{
  long syncDLFileVersionDiffId=counterLocalService.increment();
  SyncDLFileVersionDiff syncDLFileVersionDiff=syncDLFileVersionDiffPersistence.create(syncDLFileVersionDiffId);
  syncDLFileVersionDiff.setFileEntryId(fileEntryId);
  syncDLFileVersionDiff.setSourceFileVersionId(sourceFileVersionId);
  syncDLFileVersionDiff.setTargetFileVersionId(targetFileVersionId);
  Company company=companyLocalService.getCompanyByMx(PropsUtil.get(PropsKeys.COMPANY_DEFAULT_WEB_ID));
  Group group=company.getGroup();
  FileEntry fileEntry=dlAppService.getFileEntry(fileEntryId);
  String dataFileName=getDataFileName(fileEntryId,sourceFileVersionId,targetFileVersionId);
  FileEntry dataFileEntry=PortletFileRepositoryUtil.addPortletFileEntry(group.getGroupId(),fileEntry.getUserId(),SyncDLFileVersionDiff.class.getName(),syncDLFileVersionDiff.getSyncDLFileVersionDiffId(),PortletKeys.DOCUMENT_LIBRARY,DLFolderConstants.DEFAULT_PARENT_FOLDER_ID,file,dataFileName,fileEntry.getMimeType(),false);
  syncDLFileVersionDiff.setDataFileEntryId(dataFileEntry.getFileEntryId());
  syncDLFileVersionDiff.setSize(file.length());
  Date expirationDate=new Date();
  expirationDate.setTime(expirationDate.getTime() + PortletPropsValues.SYNC_FILE_DIFF_CACHE_EXPIRATION_TIME * 3600000);
  syncDLFileVersionDiff.setExpirationDate(expirationDate);
  syncDLFileVersionDiffPersistence.update(syncDLFileVersionDiff);
  return syncDLFileVersionDiff;
}
