{
  QueryTranslatorUtil.translateForSolr(query);
  String queryString=query.toString();
  StringBundler sb=new StringBundler(queryString);
  sb.append(StringPool.SPACE);
  sb.append(StringPool.PLUS);
  sb.append(Field.COMPANY_ID);
  sb.append(StringPool.COLON);
  sb.append(companyId);
  QueryConfig queryConfig=query.getQueryConfig();
  SolrQuery solrQuery=new SolrQuery();
  solrQuery.setHighlight(queryConfig.isHighlightEnabled());
  solrQuery.setHighlightFragsize(queryConfig.getHighlightFragmentSize());
  solrQuery.setHighlightSnippets(queryConfig.getHighlightSnippetSize());
  solrQuery.setIncludeScore(queryConfig.isScoreEnabled());
  solrQuery.setQuery(sb.toString());
  if ((start == QueryUtil.ALL_POS) && (end == QueryUtil.ALL_POS)) {
    solrQuery.setRows(0);
  }
 else {
    solrQuery.setRows(end - start);
    solrQuery.setStart(start);
  }
  if ((sorts != null) && (sorts.length > 0)) {
    for (    Sort sort : sorts) {
      if (sort == null) {
        continue;
      }
      String sortFieldName=sort.getFieldName();
      if (ArrayUtil.contains(PortletPropsValues.SOLR_SORTABLE_TEXT_FIELDS,sortFieldName)) {
        sortFieldName=GetterUtil.getString(PortletProps.get(PortletPropsKeys.SOLR_COPY_FIELDS,new Filter(sortFieldName)));
      }
      ORDER order=ORDER.asc;
      if (sortFieldName == null) {
        sortFieldName="score";
        order=ORDER.desc;
      }
 else       if (sort.isReverse()) {
        order=ORDER.desc;
      }
      solrQuery.addSortField(sortFieldName,order);
    }
  }
  return solrQuery;
}
