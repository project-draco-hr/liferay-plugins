{
  try {
    if (connection == null) {
      connection=getConnection(userId);
      if (connection == null) {
        if (_log.isWarnEnabled()) {
          _log.warn("User " + userId + " is not connected to Jabber");
        }
        return;
      }
    }
    if (online == 1 && (!_isOnline.contains(userId))) {
      Presence presence=new Presence(Presence.Type.available);
      connection.sendPacket(presence);
      _isOnline.add(userId);
    }
 else     if (online == 0 && (_isOnline.contains(userId))) {
      Presence presence=new Presence(Presence.Type.unavailable);
      connection.sendPacket(presence);
      _isOnline.remove(userId);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
