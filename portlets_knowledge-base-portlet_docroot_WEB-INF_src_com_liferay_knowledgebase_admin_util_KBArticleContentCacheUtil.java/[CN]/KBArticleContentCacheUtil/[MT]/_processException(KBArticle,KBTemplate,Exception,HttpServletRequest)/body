{
  String key=null;
  String value=null;
  if (kbTemplate.isFreeMarker()) {
    key=PortletPropsKeys.ADMIN_KB_TEMPLATE_ERROR_FREEMARKER;
    value=PortletPropsValues.ADMIN_KB_TEMPLATE_ERROR_FREEMARKER;
  }
 else   if (kbTemplate.isVelocity()) {
    key=PortletPropsKeys.ADMIN_KB_TEMPLATE_ERROR_VELOCITY;
    value=PortletPropsValues.ADMIN_KB_TEMPLATE_ERROR_VELOCITY;
  }
  String exception=e.getMessage();
  if (Validator.isNull(exception)) {
    exception=e.getClass().getName();
  }
  Map<String,Object> variables=new HashMap<String,Object>();
  variables.put("exception",exception);
  variables.put("kbTemplate",kbTemplate);
  try {
    KBTemplateParser kbTemplateParser=AdminUtil.getKBTemplateParser(kbTemplate.getEngineType());
    return kbTemplateParser.transform(key,ContentUtil.get(value),variables,request);
  }
 catch (  Exception e1) {
    return kbArticle.getContent();
  }
}
