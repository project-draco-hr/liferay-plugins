{
  String body=null;
  long userId=0;
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject(userNotificationEvent.getPayload());
  long classPK=jsonObject.getLong("classPK");
  MBMessage mbMessage=MBMessageLocalServiceUtil.fetchMBMessage(classPK);
  if (mbMessage == null) {
    body=jsonObject.getString("body");
    if (Validator.isNull(body)) {
      UserNotificationEventLocalServiceUtil.deleteUserNotificationEvent(userNotificationEvent.getUserNotificationEventId());
      return null;
    }
    userId=jsonObject.getLong("userId");
  }
 else {
    body=mbMessage.getBody();
    userId=mbMessage.getUserId();
  }
  StringBundler sb=new StringBundler(5);
  sb.append("<div class=\"title\">");
  sb.append(serviceContext.translate("x-sent-you-a-message",PortalUtil.getUserName(userId,StringPool.BLANK)));
  sb.append("</div><div class=\"body\">");
  sb.append(HtmlUtil.escape(StringUtil.shorten(body)));
  sb.append("</div>");
  return sb.toString();
}
