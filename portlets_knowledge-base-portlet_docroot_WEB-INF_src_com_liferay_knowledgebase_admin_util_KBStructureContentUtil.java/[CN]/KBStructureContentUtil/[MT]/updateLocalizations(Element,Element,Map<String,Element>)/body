{
  for (  Map.Entry<String,Element> entry : elements.entrySet()) {
    Element oldKBStructureContentElement=entry.getValue();
    Element newKBStructureContentElement=oldKBStructureContentElement.createCopy();
    for (    Element newKBStructureFieldElement : newKBStructureContentElement.elements()) {
      newKBStructureFieldElement.detach();
    }
    for (    Element defaultKBStructureFieldElement : defaultKBStructureContentElement.elements()) {
      String defaultKBStructureFieldId=defaultKBStructureFieldElement.attributeValue("kb-structure-field-id");
      Element oldKBStructureFieldElement=(Element)oldKBStructureContentElement.selectSingleNode("kb-structure-field[@kb-structure-field-id='" + defaultKBStructureFieldId + "']");
      if (oldKBStructureFieldElement == null) {
        newKBStructureContentElement.add(defaultKBStructureFieldElement.createCopy());
        continue;
      }
      Element newKBStructureFieldElement=oldKBStructureFieldElement.createCopy();
      for (      Element newKBStructureOptionElement : newKBStructureFieldElement.elements()) {
        newKBStructureOptionElement.detach();
      }
      for (      Element defaultKBStructureOptionElement : defaultKBStructureFieldElement.elements()) {
        String defaultKBStructureOptionId=defaultKBStructureOptionElement.attributeValue("kb-structure-option-id");
        Element oldKBStructureOptionElement=(Element)oldKBStructureFieldElement.selectSingleNode("kb-structure-option[@kb-structure-option-id='" + defaultKBStructureOptionId + "']");
        if (oldKBStructureOptionElement == null) {
          newKBStructureFieldElement.add(defaultKBStructureOptionElement.createCopy());
        }
 else {
          newKBStructureFieldElement.add(oldKBStructureOptionElement.createCopy());
        }
      }
      newKBStructureContentElement.add(newKBStructureFieldElement);
    }
    rootElement.add(newKBStructureContentElement);
  }
  return rootElement;
}
