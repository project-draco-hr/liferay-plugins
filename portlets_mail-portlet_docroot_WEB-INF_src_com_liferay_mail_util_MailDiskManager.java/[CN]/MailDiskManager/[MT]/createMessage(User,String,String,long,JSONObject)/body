{
  if (!isAccountExists(user,emailAddress)) {
    return;
  }
  String filePath=getMessageFilePath(user,emailAddress,folderName,messageUid);
  try {
    FileUtil.write(filePath,message.toString());
  }
 catch (  IOException ioe) {
    _log.error(ioe,ioe);
  }
  String subject=message.getString("subject");
  String body=message.getString("body");
  try {
    Indexer indexer=IndexerRegistryUtil.getIndexer(MessageEntry.class);
    MessageEntry entry=new MessageEntry(user.getCompanyId(),user.getGroup().getGroupId(),user.getUserId(),emailAddress,_encodeFolderName(folderName),messageUid,subject,body);
    indexer.reindex(entry);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
