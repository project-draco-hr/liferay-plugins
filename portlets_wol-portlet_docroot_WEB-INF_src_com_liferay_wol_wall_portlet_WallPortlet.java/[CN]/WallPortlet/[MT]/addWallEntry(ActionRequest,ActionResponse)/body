{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  if (!themeDisplay.isSignedIn()) {
    return;
  }
  Group group=GroupLocalServiceUtil.getGroup(themeDisplay.getPortletGroupId());
  User user=null;
  if (group.isUser()) {
    user=UserLocalServiceUtil.getUserById(group.getClassPK());
  }
 else {
    return;
  }
  if ((themeDisplay.getUserId() != user.getUserId()) && (!SocialRelationLocalServiceUtil.hasRelation(themeDisplay.getUserId(),user.getUserId(),SocialRelationConstants.TYPE_BI_FRIEND))) {
    return;
  }
  String comments=ParamUtil.getString(actionRequest,"comments");
  WallEntryLocalServiceUtil.addWallEntry(themeDisplay.getPortletGroupId(),themeDisplay.getUserId(),comments,themeDisplay);
}
