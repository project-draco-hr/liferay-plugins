{
  User user=userPersistence.findByPrimaryKey(userId);
  if (receiverUserId == 0) {
    receiverUserId=userId;
  }
  Date now=new Date();
  validate(type,receiverMicroblogsEntryId);
  long microblogsEntryId=counterLocalService.increment();
  if (receiverMicroblogsEntryId == 0) {
    receiverMicroblogsEntryId=microblogsEntryId;
  }
  MicroblogsEntry microblogsEntry=microblogsEntryPersistence.create(microblogsEntryId);
  microblogsEntry.setCompanyId(user.getCompanyId());
  microblogsEntry.setUserId(user.getUserId());
  microblogsEntry.setUserName(user.getFullName());
  microblogsEntry.setCreateDate(now);
  microblogsEntry.setModifiedDate(now);
  microblogsEntry.setCreatorClassNameId(creatorClassNameId);
  microblogsEntry.setCreatorClassPK(creatorClassPK);
  microblogsEntry.setContent(content);
  microblogsEntry.setType(type);
  microblogsEntry.setReceiverUserId(receiverUserId);
  microblogsEntry.setReceiverMicroblogsEntryId(receiverMicroblogsEntryId);
  microblogsEntry.setSocialRelationType(socialRelationType);
  microblogsEntryPersistence.update(microblogsEntry);
  resourceLocalService.addModelResources(microblogsEntry,serviceContext);
  updateAsset(microblogsEntry,serviceContext.getAssetCategoryIds(),serviceContext.getAssetTagNames());
  return microblogsEntry;
}
