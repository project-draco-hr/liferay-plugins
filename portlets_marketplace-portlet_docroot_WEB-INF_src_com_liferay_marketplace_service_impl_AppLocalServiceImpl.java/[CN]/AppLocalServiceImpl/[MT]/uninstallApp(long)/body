{
  App app=appPersistence.findByMarketplaceAppId(marketplaceAppId);
  List<Module> modules=moduleLocalService.getAppModules(app.getAppId());
  String appServerType=ServerDetector.getServerId();
  boolean jbossAppServer=appServerType.startsWith(ServerDetector.JBOSS_ID);
  for (  Module module : modules) {
    String context=module.getContextName();
    if (hasDependentApp(module)) {
      continue;
    }
    try {
      DeployManagerUtil.undeploy(context);
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
 finally {
      moduleLocalService.deleteModule(module.getModuleId());
    }
  }
}
