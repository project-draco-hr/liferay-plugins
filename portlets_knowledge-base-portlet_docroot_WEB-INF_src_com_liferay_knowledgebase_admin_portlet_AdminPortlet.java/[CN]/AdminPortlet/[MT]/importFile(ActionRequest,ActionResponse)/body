{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  String fileName=uploadPortletRequest.getFileName("file");
  if (Validator.isNull(fileName)) {
    throw new KBArticleImportException("No import filename");
  }
  InputStream inputStream=null;
  try {
    inputStream=uploadPortletRequest.getFileAsStream("file");
    ServiceContext serviceContext=ServiceContextFactory.getInstance(AdminPortlet.class.getName(),actionRequest);
    serviceContext.setGuestPermissions(new String[]{ActionKeys.VIEW});
    KBArticleHierarchyImporter kbArticleHierarchyImporter=new KBArticleHierarchyImporter();
    kbArticleHierarchyImporter.processZipFile(themeDisplay.getUserId(),themeDisplay.getScopeGroupId(),fileName,inputStream,new HashMap<String,FileEntry>(),serviceContext);
  }
 catch (  KBArticleImportException kbaie) {
    SessionErrors.add(actionRequest,kbaie.getClass(),kbaie);
  }
 finally {
    StreamUtil.cleanUp(inputStream);
  }
}
