{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  long parentKBFolderId=ParamUtil.getLong(uploadPortletRequest,"parentKBFolderId",KBFolderConstants.DEFAULT_PARENT_FOLDER_ID);
  String fileName=uploadPortletRequest.getFileName("file");
  if (Validator.isNull(fileName)) {
    throw new KBArticleImportException("File name is null");
  }
  InputStream inputStream=null;
  try {
    inputStream=uploadPortletRequest.getFileAsStream("file");
    ServiceContext serviceContext=ServiceContextFactory.getInstance(AdminPortlet.class.getName(),actionRequest);
    serviceContext.setGuestPermissions(new String[]{ActionKeys.VIEW});
    int kbArticleCount=KBArticleServiceUtil.addKBArticlesMarkdown(themeDisplay.getScopeGroupId(),parentKBFolderId,fileName,inputStream,serviceContext);
    SessionMessages.add(actionRequest,"aTotalOfXArticlesHaveBeenImported",kbArticleCount);
  }
 catch (  KBArticleImportException kbaie) {
    SessionErrors.add(actionRequest,kbaie.getClass(),kbaie);
  }
 finally {
    StreamUtil.cleanUp(inputStream);
  }
}
