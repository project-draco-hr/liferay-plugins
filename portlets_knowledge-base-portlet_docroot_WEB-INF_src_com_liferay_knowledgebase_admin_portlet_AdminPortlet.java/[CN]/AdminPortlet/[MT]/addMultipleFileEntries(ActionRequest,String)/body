{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long resourcePrimKey=ParamUtil.getLong(actionRequest,"resourcePrimKey");
  FileEntry tempFileEntry=null;
  try {
    tempFileEntry=TempFileUtil.getTempFile(themeDisplay.getScopeGroupId(),themeDisplay.getUserId(),selectedFileName,_TEMP_FOLDER_NAME);
    InputStream inputStream=tempFileEntry.getContentStream();
    String mimeType=tempFileEntry.getMimeType();
    KBArticleServiceUtil.addAttachment(resourcePrimKey,selectedFileName,inputStream,mimeType);
  }
  finally {
    if (tempFileEntry != null) {
      TempFileUtil.deleteTempFile(tempFileEntry.getFileEntryId());
    }
  }
}
