{
  JbpmContext jbpmContext=_jbpmConfiguration.getCurrentJbpmContext();
  String className=(String)workflowContext.get(WorkflowConstants.CONTEXT_ENTRY_CLASS_NAME);
  long classPK=GetterUtil.getLong((String)workflowContext.get(WorkflowConstants.CONTEXT_ENTRY_CLASS_PK));
  ProcessInstanceExtensionImpl processInstanceExtensionImpl=new ProcessInstanceExtensionImpl(companyId,groupId,userId,className,classPK,processInstance);
  Session session=jbpmContext.getSession();
  session.save(processInstanceExtensionImpl);
  TaskMgmtInstance taskMgmtInstance=processInstance.getTaskMgmtInstance();
  Collection<TaskInstance> taskInstances=taskMgmtInstance.getTaskInstances();
  if (taskInstances != null) {
    for (    TaskInstance taskInstance : taskInstances) {
      List<Assignee> assignees=AssigneeRetrievalUtil.getAssignees(companyId,groupId,taskInstance.getActorId(),taskInstance.getPooledActors());
      String context=WorkflowContextUtil.convertToJSON(workflowContext);
      TaskInstanceExtensionImpl taskInstanceExtensionImpl=new TaskInstanceExtensionImpl(companyId,groupId,userId,assignees,context,taskInstance);
      session.save(taskInstanceExtensionImpl);
    }
  }
}
