{
  JSONArray jsonArray=JSONFactoryUtil.createJSONArray();
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
  SocialInteractionsConfiguration socialInteractionsConfiguration=SocialInteractionsConfigurationUtil.getSocialInteractionsConfiguration(themeDisplay.getCompanyId(),portletDisplay.getId());
  String query=ParamUtil.getString(request,"query");
  List<User> users=MentionsUserFinderUtil.getUsers(themeDisplay.getCompanyId(),themeDisplay.getUserId(),query,socialInteractionsConfiguration);
  for (  User user : users) {
    if (user.isDefaultUser() || (themeDisplay.getUserId() == user.getUserId())) {
      continue;
    }
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
    jsonObject.put("fullName",user.getFullName());
    jsonObject.put("portraitURL",user.getPortraitURL(themeDisplay));
    String screenName=user.getScreenName();
    String mention="@".concat(screenName);
    String profileURL=user.getDisplayURL(themeDisplay);
    if (Validator.isNotNull(profileURL)) {
      mention="<a href=\"" + profileURL + "\">@"+ screenName+ "</a>";
    }
    jsonObject.put("mention",mention);
    jsonObject.put("screenName",screenName);
    jsonArray.put(jsonObject);
  }
  return jsonArray;
}
