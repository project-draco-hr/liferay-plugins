{
  List<Group> userRelatedGroups=new ArrayList<Group>();
  userRelatedGroups.addAll(user.getGroups());
  userRelatedGroups.addAll(GroupLocalServiceUtil.getOrganizationsGroups(user.getOrganizations()));
  userRelatedGroups.addAll(GroupLocalServiceUtil.getOrganizationsRelatedGroups(user.getOrganizations()));
  userRelatedGroups.addAll(GroupLocalServiceUtil.getUserGroupsGroups(user.getUserGroups()));
  userRelatedGroups.addAll(GroupLocalServiceUtil.getUserGroupsRelatedGroups(user.getUserGroups()));
  List<Long> userRelatedRoleIds=new ArrayList<Long>();
  for (  Group group : userRelatedGroups) {
    if (group.isUserGroup()) {
      List<UserGroupGroupRole> userGroupGroupRoles=UserGroupGroupRoleLocalServiceUtil.getUserGroupGroupRoles(group.getClassPK());
      for (      UserGroupGroupRole userGroupGroupRole : userGroupGroupRoles) {
        roleIds.add(userGroupGroupRole.getRoleId());
      }
    }
 else {
      List<Role> groupRoles=RoleLocalServiceUtil.getGroupRoles(group.getGroupId());
      for (      Role role : groupRoles) {
        roleIds.add(role.getRoleId());
      }
    }
  }
  return roleIds;
}
