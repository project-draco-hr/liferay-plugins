{
  Status status=statusPersistence.fetchByUserId(userId);
  if (status == null) {
    long statusId=counterLocalService.increment();
    status=statusPersistence.create(statusId);
    status.setUserId(userId);
  }
  if (modifiedDate != -1) {
    status.setModifiedDate(modifiedDate);
  }
  if (online != -1) {
    status.setOnline((online == 1) ? true : false);
  }
  if (awake != -1) {
    status.setAwake((awake == 1) ? true : false);
  }
  if (activePanelId != null) {
    status.setActivePanelId(activePanelId);
  }
  if (message != null) {
    status.setMessage(message);
  }
  if (playSound != -1) {
    status.setPlaySound((playSound == 1) ? true : false);
  }
  try {
    statusPersistence.update(status,false);
  }
 catch (  SystemException se) {
    if (_log.isWarnEnabled()) {
      _log.warn("Add failed, fetch {userId=" + userId + "}");
    }
    status=statusPersistence.fetchByUserId(userId);
    if (status == null) {
      throw se;
    }
  }
  return status;
}
