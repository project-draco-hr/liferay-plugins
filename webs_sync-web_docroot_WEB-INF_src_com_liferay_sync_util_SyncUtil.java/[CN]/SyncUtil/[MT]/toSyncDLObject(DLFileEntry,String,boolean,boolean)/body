{
  DLFileVersion dlFileVersion=null;
  Date lockExpirationDate=null;
  long lockUserId=0;
  String lockUserName=StringPool.BLANK;
  String type=null;
  Lock lock=dlFileEntry.getLock();
  if ((lock == null) || excludeWorkingCopy) {
    dlFileVersion=DLFileVersionLocalServiceUtil.getFileVersion(dlFileEntry.getFileEntryId(),dlFileEntry.getVersion());
    type=SyncConstants.TYPE_FILE;
  }
 else {
    try {
      dlFileVersion=DLFileVersionLocalServiceUtil.getFileVersion(dlFileEntry.getFileEntryId(),DLFileEntryConstants.PRIVATE_WORKING_COPY_VERSION);
      lockExpirationDate=lock.getExpirationDate();
      lockUserId=lock.getUserId();
      lockUserName=lock.getUserName();
      type=SyncConstants.TYPE_PRIVATE_WORKING_COPY;
    }
 catch (    NoSuchFileVersionException nsfve) {
      dlFileVersion=DLFileVersionLocalServiceUtil.getFileVersion(dlFileEntry.getFileEntryId(),dlFileEntry.getVersion());
      type=SyncConstants.TYPE_FILE;
    }
  }
  SyncDLObject syncDLObject=new SyncDLObjectImpl();
  syncDLObject.setCompanyId(dlFileVersion.getCompanyId());
  long userId=0;
  String userName=StringPool.BLANK;
  PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
  if (permissionChecker != null) {
    User user=permissionChecker.getUser();
    userId=user.getUserId();
    userName=user.getFullName();
  }
  syncDLObject.setUserId(userId);
  syncDLObject.setUserName(userName);
  syncDLObject.setCreateDate(dlFileVersion.getCreateDate());
  syncDLObject.setModifiedDate(dlFileVersion.getModifiedDate());
  syncDLObject.setRepositoryId(dlFileVersion.getRepositoryId());
  syncDLObject.setParentFolderId(dlFileVersion.getFolderId());
  syncDLObject.setName(dlFileVersion.getTitle());
  syncDLObject.setExtension(dlFileVersion.getExtension());
  syncDLObject.setMimeType(dlFileVersion.getMimeType());
  syncDLObject.setDescription(dlFileVersion.getDescription());
  syncDLObject.setChangeLog(dlFileVersion.getChangeLog());
  syncDLObject.setExtraSettings(StringPool.BLANK);
  syncDLObject.setVersion(dlFileVersion.getVersion());
  syncDLObject.setVersionId(dlFileVersion.getFileVersionId());
  syncDLObject.setSize(dlFileVersion.getSize());
  if (calculateChecksum) {
    if (Validator.isNull(dlFileVersion.getChecksum())) {
      syncDLObject.setChecksum(getChecksum(dlFileVersion));
    }
 else {
      syncDLObject.setChecksum(dlFileVersion.getChecksum());
    }
  }
  syncDLObject.setEvent(event);
  syncDLObject.setLockExpirationDate(lockExpirationDate);
  syncDLObject.setLockUserId(lockUserId);
  syncDLObject.setLockUserName(lockUserName);
  syncDLObject.setType(type);
  syncDLObject.setTypePK(dlFileEntry.getFileEntryId());
  syncDLObject.setTypeUuid(dlFileEntry.getUuid());
  return syncDLObject;
}
