{
  InOut exchange=getExchangeFactory().createInOutExchange();
  NormalizedMessage in=exchange.createMessage();
  try {
    getMarshaler().toNMS(exchange,in,request);
    Enumeration enu=request.getParameterNames();
    while (enu.hasMoreElements()) {
      try {
        String name=(String)enu.nextElement();
        String value=request.getParameter(name);
        in.setProperty(name,value);
      }
 catch (      Exception e) {
      }
    }
    exchange.setInMessage(in);
    boolean result=getDeliveryChannel().sendSync(exchange);
    if (result) {
      if (exchange.getStatus() == ExchangeStatus.ERROR) {
        if (exchange.getError() != null) {
          throw new ServletException(exchange.getError());
        }
 else {
          throw new ServletException("Exchange status is ERROR");
        }
      }
      getMarshaler().toResponse(exchange,exchange.getOutMessage(),response);
    }
    done(exchange);
    response.setStatus(HttpServletResponse.SC_OK);
  }
 catch (  IOException ioe) {
    fail(exchange,ioe);
    outputException(response,ioe);
  }
catch (  TransformerException te) {
    fail(exchange,te);
    outputException(response,te);
  }
}
