{
  try {
    Criteria criteria=_session.createCriteria(ProcessInstance.class);
    criteria.setProjection(Projections.countDistinct("id"));
    criteria.add(Restrictions.eq("processDefinition.id",processDefinitionId));
    if (finished != null) {
      if (finished.booleanValue()) {
        criteria.add(Restrictions.isNotNull("end"));
      }
 else {
        criteria.add(Restrictions.isNull("end"));
      }
    }
    Number count=(Number)criteria.uniqueResult();
    return count.intValue();
  }
 catch (  Exception e) {
    throw new JbpmException(e);
  }
}
