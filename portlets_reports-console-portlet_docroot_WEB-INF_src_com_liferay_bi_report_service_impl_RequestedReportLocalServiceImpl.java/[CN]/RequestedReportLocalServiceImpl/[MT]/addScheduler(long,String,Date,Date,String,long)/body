{
  if (definitionId <= 0) {
    throw new NoSuchDefinitionException();
  }
  if (Validator.isNull(description)) {
    throw new PortalException();
  }
  ReportDefinition definition=ReportDefinitionLocalServiceUtil.getReportDefinition(definitionId);
  Date now=new Date();
  long requestId=CounterLocalServiceUtil.increment();
  RequestedReport requestedReport=requestedReportLocalService.createRequestedReport(requestId);
  requestedReport.setCompanyId(definition.getCompanyId());
  requestedReport.setGroupId(definition.getGroupId());
  requestedReport.setDefinitionId(definitionId);
  requestedReport.setUserId(userId);
  requestedReport.setScheduleRequest(true);
  requestedReport.setRequestStatus(RequestStatus.PENDING.toString());
  requestedReport.setCreateDate(now);
  requestedReport.setModifiedDate(now);
  try {
    ReportRequest reportRequest=ReportUtil.getReportRequest(definition);
    String groupName=ReportUtil.getSchedulerRequestName(requestId);
    SchedulerEngineUtil.schedule(groupName,cronText,startDate,endDate,description,REPORT_REQUEST,JSONFactoryUtil.serialize(reportRequest));
  }
 catch (  Exception e) {
    requestedReport.setRequestStatus(RequestStatus.ERROR.toString());
  }
  requestedReportLocalService.addRequestedReport(requestedReport);
}
