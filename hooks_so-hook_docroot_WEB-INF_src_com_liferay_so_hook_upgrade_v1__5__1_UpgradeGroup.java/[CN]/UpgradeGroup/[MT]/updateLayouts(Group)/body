{
  if (!group.isCommunity()) {
    return;
  }
  if ((group.getType() == GroupConstants.TYPE_SITE_PRIVATE) && group.hasPrivateLayouts()) {
    return;
  }
  if ((group.getType() == GroupConstants.TYPE_SITE_OPEN) && group.hasPublicLayouts()) {
    return;
  }
  long companyId=group.getCompanyId();
  long userId=PortalUtil.getValidUserId(companyId,group.getCreatorUserId());
  boolean privateLayout=group.hasPrivateLayouts();
  List<Layout> sourceLayouts=LayoutLocalServiceUtil.getLayouts(group.getGroupId(),privateLayout);
  ServiceContext serviceContext=new ServiceContext();
  for (  Layout sourceLayout : sourceLayouts) {
    Layout targetLayout=LayoutLocalServiceUtil.addLayout(userId,group.getGroupId(),!privateLayout,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID,sourceLayout.getName(LocaleUtil.getDefault().toString()),StringPool.BLANK,StringPool.BLANK,LayoutConstants.TYPE_PORTLET,false,sourceLayout.getFriendlyURL(),serviceContext);
    LayoutLocalServiceUtil.updateLayout(targetLayout.getGroupId(),targetLayout.isPrivateLayout(),targetLayout.getLayoutId(),sourceLayout.getTypeSettings());
    LayoutTypePortlet sourceLayoutTypePortlet=(LayoutTypePortlet)sourceLayout.getLayoutType();
    List<Portlet> sourcePortlets=sourceLayoutTypePortlet.getAllPortlets();
    for (    Portlet sourcePortlet : sourcePortlets) {
      String sourcePortletId=sourcePortlet.getPortletId();
      PortletPreferencesLocalServiceUtil.getPreferences(companyId,PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,targetLayout.getPlid(),sourcePortletId);
      PortletPreferences sourcePreferences=PortletPreferencesLocalServiceUtil.getPreferences(companyId,PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,sourceLayout.getPlid(),sourcePortletId);
      PortletPreferencesLocalServiceUtil.updatePreferences(PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,targetLayout.getPlid(),sourcePortletId,sourcePreferences);
    }
    LayoutLocalServiceUtil.deleteLayout(sourceLayout.getPlid());
  }
}
