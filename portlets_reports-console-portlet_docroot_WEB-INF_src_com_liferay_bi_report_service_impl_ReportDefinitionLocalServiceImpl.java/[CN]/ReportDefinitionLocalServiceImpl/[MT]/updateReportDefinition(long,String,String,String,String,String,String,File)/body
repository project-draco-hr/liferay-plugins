{
  ReportDefinition definition=getReportDefinition(definitionId);
  definition.setDefinitionName(definitionName);
  definition.setDescription(description);
  definition.setDataSourceName(datasourceName);
  definition.setReportFormat(format);
  definition.setReportParameters(reportParameters);
  validate(definition);
  if (Validator.isNull(fileName)) {
    throw new DefinitionFileException();
  }
  definition.setReportName(StringUtil.extractFirst(fileName,StringPool.PERIOD));
  try {
    DLServiceUtil.addFile(definition.getCompanyId(),CompanyConstants.SYSTEM_STRING,definition.getGroupId(),CompanyConstants.SYSTEM,definition.getAttachmentsDir() + StringPool.SLASH + fileName,0,StringPool.BLANK,new Date(),new String[0],new String[0],file);
  }
 catch (  DuplicateFileException e) {
  }
catch (  PortalException e) {
    throw new DefinitionFileException();
  }
  String[] existingFiles=definition.getAttachmentsFiles();
  for (  String existingFile : existingFiles) {
    if (fileName != existingFile) {
      DLServiceUtil.deleteFile(definition.getCompanyId(),CompanyConstants.SYSTEM_STRING,CompanyConstants.SYSTEM,existingFile);
    }
  }
  return updateReportDefinition(definition);
}
