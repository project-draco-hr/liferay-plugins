{
  String portletId=getPortletId(portletContext);
  if (navigationalContext != null) {
    String opaqueValue=navigationalContext.getOpaqueValue();
    if (Validator.isNotNull(opaqueValue)) {
      opaqueValue=new String(Base64.decode(Base64.fromURLSafe(opaqueValue)),StringPool.UTF8);
    }
    Map<String,String[]> parameterMap=HttpUtil.parameterMapFromString(opaqueValue);
    String portletConfigurationPortletId=PortletProviderUtil.getPortletId(PortletConfigurationApplicationType.PortletConfiguration.CLASS_NAME,PortletProvider.Action.VIEW);
    String actionPortletConfiguration=PortalUtil.getPortletNamespace(portletConfigurationPortletId) + "portletConfiguration";
    if (parameterMap.containsKey(actionPortletConfiguration)) {
      portletId=portletConfigurationPortletId;
    }
  }
  return portletId;
}
