{
  User user=null;
  try {
    user=PortalUtil.getUser(request);
  }
 catch (  NoSuchUserException nsue) {
  }
  if (user != null) {
    Role role=RoleLocalServiceUtil.fetchRole(user.getCompanyId(),RoleConstants.SOCIAL_OFFICE_USER);
    if (!UserLocalServiceUtil.hasRoleUser(role.getRoleId(),user.getUserId())) {
      return;
    }
    Group group=user.getGroup();
    String customJspServletContextName=GetterUtil.getString(group.getTypeSettingsProperty("customJspServletContextName"));
    if (customJspServletContextName.equals("so-hook")) {
      return;
    }
    if (!LayoutLocalServiceUtil.hasLayouts(user,false)) {
      LayoutSetLocalServiceUtil.addLayoutSet(group.getGroupId(),false);
    }
 else {
      List<Layout> layouts=LayoutLocalServiceUtil.getLayouts(group.getGroupId(),false);
      ServiceContext serviceContext=new ServiceContext();
      for (      Layout layout : layouts) {
        LayoutLocalServiceUtil.updateLayout(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId(),layout.getParentLayoutId(),layout.getNameMap(),layout.getTitleMap(),layout.getDescriptionMap(),layout.getKeywordsMap(),layout.getRobotsMap(),layout.getType(),true,layout.getFriendlyURL(),null,null,serviceContext);
      }
    }
    if (!LayoutLocalServiceUtil.hasLayouts(user,true)) {
      LayoutSetLocalServiceUtil.addLayoutSet(group.getGroupId(),true);
    }
    updatePrivateUserLayouts(group);
    updatePublicUserLayouts(group);
    setCustomJspServletContextName(group);
  }
}
