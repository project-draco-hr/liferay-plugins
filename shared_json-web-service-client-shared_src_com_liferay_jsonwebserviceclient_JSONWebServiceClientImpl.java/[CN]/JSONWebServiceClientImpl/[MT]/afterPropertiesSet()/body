{
  HttpClientBuilder httpClientBuilder=HttpClients.custom();
  HttpClientConnectionManager httpClientConnectionManager=getPoolingHttpClientConnectionManager();
  httpClientBuilder.setConnectionManager(httpClientConnectionManager);
  if ((_login != null) && (_password != null)) {
    CredentialsProvider credentialsProvider=new BasicCredentialsProvider();
    credentialsProvider.setCredentials(new AuthScope(_hostName,_hostPort),new UsernamePasswordCredentials(_login,_password));
    httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider);
    httpClientBuilder.setRetryHandler(new HttpRequestRetryHandlerImpl());
  }
 else {
    if (_logger.isWarnEnabled()) {
      _logger.warn("Login and password are required");
    }
  }
  try {
    setProxyHost(httpClientBuilder);
    _closeableHttpClient=httpClientBuilder.build();
    _idleConnectionMonitorThread=new IdleConnectionMonitorThread(httpClientConnectionManager);
    _idleConnectionMonitorThread.start();
    if (_logger.isDebugEnabled()) {
      _logger.debug("Configured client for " + _protocol + "://"+ _hostName);
    }
  }
 catch (  Exception e) {
    _logger.error("Unable to configure client",e);
  }
}
