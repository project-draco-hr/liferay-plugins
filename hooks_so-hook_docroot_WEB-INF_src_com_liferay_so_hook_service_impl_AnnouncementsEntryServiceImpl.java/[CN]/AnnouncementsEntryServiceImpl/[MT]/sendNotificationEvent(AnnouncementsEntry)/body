{
  JSONObject notificationEventJSON=JSONFactoryUtil.createJSONObject();
  notificationEventJSON.put("body",announcementEntry.getTitle());
  notificationEventJSON.put("entryId",announcementEntry.getEntryId());
  notificationEventJSON.put("groupId",announcementEntry.getClassPK());
  notificationEventJSON.put("portletId",PortletKeys.ANNOUNCEMENTS);
  notificationEventJSON.put("title","x-sent-a-new-announcement");
  notificationEventJSON.put("userId",announcementEntry.getUserId());
  NotificationEvent notificationEvent=NotificationEventFactoryUtil.createNotificationEvent(System.currentTimeMillis(),"6_WAR_soportlet",notificationEventJSON);
  notificationEvent.setDeliveryRequired(0);
  List<User> users=new ArrayList<User>();
  if (announcementEntry.getClassNameId() == 0) {
    users=UserLocalServiceUtil.getUsers(QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  }
 else {
    ClassName className=ClassNameLocalServiceUtil.getClassName(announcementEntry.getClassNameId());
    if (className.getClassName().equals(Group.class.getName())) {
      users=UserLocalServiceUtil.getGroupUsers(announcementEntry.getClassPK());
    }
 else     if (className.getClassName().equals(Organization.class.getName())) {
      users=UserLocalServiceUtil.getOrganizationUsers(announcementEntry.getClassPK());
    }
 else     if (className.getClassName().equals(Role.class.getName())) {
      users=UserLocalServiceUtil.getRoleUsers(announcementEntry.getClassPK());
    }
 else     if (className.getClassName().equals(UserGroup.class.getName())) {
      users=UserLocalServiceUtil.getUserGroupUsers(announcementEntry.getClassPK());
    }
  }
  for (  User user : users) {
    ChannelHubManagerUtil.sendNotificationEvent(user.getCompanyId(),user.getUserId(),notificationEvent);
  }
}
