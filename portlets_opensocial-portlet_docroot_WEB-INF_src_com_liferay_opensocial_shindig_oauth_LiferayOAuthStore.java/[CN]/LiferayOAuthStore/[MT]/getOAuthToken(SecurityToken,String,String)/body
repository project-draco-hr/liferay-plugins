{
  long userId=GetterUtil.getLong(securityToken.getViewerId());
  User user=null;
  try {
    user=UserLocalServiceUtil.getUser(userId);
  }
 catch (  Exception e) {
    throw new GadgetException(GadgetException.Code.INTERNAL_SERVER_ERROR,e);
  }
  Gadget gadget=null;
  try {
    gadget=GadgetLocalServiceUtil.getGadget(user.getCompanyId(),securityToken.getAppUrl());
  }
 catch (  Exception e) {
    throw new GadgetException(GadgetException.Code.INTERNAL_SERVER_ERROR,e);
  }
  OAuthToken oAuthToken=null;
  try {
    oAuthToken=OAuthTokenLocalServiceUtil.getOAuthToken(userId,gadget.getGadgetId(),serviceName,securityToken.getModuleId(),tokenName);
  }
 catch (  Exception e) {
  }
  return oAuthToken;
}
