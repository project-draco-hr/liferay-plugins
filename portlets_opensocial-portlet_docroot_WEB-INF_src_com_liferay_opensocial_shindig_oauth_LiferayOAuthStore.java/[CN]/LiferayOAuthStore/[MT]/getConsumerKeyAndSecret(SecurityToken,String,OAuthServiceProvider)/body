{
  OAuthConsumer oAuthConsumer=getOAuthConsumer(securityToken,serviceName);
  if (oAuthConsumer == null) {
    throw new GadgetException(GadgetException.Code.INTERNAL_SERVER_ERROR,"No key for gadget " + securityToken.getAppUrl() + " and service "+ serviceName);
  }
  net.oauth.OAuthConsumer consumer=null;
  if (oAuthConsumer.getKeyType().equals(OAuthConsumerConstants.KEY_TYPE_RSA_PRIVATE)) {
    consumer=new net.oauth.OAuthConsumer(null,oAuthConsumer.getConsumerKey(),null,oAuthServiceProvider);
    consumer.setProperty(OAuth.OAUTH_SIGNATURE_METHOD,OAuth.RSA_SHA1);
    consumer.setProperty(RSA_SHA1.PRIVATE_KEY,oAuthConsumer.getConsumerSecret());
  }
 else {
    consumer=new net.oauth.OAuthConsumer(null,oAuthConsumer.getConsumerKey(),oAuthConsumer.getConsumerSecret(),oAuthServiceProvider);
    consumer.setProperty(OAuth.OAUTH_SIGNATURE_METHOD,OAuth.HMAC_SHA1);
  }
  String keyName=oAuthConsumer.getKeyName();
  String callbackURL=_callbackURL.replace("%host%",ShindigUtil.getHost());
  return new ConsumerInfo(consumer,keyName,callbackURL);
}
