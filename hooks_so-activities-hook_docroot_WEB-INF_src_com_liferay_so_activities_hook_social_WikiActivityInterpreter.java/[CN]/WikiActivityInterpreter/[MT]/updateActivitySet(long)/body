{
  SocialActivity activity=SocialActivityLocalServiceUtil.fetchSocialActivity(activityId);
  if ((activity == null) || (activity.getActivitySetId() > 0)) {
    return;
  }
  long activitySetId=getActivitySetId(activityId);
  if (activitySetId > 0) {
    SocialActivitySetLocalServiceUtil.incrementActivityCount(activitySetId,activityId);
    if (activity.getType() == _ACTIVITY_KEY_UPDATE_PAGE) {
      SocialActivitySet activitySet=SocialActivitySetLocalServiceUtil.fetchSocialActivitySet(activitySetId);
      WikiPageResource pageResource=WikiPageResourceLocalServiceUtil.fetchWikiPageResource(activity.getClassPK());
      WikiPage wikiPage=WikiPageLocalServiceUtil.getPage(pageResource.getResourcePrimKey());
      JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject(activitySet.getExtraData());
      extraDataJSONObject.put("targetVersion",MathUtil.format(wikiPage.getVersion() + 0.1,1,1));
      activitySet.setExtraData(extraDataJSONObject.toString());
      SocialActivitySetLocalServiceUtil.updateSocialActivitySet(activitySet);
    }
  }
 else {
    SocialActivitySet activitySet=SocialActivitySetLocalServiceUtil.addActivitySet(activityId);
    if (activity.getType() == _ACTIVITY_KEY_UPDATE_PAGE) {
      WikiPageResource pageResource=WikiPageResourceLocalServiceUtil.fetchWikiPageResource(activity.getClassPK());
      WikiPage wikiPage=WikiPageLocalServiceUtil.getPage(pageResource.getResourcePrimKey());
      JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject();
      extraDataJSONObject.put("sourceVersion",wikiPage.getVersion());
      extraDataJSONObject.put("targetVersion",MathUtil.format(wikiPage.getVersion() + 0.1,1,1));
      activitySet.setExtraData(extraDataJSONObject.toString());
      SocialActivitySetLocalServiceUtil.updateSocialActivitySet(activitySet);
    }
  }
}
