{
  Directory rootDirectory=new Directory(StringPool.BLANK);
  rootDirectory.addAttribute("namingcontexts","o=Liferay");
  rootDirectory.addAttribute("objectclass","extensibleObject");
  rootDirectory.addAttribute("objectclass","top");
  rootDirectory.addAttribute("supportedfeatures",OIDConstants.ALL_OPERATIONAL_ATTRIBUTES);
  rootDirectory.addAttribute("supportedldapversion","3");
  rootDirectory.addAttribute("supportedsaslmechanisms",BindLdapHandler.DIGEST_MD5);
  rootDirectory.addAttribute("vendorname","Liferay, Inc.");
  rootDirectory.addAttribute("vendorversion",ReleaseInfo.getVersion());
  Directory topDirectory=new Directory("o=Liferay");
  topDirectory.addAttribute("objectclass","organizationalUnit");
  topDirectory.addAttribute("objectclass","top");
  topDirectory.addAttribute("o","Liferay");
  rootDirectory.addDirectory(topDirectory);
  List<Company> companies=CompanyLocalServiceUtil.getCompanies(false);
  for (  Company company : companies) {
    Directory companyDirectory=new Directory("ou=" + company.getWebId() + ",o=Liferay");
    companyDirectory.addAttribute("objectclass","organizationalUnit");
    companyDirectory.addAttribute("objectclass","top");
    companyDirectory.addAttribute("ou",company.getWebId());
    topDirectory.addDirectory(companyDirectory);
    Directory communitiesDirectory=new Directory("ou=Communities,ou=" + company.getWebId() + ",o=Liferay");
    communitiesDirectory.addAttribute("objectclass","organizationalUnit");
    communitiesDirectory.addAttribute("objectclass","top");
    communitiesDirectory.addAttribute("ou","Communities");
    companyDirectory.addDirectory(communitiesDirectory);
    Directory rolesDirectory=new Directory("ou=Roles,ou=" + company.getWebId() + ",o=Liferay");
    rolesDirectory.addAttribute("objectclass","organizationalUnit");
    rolesDirectory.addAttribute("objectclass","top");
    rolesDirectory.addAttribute("ou","Roles");
    List<Role> roles=RoleLocalServiceUtil.getRoles(company.getCompanyId());
    for (    Role role : roles) {
      Directory roleDirectory=new Directory("ou=" + role.getName() + ",ou=Roles,ou="+ company.getWebId()+ ",o=Liferay");
      roleDirectory.addAttribute("objectclass","organizationalUnit");
      roleDirectory.addAttribute("objectclass","top");
      roleDirectory.addAttribute("ou",role.getName());
      rolesDirectory.addDirectory(roleDirectory);
      if (PortalUtil.isSystemRole(role.getName())) {
        Directory usersDirectory=new Directory("ou=Users,ou=" + role.getName() + ",ou=Roles,ou="+ company.getWebId()+ ",o=Liferay");
        usersDirectory.addAttribute("objectclass","organizationalUnit");
        usersDirectory.addAttribute("objectclass","top");
        usersDirectory.addAttribute("ou","Roles");
        roleDirectory.addDirectory(usersDirectory);
        List<User> users=UserLocalServiceUtil.getRoleUsers(role.getRoleId());
        for (        User user : users) {
          Directory userDirectory=new Directory("cn=" + user.getScreenName() + ",ou=Users,ou="+ role.getName()+ ",ou=Roles,ou="+ company.getWebId()+ ",o=Liferay");
          userDirectory.addAttribute("cn",user.getScreenName());
          userDirectory.addAttribute("displayName",user.getFullName());
          userDirectory.addAttribute("givenName",user.getFirstName());
          userDirectory.addAttribute("mail",user.getEmailAddress());
          userDirectory.addAttribute("sn",user.getLastName());
          userDirectory.addAttribute("objectclass","inetOrgPerson");
          userDirectory.addAttribute("objectclass","top");
          userDirectory.addAttribute("uid",String.valueOf(user.getUserId()));
          usersDirectory.addDirectory(userDirectory);
        }
      }
    }
    companyDirectory.addDirectory(rolesDirectory);
    Directory usersDirectory=new Directory("ou=Users,ou=" + company.getWebId() + ",o=Liferay");
    usersDirectory.addAttribute("objectclass","organizationalUnit");
    usersDirectory.addAttribute("objectclass","top");
    usersDirectory.addAttribute("ou","Roles");
    List<User> users=UserLocalServiceUtil.getCompanyUsers(company.getCompanyId(),QueryUtil.ALL_POS,QueryUtil.ALL_POS);
    for (    User user : users) {
      Directory userDirectory=new Directory("cn=" + user.getScreenName() + ",ou=Users,ou="+ company.getWebId()+ ",o=Liferay");
      userDirectory.addAttribute("cn",user.getScreenName());
      userDirectory.addAttribute("displayName",user.getFullName());
      userDirectory.addAttribute("givenName",user.getFirstName());
      userDirectory.addAttribute("mail",user.getEmailAddress());
      userDirectory.addAttribute("sn",user.getLastName());
      userDirectory.addAttribute("objectclass","inetOrgPerson");
      userDirectory.addAttribute("objectclass","top");
      userDirectory.addAttribute("uid",String.valueOf(user.getUserId()));
      usersDirectory.addDirectory(userDirectory);
    }
    companyDirectory.addDirectory(usersDirectory);
  }
  _directory=rootDirectory;
}
