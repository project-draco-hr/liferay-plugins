{
  String login=PrincipalThreadLocal.getName();
  if (Validator.isNull(login)) {
    return login;
  }
  try {
    Company company=companyLocalService.getCompany(getCompanyId());
    String authType=company.getAuthType();
    if (!authType.equals(CompanyConstants.AUTH_TYPE_ID)) {
      User user=userLocalService.getUser(GetterUtil.getLong(login));
      if (authType.equals(CompanyConstants.AUTH_TYPE_EA)) {
        login=user.getEmailAddress();
      }
 else       if (authType.equals(CompanyConstants.AUTH_TYPE_SN)) {
        login=user.getScreenName();
      }
    }
  }
 catch (  PortalException e) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unable to get login to connect to external repository " + _extRepository,e);
    }
    login=null;
  }
catch (  SystemException e) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unable to get login to connect to external repository " + _extRepository,e);
    }
    login=null;
  }
  return login;
}
