{
  long startTime=System.currentTimeMillis();
  List<String> folderMappedIds=null;
  try {
    long[] folderIds=searchContext.getFolderIds();
    if ((folderIds != null) && (folderIds.length > 0)) {
      folderMappedIds=new ArrayList<String>();
      for (      long folderId : folderIds) {
        String repositoryMappedFolderId=_getRepositoryEntryMappedId(folderId);
        folderMappedIds.add(repositoryMappedFolderId);
      }
    }
  }
 catch (  SystemException se) {
    throw new SearchException("Cannot perform search",se);
  }
catch (  PortalException pe) {
    throw new SearchException("Cannot perform search",pe);
  }
  List<ExtRepositorySearchResult<?>> extRepositorySearchResults=null;
  try {
    extRepositorySearchResults=_extRepository.search(folderMappedIds,searchContext.getKeywords(),searchContext.getQueryConfig(),searchContext.getStart(),searchContext.getEnd());
  }
 catch (  PortalException pe) {
    throw new SearchException("Error performing search",pe);
  }
catch (  SystemException e) {
    throw new SearchException("Error performing search",e);
  }
  QueryConfig queryConfig=searchContext.getQueryConfig();
  List<Document> documents=new ArrayList<Document>();
  List<String> snippets=new ArrayList<String>();
  List<Float> scores=new ArrayList<Float>();
  int total=0;
  for (  ExtRepositorySearchResult<?> extRepositorySearchResult : extRepositorySearchResults) {
    try {
      ExtRepositoryEntryAdapter<?> extRepositoryEntryAdapter=_toExtRepositoryEntryAdapter(ExtRepositoryModelAdapterType.ENTRY,extRepositorySearchResult.getEntry());
      Document document=new DocumentImpl();
      document.addKeyword(Field.ENTRY_CLASS_NAME,extRepositoryEntryAdapter.getModelClassName());
      document.addKeyword(Field.ENTRY_CLASS_PK,extRepositoryEntryAdapter.getPrimaryKey());
      document.addKeyword(Field.TITLE,extRepositoryEntryAdapter.getName());
      documents.add(document);
      if (queryConfig.isScoreEnabled()) {
        scores.add(extRepositorySearchResult.getScore());
      }
 else {
        scores.add(1.0F);
      }
      snippets.add(extRepositorySearchResult.getSnippet());
      total++;
    }
 catch (    SystemException se) {
      if (_log.isWarnEnabled()) {
        _log.warn("Invalid entry returned from search",se);
      }
    }
catch (    PortalException pe) {
      if (_log.isWarnEnabled()) {
        _log.warn("Invalid entry returned from search",pe);
      }
    }
  }
  float searchTime=(float)(System.currentTimeMillis() - startTime) / Time.SECOND;
  Hits hits=new HitsImpl();
  hits.setDocs(documents.toArray(new Document[documents.size()]));
  hits.setLength(total);
  hits.setQueryTerms(new String[0]);
  hits.setScores(scores.toArray(new Float[scores.size()]));
  hits.setSearchTime(searchTime);
  hits.setSnippets(snippets.toArray(new String[snippets.size()]));
  hits.setStart(startTime);
  return hits;
}
