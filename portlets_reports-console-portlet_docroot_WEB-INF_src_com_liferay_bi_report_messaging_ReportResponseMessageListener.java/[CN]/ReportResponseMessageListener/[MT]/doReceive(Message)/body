{
  long requestReportId=Long.parseLong(message.getResponseId());
  ReportResultContainer reportResultContainer=(ReportResultContainer)message.getPayload();
  RequestedReport requestedReport=RequestedReportLocalServiceUtil.getRequestedReport(requestReportId);
  Date now=new Date();
  if (reportResultContainer.hasError()) {
    requestedReport.setRequestStatus(RequestStatus.ERROR.toString());
  }
 else {
    long companyId=requestedReport.getCompanyId();
    long groupId=requestedReport.getGroupId();
    String path=requestedReport.getAttachmentsDir();
    try {
      DLServiceUtil.addDirectory(companyId,repositoryId,path);
    }
 catch (    DuplicateDirectoryException dde) {
    }
    try {
      DLServiceUtil.addFile(companyId,portletId,groupId,repositoryId,path + StringPool.SLASH + reportResultContainer.getReportName(),fileEntryId,properties,now,tagsCategories,tagsEntries,reportResultContainer.getResults());
      requestedReport.setRequestStatus(RequestStatus.COMPLETE.toString());
    }
 catch (    Exception e) {
      requestedReport.setRequestStatus(RequestStatus.ERROR.toString());
      _log.error(e);
      e.printStackTrace();
    }
  }
  requestedReport.setModifiedDate(now);
  RequestedReportLocalServiceUtil.updateRequestedReport(requestedReport);
}
