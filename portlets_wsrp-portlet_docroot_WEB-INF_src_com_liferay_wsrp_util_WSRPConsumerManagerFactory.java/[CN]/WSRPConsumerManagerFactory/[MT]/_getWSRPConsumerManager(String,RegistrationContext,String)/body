{
  HttpSession session=getSession();
  Map<String,WSRPConsumerManager> wsrpConsumerManagers=_wsrpConsumerManagers;
  if (session != null) {
    wsrpConsumerManagers=(Map<String,WSRPConsumerManager>)session.getAttribute("wsrpConsumerManagers");
    if (wsrpConsumerManagers == null) {
      wsrpConsumerManagers=new ConcurrentHashMap<String,WSRPConsumerManager>();
      session.setAttribute("wsrpConsumerManagers",wsrpConsumerManagers);
    }
  }
  WSRPConsumerManager wsrpConsumerManager=wsrpConsumerManagers.get(url);
  if (wsrpConsumerManager == null) {
    String userToken=_getUserToken();
    wsrpConsumerManager=new WSRPConsumerManager(url,registrationContext,forwardCookies,userToken);
    wsrpConsumerManagers.put(url,wsrpConsumerManager);
  }
  return wsrpConsumerManager;
}
