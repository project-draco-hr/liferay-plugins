{
  for (  String key : params.keySet()) {
    String value=params.get(key);
    if (key.equalsIgnoreCase(WSRPSpecKeys.WINDOW_STATE)) {
      try {
        url.setWindowState(WSRPState.fromWSRP(value).getPortlet());
      }
 catch (      WindowStateException e) {
        _log.error(e.getMessage(),e);
      }
    }
 else     if (key.equalsIgnoreCase(WSRPSpecKeys.MODE)) {
      try {
        url.setPortletMode(WSRPMode.fromWSRP(value).getPortlet());
      }
 catch (      PortletModeException e) {
        _log.error(e.getMessage(),e);
      }
    }
 else     if (key.equals(WSRPSpecKeys.NAVIGATIONAL_STATE) || key.equals(WSRPSpecKeys.INTERACTION_STATE)) {
      url.setParameter(key,value);
    }
  }
  return url.toString();
}
