{
  String replacement=StringPool.BLANK;
  if (rewriteURL.startsWith(WSRPSpecKeys.COMMON + StringPool.QUESTION)) {
    Map<String,String> params=_parseURL(rewriteURL);
    if (rewriteURL.indexOf(WSRPSpecKeys.URL_TYPE_BLOCKING_ACTION) != -1) {
      replacement=_getPortletURL(res.createActionURL(),params);
    }
 else     if (rewriteURL.indexOf(WSRPSpecKeys.URL_TYPE_RENDER) != -1) {
      replacement=_getPortletURL(res.createActionURL(),params);
    }
 else     if (rewriteURL.indexOf(WSRPSpecKeys.URL_TYPE_RESOURCE) != -1) {
      replacement=_getResourceURL(res.createResourceURL(),params);
    }
  }
 else   if (rewriteURL.startsWith(WSRPSpecKeys.COMMON + StringPool.UNDERLINE)) {
    replacement=res.getNamespace();
  }
 else {
    _log.error("No valid rewrite expression found in: " + rewriteURL);
  }
  markup.append(replacement);
}
