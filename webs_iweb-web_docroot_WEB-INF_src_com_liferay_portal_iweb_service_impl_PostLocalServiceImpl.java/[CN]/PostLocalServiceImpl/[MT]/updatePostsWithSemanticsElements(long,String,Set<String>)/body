{
  try {
    long uid=0;
    if (postPersistence.fetchById_Type(postId,type) == null) {
      Post post=new PostImpl();
      uid=counterLocalService.increment();
      post.setUid(uid);
      post.setNew(true);
      post.setPid(postId);
      post.setType(type);
      postPersistence.update(post,false);
    }
    if (semanticsElementSet != null) {
      for (      String semElementURI : semanticsElementSet) {
        if (semanticsElementPersistence.fetchByPrimaryKey(semElementURI) == null) {
          SemanticsElement element=semanticsElementPersistence.create(semElementURI);
          semanticsElementPersistence.update(element,false);
          if (semElementURI.indexOf("#") != -1) {
            element.setSemanticsURI(semElementURI.substring(0,semElementURI.indexOf("#")));
          }
        }
      }
    }
    if (semanticsElementSet != null && !semanticsElementSet.isEmpty()) {
      postPersistence.setSemanticsElements(uid,semanticsElementSet.toArray(new String[0]));
    }
 else {
      Set<SemanticsElement> semElements=new TreeSet(postPersistence.getSemanticsElements(postId));
      postPersistence.clearSemanticsElements(uid);
      postPersistence.removeById_Type(postId,type);
      for (      SemanticsElement semElement : semElements) {
        List postsbysem=semanticsElementPersistence.getPosts(semElement.getElementURI());
        if (postsbysem.isEmpty() || postsbysem == null) {
          semanticsElementPersistence.remove(semElement.getElementURI());
        }
      }
    }
  }
 catch (  Exception ex) {
    throw new IWebException(ex);
  }
}
