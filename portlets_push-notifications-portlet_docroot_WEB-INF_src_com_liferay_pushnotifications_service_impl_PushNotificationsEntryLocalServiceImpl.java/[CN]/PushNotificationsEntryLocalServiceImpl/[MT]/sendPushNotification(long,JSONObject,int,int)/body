{
  long fromUserId=addFromUserDetails(jsonObject);
  JSONObject payloadJSONObject=jsonObject.getJSONObject(PushNotificationsConstants.KEY_PAYLOAD);
  long parentPushNotificationsEntryId=jsonObject.getLong(PushNotificationsConstants.KEY_PARENT_PUSH_NOTIFICATIONS_ENTRY_ID,PushNotificationsConstants.VALUE_PARENT_PUSH_NOTIFICATIONS_ENTRY_ID_DEFAULT);
  addPushNotificationsEntry(fromUserId,parentPushNotificationsEntryId,payloadJSONObject);
  for (  Map.Entry<String,PushNotificationsSender> entry : _pushNotificationsSenders.entrySet()) {
    List<String> tokens=new ArrayList<String>();
    List<PushNotificationsDevice> pushNotificationsDevices=pushNotificationsDeviceLocalService.getPushNotificationsDevices(toUserId,entry.getKey(),start,end);
    for (    PushNotificationsDevice pushNotificationsDevice : pushNotificationsDevices) {
      tokens.add(pushNotificationsDevice.getToken());
    }
    if (tokens.isEmpty()) {
      continue;
    }
    PushNotificationsSender pushNotificationsSender=entry.getValue();
    try {
      pushNotificationsSender.send(tokens,jsonObject);
    }
 catch (    PortalException pe) {
      throw pe;
    }
catch (    Exception e) {
      throw new PortalException(e);
    }
  }
}
