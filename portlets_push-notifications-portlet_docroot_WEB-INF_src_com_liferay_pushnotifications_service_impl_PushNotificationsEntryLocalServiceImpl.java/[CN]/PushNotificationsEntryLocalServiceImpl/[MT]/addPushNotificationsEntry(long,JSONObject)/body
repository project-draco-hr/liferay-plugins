{
  long pushNotificationsEntryId=counterLocalService.increment();
  PushNotificationsEntry pushNotificationsEntry=pushNotificationsEntryPersistence.create(pushNotificationsEntryId);
  payloadJSONObject.put(PushNotificationsConstants.KEY_PUSH_NOTIFICATIONS_ENTRY_ID,pushNotificationsEntryId);
  pushNotificationsEntry.setUserId(userId);
  pushNotificationsEntry.setCreateTime(System.currentTimeMillis());
  long parentPushNotificationsEntryId=payloadJSONObject.getLong(PushNotificationsConstants.KEY_PARENT_PUSH_NOTIFICATIONS_ENTRY_ID,PushNotificationsConstants.VALUE_PARENT_PUSH_NOTIFICATIONS_ENTRY_ID_DEFAULT);
  pushNotificationsEntry.setParentPushNotificationsEntryId(parentPushNotificationsEntryId);
  pushNotificationsEntry.setPayload(payloadJSONObject.toString());
  pushNotificationsEntryPersistence.update(pushNotificationsEntry);
  updateChildrenPushNotificationsEntriesCount(parentPushNotificationsEntryId);
  sendPushNotification(userId,payloadJSONObject);
  return pushNotificationsEntry;
}
