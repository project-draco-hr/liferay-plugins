{
  Message[] jxMessages=messageCountEvent.getMessages();
  IMAPFolder imapFolder=null;
  try {
    imapFolder=_imapAccessor.openFolder((IMAPFolder)jxMessages[0].getFolder());
    Folder folder=FolderLocalServiceUtil.getFolder(_account.getAccountId(),imapFolder.getFullName());
    long[] remoteMessageIds=_imapAccessor.getMessageUIDs(imapFolder,jxMessages);
    for (    long remoteMessageId : remoteMessageIds) {
      com.liferay.mail.model.Message message=MessageLocalServiceUtil.getMessage(folder.getFolderId(),remoteMessageId);
      MessageLocalServiceUtil.deleteMessage(message.getMessageId());
    }
  }
 catch (  Exception e) {
    _log.error("Unable to delete messages",e);
  }
 finally {
    try {
      _imapAccessor.closeFolder(imapFolder,false);
    }
 catch (    MailException me) {
      _log.error(me);
    }
  }
}
