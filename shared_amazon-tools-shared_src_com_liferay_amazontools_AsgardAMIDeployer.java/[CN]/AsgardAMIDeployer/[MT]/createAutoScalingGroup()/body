{
  System.out.println("Creating Auto Scaling Group");
  String availabilityZone=properties.getProperty("availability.zone");
  Map<String,String> parameters=new HashMap<String,String>();
  parameters.put("checkHealth","true");
  parameters.put("imageId",getImageId(_imageName));
  String asgardClusterName=properties.getProperty("asgard.cluster.name");
  parameters.put("name",asgardClusterName);
  parameters.put("trafficAllowed","true");
  _jsonWebServiceClient.doPost("/" + availabilityZone + "/cluster/createNextGroup",parameters);
  sleep(20);
  String autoScalingGroupName=null;
  boolean created=false;
  for (int i=0; i < 12; i++) {
    String json=_jsonWebServiceClient.doGet("/" + availabilityZone + "/cluster/show/"+ asgardClusterName+ ".json",Collections.<String,String>emptyMap());
    JSONArray autoScalingGroupsJSONArray=new JSONArray(json);
    JSONObject autoScalingGroupJSONObject=autoScalingGroupsJSONArray.getJSONObject(autoScalingGroupsJSONArray.length() - 1);
    autoScalingGroupName=autoScalingGroupJSONObject.getString("autoScalingGroupName");
    List<String> instanceIds=new ArrayList<String>();
    JSONArray instancesJSONArray=autoScalingGroupJSONObject.getJSONArray("instances");
    for (int j=0; j < instancesJSONArray.length(); j++) {
      JSONObject instanceJSONObject=instancesJSONArray.getJSONObject(j);
      instanceIds.add(instanceJSONObject.getString("instanceId"));
    }
    if (instanceIds.isEmpty() || !isInService(autoScalingGroupJSONObject)) {
      sleep(15);
    }
 else {
      CreateTagsRequest createTagsRequest=new CreateTagsRequest();
      createTagsRequest.setResources(instanceIds);
      List<Tag> tags=new ArrayList<Tag>();
      Tag tag=new Tag();
      tag.withKey("Name");
      tag.withValue(properties.getProperty("instance.name"));
      tags.add(tag);
      createTagsRequest.setTags(tags);
      amazonEC2Client.createTags(createTagsRequest);
      created=true;
      break;
    }
  }
  if (!created) {
    throw new RuntimeException("Unable to create Auto Scaling Group " + autoScalingGroupName);
  }
  System.out.println("Created Auto Scaling Group " + autoScalingGroupName);
  return autoScalingGroupName;
}
