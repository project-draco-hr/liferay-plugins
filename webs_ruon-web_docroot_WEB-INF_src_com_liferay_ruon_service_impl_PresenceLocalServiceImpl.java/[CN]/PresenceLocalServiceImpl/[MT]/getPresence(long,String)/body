{
  long networkId=networkLocalService.getNetworkId(networkName);
  Presence presence=presencePersistence.fetchByU_N(userId,networkId);
  if (presence != null) {
    checkPresence(presence);
    return presence;
  }
  long presenceId=CounterLocalServiceUtil.increment();
  presence=presencePersistence.create(presenceId);
  presence.setUserId(userId);
  presence.setModifiedDate(System.currentTimeMillis());
  presence.setNetworkId(networkId);
  presence.setOnline(false);
  presencePersistence.update(presence,false);
  return presence;
}
