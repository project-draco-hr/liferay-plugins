{
  if (roleType == RoleConstants.TYPE_REGULAR) {
    Role role=RoleLocalServiceUtil.getRole(roleId);
    LinkedHashMap<String,Object> params=new LinkedHashMap<String,Object>();
    params.put("inherit",Boolean.TRUE);
    params.put("usersRoles",role.getRoleId());
    return UserLocalServiceUtil.search(role.getCompanyId(),null,WorkflowConstants.STATUS_APPROVED,params,QueryUtil.ALL_POS,QueryUtil.ALL_POS,(OrderByComparator)null);
  }
  List<User> users=new ArrayList<User>();
  KaleoInstanceToken kaleoInstanceToken=executionContext.getKaleoInstanceToken();
  List<UserGroupRole> userGroupRoles=UserGroupRoleLocalServiceUtil.getUserGroupRolesByGroupAndRole(kaleoInstanceToken.getGroupId(),roleId);
  for (  UserGroupRole userGroupRole : userGroupRoles) {
    users.add(userGroupRole.getUser());
  }
  List<UserGroupGroupRole> userGroupGroupRoles=UserGroupGroupRoleLocalServiceUtil.getUserGroupGroupRolesByGroupAndRole(kaleoInstanceToken.getGroupId(),roleId);
  for (  UserGroupGroupRole userGroupGroupRole : userGroupGroupRoles) {
    users.addAll(UserLocalServiceUtil.getUserGroupUsers(userGroupGroupRole.getUserGroupId()));
  }
  return users;
}
