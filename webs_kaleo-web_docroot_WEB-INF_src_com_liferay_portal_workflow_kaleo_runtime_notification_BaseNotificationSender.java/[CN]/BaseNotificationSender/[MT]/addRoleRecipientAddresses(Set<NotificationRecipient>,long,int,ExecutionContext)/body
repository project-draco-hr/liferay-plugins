{
  List<User> users=null;
  if (roleType == RoleConstants.TYPE_REGULAR) {
    users=UserLocalServiceUtil.getRoleUsers(roleId);
  }
 else {
    users=new ArrayList<User>();
    KaleoInstanceToken kaleoInstanceToken=executionContext.getKaleoInstanceToken();
    List<UserGroupRole> userGroupRoles=UserGroupRoleLocalServiceUtil.getUserGroupRolesByGroupAndRole(kaleoInstanceToken.getGroupId(),roleId);
    for (    UserGroupRole userGroupRole : userGroupRoles) {
      users.add(userGroupRole.getUser());
    }
    List<UserGroupGroupRole> userGroupGroupRoles=UserGroupGroupRoleLocalServiceUtil.getUserGroupGroupRolesByGroupAndRole(kaleoInstanceToken.getGroupId(),roleId);
    for (    UserGroupGroupRole userGroupGroupRole : userGroupGroupRoles) {
      users.addAll(UserLocalServiceUtil.getUserGroupUsers(userGroupGroupRole.getUserGroupId()));
    }
  }
  for (  User user : users) {
    if (user.isActive()) {
      NotificationRecipient notificationRecipient=new NotificationRecipient(user);
      notificationRecipients.add(notificationRecipient);
    }
  }
}
