{
  runSQL(KBArticleTable.TABLE_SQL_DROP);
  runSQL("alter table KB_Article add kbArticleId LONG");
  runSQL("update KB_Article set kbArticleId = articleId");
  if (!tableHasColumn("KB_Article","rootResourcePrimKey")) {
    runSQL("alter table KB_Article add rootResourcePrimKey LONG");
    runSQL("update KB_Article set rootResourcePrimKey = 0");
  }
  if (!tableHasColumn("KB_Article","kbTemplateId")) {
    runSQL("alter table KB_Article add kbTemplateId LONG");
    runSQL("update KB_Article set kbTemplateId = 0");
  }
  if (!tableHasColumn("KB_Article","viewCount")) {
    runSQL("alter table KB_Article add viewCount INTEGER");
    runSQL("update KB_Article set viewCount = 0");
  }
  if (!tableHasColumn("KB_Article","latest")) {
    runSQL("alter table KB_Article add latest BOOLEAN");
    runSQL("update KB_Article set latest = FALSE");
  }
  if (!tableHasColumn("KB_Article","main")) {
    runSQL("alter table KB_Article add main BOOLEAN");
    runSQL("update KB_Article set main = FALSE");
  }
  if (!tableHasColumn("KB_Article","status")) {
    runSQL("alter table KB_Article add status INTEGER");
    runSQL("update KB_Article set status = 0");
  }
  if (!tableHasColumn("KB_Article","statusByUserId")) {
    runSQL("alter table KB_Article add statusByUserId LONG");
    runSQL("update KB_Article set statusByUserId = userId");
  }
  if (!tableHasColumn("KB_Article","statusByUserName")) {
    runSQL("alter table KB_Article add statusByUserName STRING null");
    runSQL("update KB_Article set statusByUserName = userName");
  }
  if (!tableHasColumn("KB_Article","statusDate")) {
    runSQL("alter table KB_Article add statusDate DATE null");
    runSQL("update KB_Article set statusDate = modifiedDate");
  }
  Object[][] columns={{"articleId",new Integer(Types.BIGINT)}};
  columns=ArrayUtil.append(columns,KBArticleTable.TABLE_COLUMNS);
  UpgradeTable upgradeTable=UpgradeTableFactoryUtil.getUpgradeTable("KB_Article",columns);
  String createSQL=KBArticleTable.TABLE_SQL_CREATE;
  createSQL=createSQL.substring(0,createSQL.length() - 1) + ",articleId VARCHAR(75) null)";
  upgradeTable.setCreateSQL(createSQL);
  upgradeTable.updateTable();
  runSQL("alter table KBArticle drop column articleId");
  KBArticleAttachmentsUtil.deleteAttachmentsDirectory(PortalUtil.getDefaultCompanyId());
}
