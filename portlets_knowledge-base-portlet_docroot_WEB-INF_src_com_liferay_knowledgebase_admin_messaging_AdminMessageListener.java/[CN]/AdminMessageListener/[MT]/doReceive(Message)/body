{
  long companyId=message.getLong("companyId");
  long groupId=message.getLong("groupId");
  long userId=message.getLong("userId");
  long resourcePrimKey=message.getLong("resourcePrimKey");
  String portalURL=message.getString("portalURL");
  String fromName=message.getString("fromName");
  String fromAddress=message.getString("fromAddress");
  String subject=message.getString("subject");
  String body=message.getString("body");
  String replyToAddress=message.getString("replyToAddress");
  String mailId=message.getString("mailId");
  boolean htmlFormat=message.getBoolean("htmlFormat");
  if (_log.isInfoEnabled()) {
    _log.info("Sending notifications for {mailId=" + mailId + ", resourcePrimKey="+ resourcePrimKey+ "}");
  }
  Article article=ArticleLocalServiceUtil.getLatestArticle(resourcePrimKey,WorkflowConstants.STATUS_APPROVED);
  SubscriptionSender subscriptionSender=new AdminSubscriptionSender(article,portalURL);
  subscriptionSender.setCompanyId(companyId);
  subscriptionSender.setUserId(userId);
  subscriptionSender.setGroupId(groupId);
  subscriptionSender.setFrom(fromName,fromAddress);
  subscriptionSender.setSubject(subject);
  subscriptionSender.setBody(body);
  subscriptionSender.setReplyToAddress(replyToAddress);
  subscriptionSender.setMailId(mailId);
  subscriptionSender.setHtmlFormat(htmlFormat);
  subscriptionSender.notifyPersistedSubscribers(Article.class.getName(),groupId);
  subscriptionSender.notifyPersistedSubscribers(Article.class.getName(),resourcePrimKey);
  while (article.getParentResourcePrimKey() != ArticleConstants.DEFAULT_PARENT_RESOURCE_PRIM_KEY) {
    article=ArticleLocalServiceUtil.getLatestArticle(article.getParentResourcePrimKey(),WorkflowConstants.STATUS_APPROVED);
    subscriptionSender.notifyPersistedSubscribers(Article.class.getName(),article.getResourcePrimKey());
  }
  if (_log.isInfoEnabled()) {
    _log.info("Finished sending notifications");
  }
}
