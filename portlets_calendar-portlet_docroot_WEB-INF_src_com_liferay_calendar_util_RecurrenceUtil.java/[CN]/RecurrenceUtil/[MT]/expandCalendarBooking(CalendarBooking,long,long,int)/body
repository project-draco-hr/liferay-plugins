{
  List<CalendarBooking> expandedCalendarBookings=new ArrayList<CalendarBooking>();
  DateValue startDateValue=_toDateValue(startTime);
  DateValue endDateValue=_toDateValue(endTime);
  if (!calendarBooking.isRecurring()) {
    expandedCalendarBookings.add(calendarBooking);
    return expandedCalendarBookings;
  }
  try {
    RecurrenceIterator recurrenceIterator=RecurrenceIteratorFactory.createRecurrenceIterator(calendarBooking.getRecurrence(),_toDateValue(calendarBooking.getStartTime()),TimeUtils.utcTimezone());
    int instanceIndex=0;
    while (recurrenceIterator.hasNext()) {
      DateValue dateValue=recurrenceIterator.next();
      if (dateValue.compareTo(startDateValue) < 0) {
        instanceIndex++;
        continue;
      }
      if (dateValue.compareTo(endDateValue) > 0) {
        break;
      }
      CalendarBooking newCalendarBooking=_copyCalendarBooking(calendarBooking,dateValue);
      newCalendarBooking.setInstanceIndex(instanceIndex);
      instanceIndex++;
      expandedCalendarBookings.add(newCalendarBooking);
      if ((maxSize > 0) && (expandedCalendarBookings.size() >= maxSize)) {
        break;
      }
    }
  }
 catch (  ParseException pe) {
    _log.error("Unable to parse data ",pe);
  }
  return expandedCalendarBookings;
}
