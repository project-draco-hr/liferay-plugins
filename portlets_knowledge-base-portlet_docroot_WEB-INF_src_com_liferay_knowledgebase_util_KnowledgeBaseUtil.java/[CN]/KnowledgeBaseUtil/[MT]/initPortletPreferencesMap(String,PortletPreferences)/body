{
  String rootPortletId=PortletConstants.getRootPortletId(portletId);
  if (rootPortletId.equals(PortletKeys.KNOWLEDGE_BASE_ADMIN)) {
    return AdminUtil.initPortletPreferencesMap(preferences);
  }
  if (!isValidPortletId(portletId)) {
    return Collections.emptyMap();
  }
  Map<String,Object> defaultPreferences=new HashMap<String,Object>();
  defaultPreferences.put("articlesTitle",StringPool.BLANK);
  defaultPreferences.put("articlesDelta",SearchContainer.DEFAULT_DELTA);
  defaultPreferences.put("articlesDisplayStyle","title");
  defaultPreferences.put("articleWindowState",WindowState.MAXIMIZED.toString());
  defaultPreferences.put("childArticlesDisplayStyle","abstract");
  defaultPreferences.put("enableArticleAssetCategories",true);
  defaultPreferences.put("enableArticleAssetTags",true);
  defaultPreferences.put("enableArticleRatings",false);
  defaultPreferences.put("enableArticleComments",true);
  defaultPreferences.put("showArticleComments",true);
  defaultPreferences.put("selectionMethod","group");
  defaultPreferences.put("resourcePrimKeys",new Long[0]);
  defaultPreferences.put("allArticles",true);
  defaultPreferences.put("orderByColumn","modified-date");
  defaultPreferences.put("orderByAscending",false);
  defaultPreferences.put("assetEntryQueryContains",true);
  defaultPreferences.put("assetEntryQueryAndOperator",false);
  defaultPreferences.put("assetEntryQueryName","asset-categories");
  defaultPreferences.put("assetCategoryIds",new Long[0]);
  defaultPreferences.put("assetTagNames",new String[0]);
  defaultPreferences.put("rssDelta",SearchContainer.DEFAULT_DELTA);
  defaultPreferences.put("rssDisplayStyle",RSSUtil.DISPLAY_STYLE_FULL_CONTENT);
  defaultPreferences.put("rssFormat","atom10");
  Map<String,String> preferencesMap=new HashMap<String,String>();
  for (  Map.Entry<String,Object> entry : defaultPreferences.entrySet()) {
    String key=entry.getKey();
    Object value=entry.getValue();
    if (value instanceof Object[]) {
      String[] values=ArrayUtil.toStringArray((Object[])value);
      value=StringUtil.merge(preferences.getValues(key,values));
    }
 else {
      value=preferences.getValue(key,String.valueOf(value));
    }
    preferencesMap.put(key,String.valueOf(value));
  }
  return Collections.unmodifiableMap(preferencesMap);
}
