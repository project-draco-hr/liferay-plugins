{
  final ComponentContainer previousView=mainWindow.getContent();
  composer.setHeight("550px");
  mainWindow.setContent(composer);
  composer.addListener(new ComposerListener(){
    public void messageDiscarded(    Composer composer){
      if (returnUrl == null) {
        mainWindow.setContent(previousView);
      }
 else {
        mainWindow.open(new ExternalResource(returnUrl));
      }
    }
    public void messageSaved(    Composer composer,    Message message){
      if (returnUrl == null) {
        mainWindow.setContent(previousView);
      }
      mainWindow.showNotification(Lang.get("saved-successfully"),Notification.TYPE_TRAY_NOTIFICATION);
      if (returnUrl != null) {
        mainWindow.open(new ExternalResource(returnUrl));
      }
    }
    public void messageSent(    Composer composer,    Message message){
      if (returnUrl == null) {
        mainWindow.setContent(previousView);
      }
      String caption=Lang.get("sent-successfully");
      String description=Lang.get("to") + ":</br>" + message.getTo()+ "<br/>"+ Lang.get("subject")+ ": "+ composer.getSubject()+ "<br/>"+ composer.getAttachments().size()+ " "+ Lang.get("attachments");
      mainWindow.showNotification(caption,description,Notification.TYPE_TRAY_NOTIFICATION);
      try {
        Controller.get().getMailManager().synchronizeAccount(composer.getFrom().getAccountId());
        if (previousView instanceof MainMailView) {
          ((MainMailView)previousView).update();
        }
      }
 catch (      PortalException e) {
        Controller.get().showError(Lang.get("unable-to-synchronize-account"),e);
      }
catch (      SystemException e) {
        Controller.get().showError(Lang.get("unable-to-synchronize-account"),e);
      }
      if (returnUrl != null) {
        mainWindow.open(new ExternalResource(returnUrl));
      }
    }
  }
);
}
