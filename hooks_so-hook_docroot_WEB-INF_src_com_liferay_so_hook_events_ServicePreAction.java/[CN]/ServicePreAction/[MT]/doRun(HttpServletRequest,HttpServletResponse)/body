{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String currentURL=PortalUtil.getCurrentURL(request);
  if (isDisplayURL(themeDisplay,currentURL)) {
    long groupId=ParamUtil.getLong(request,"groupId");
    String redirect=getRedirect(themeDisplay,groupId);
    if (redirect == null) {
      redirect=ParamUtil.getString(request,"redirect");
      SessionErrors.add(request,NoSuchLayoutSetException.class.getName(),new NoSuchLayoutSetException("{groupId=" + groupId + ", privateLayout=0}"));
    }
    response.sendRedirect(redirect);
    return;
  }
  if (!themeDisplay.isSignedIn()) {
    return;
  }
  Group group=layout.getGroup();
  if (!group.getName().equals(GroupConstants.GUEST) || currentURL.startsWith("/c/")) {
    return;
  }
  User user=themeDisplay.getUser();
  String redirect=themeDisplay.getPathFriendlyURLPublic() + "/" + user.getScreenName()+ "/home";
  response.sendRedirect(redirect);
}
