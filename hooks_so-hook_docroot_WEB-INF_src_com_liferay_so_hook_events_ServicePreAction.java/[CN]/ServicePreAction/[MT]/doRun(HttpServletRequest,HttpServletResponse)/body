{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String currentURL=PortalUtil.getCurrentURL(request);
  if (Validator.isNotNull(themeDisplay.getI18nLanguageId())) {
    int x=currentURL.indexOf(StringPool.SLASH,1);
    currentURL=currentURL.substring(x);
  }
  if (isDisplayURL(themeDisplay,currentURL)) {
    long groupId=ParamUtil.getLong(request,"groupId");
    String redirect=getRedirect(themeDisplay,groupId);
    if (redirect == null) {
      redirect=ParamUtil.getString(request,"redirect");
      SessionErrors.add(request,NoSuchLayoutSetException.class.getName(),new NoSuchLayoutSetException("{groupId=" + groupId + ", privateLayout=0}"));
    }
    response.sendRedirect(redirect);
    return;
  }
  if (!themeDisplay.isSignedIn()) {
    return;
  }
  Layout layout=themeDisplay.getLayout();
  if ((layout == null) || (layout.getLayoutId() != 1)) {
    return;
  }
  Group group=layout.getGroup();
  if (!group.getName().equals(GroupConstants.GUEST) || currentURL.startsWith("/c/")) {
    return;
  }
  User user=themeDisplay.getUser();
  String redirect=themeDisplay.getPathFriendlyURLPublic() + "/" + user.getScreenName()+ "/home";
  response.sendRedirect(redirect);
}
