{
  SearchBase searchBase=DirectoryTree.getSearchBase(searchRequest.getBase(),getSizeLimit(searchRequest));
  if (searchBase == null) {
    return;
  }
  Directory directory=searchBase.getDirectory();
  if (directory == null) {
    return;
  }
  long sizeLimit=getSizeLimit(searchRequest);
  searchBase.setSizeLimit(sizeLimit);
  SearchScope searchScope=searchRequest.getScope();
  if (searchScope.equals(SearchScope.OBJECT) || searchScope.equals(SearchScope.SUBTREE)) {
    if (isMatch(directory,searchRequest.getFilter())) {
      StopWatch stopWatch=new StopWatch();
      stopWatch.start();
      addObjectEntry(searchRequest,responses,ldapHandlerContext,directory,stopWatch);
      searchBase.setSizeLimit(searchBase.getSizeLimit() - 1);
    }
  }
 else   if (searchScope.equals(SearchScope.ONELEVEL) || searchScope.equals(SearchScope.SUBTREE)) {
    StopWatch stopWatch=new StopWatch();
    stopWatch.start();
    List<Directory> subdirectories=DirectoryTree.getDirectories(searchBase,searchRequest.getFilter(),searchScope);
    for (    Directory subdirectory : subdirectories) {
      addObjectEntry(searchRequest,responses,ldapHandlerContext,subdirectory,stopWatch);
    }
  }
}
