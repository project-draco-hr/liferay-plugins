{
  InternalSearchRequest internalSearchRequest=(InternalSearchRequest)internalRequest;
  List<InternalResponse> internalResponses=new ArrayList<InternalResponse>();
  try {
    Directory directory=ldapHandlerContext.getDirectory();
    directory=directory.findBase(internalSearchRequest.getBase());
    if (directory != null) {
      SearchScope searchScope=internalSearchRequest.getScope();
      StopWatch stopWatch=new StopWatch();
      stopWatch.start();
      if (searchScope.equals(SearchScope.OBJECT)) {
        addObjectEntry(internalSearchRequest,internalResponses,ldapHandlerContext,directory,stopWatch);
      }
 else       if (searchScope.equals(SearchScope.ONELEVEL)) {
        for (        Directory curDirectory : directory.getDirectories()) {
          addObjectEntry(internalSearchRequest,internalResponses,ldapHandlerContext,curDirectory,stopWatch);
        }
      }
 else       if (searchScope.equals(SearchScope.SUBTREE)) {
        addSubtreeEntries(internalSearchRequest,internalResponses,ldapHandlerContext,directory,stopWatch);
      }
    }
    internalResponses.add(getInternalResponse(internalRequest));
  }
 catch (  SearchSizeLimitException ssle) {
    internalResponses.add(getInternalResponse(internalRequest,ResultCodeEnum.SIZE_LIMIT_EXCEEDED));
  }
catch (  SearchTimeLimitException ssle) {
    internalResponses.add(getInternalResponse(internalRequest,ResultCodeEnum.TIME_LIMIT_EXCEEDED));
  }
catch (  Exception e) {
    _log.error(e,e);
  }
  return internalResponses;
}
