{
  if (Validator.isNull(className)) {
    return s;
  }
  if (!className.equals(MBMessage.class.getName())) {
    return s;
  }
  if (options == null) {
    return s;
  }
  Object emailPartToMBMessageBody=options.get("emailPartToMBMessageBody");
  if ((emailPartToMBMessageBody == null) || (emailPartToMBMessageBody != Boolean.TRUE)) {
    return s;
  }
  if (!contentType.startsWith(ContentTypes.TEXT_PLAIN)) {
    return s;
  }
  Matcher matcher=_pattern.matcher(s);
  if (!matcher.find()) {
    return s;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Sanitizing " + className + "#"+ classPK);
  }
  s=s.substring(0,matcher.start());
  return s.trim();
}
