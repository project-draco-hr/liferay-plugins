{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String content=ParamUtil.getString(resourceRequest,"content");
  boolean contentValid=ShindigUtil.isContentValid(content);
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
  jsonObject.put("contentValid",contentValid);
  if (contentValid) {
    String portalURL=PortalUtil.getPortalURL(themeDisplay);
    String appId=portalURL.concat("/raw.xml");
    jsonObject.put("appId",appId);
    long moduleId=ShindigUtil.getModuleId(resourceResponse.getNamespace());
    jsonObject.put("moduleId",moduleId);
    boolean requiresPubsub=ShindigUtil.isRequiresPubsubFromContent(content);
    jsonObject.put("requiresPubsub",requiresPubsub);
    String ownerId=ShindigUtil.getOwnerId(themeDisplay.getLayout());
    String currentURL=PortalUtil.getCurrentURL(resourceRequest);
    String secureToken=ShindigUtil.createSecurityToken(ownerId,themeDisplay.getUserId(),appId,portalURL,appId,moduleId,currentURL);
    jsonObject.put("secureToken",secureToken);
    jsonObject.put("specUrl",appId);
  }
  writeJSON(resourceRequest,resourceResponse,jsonObject.toString());
}
