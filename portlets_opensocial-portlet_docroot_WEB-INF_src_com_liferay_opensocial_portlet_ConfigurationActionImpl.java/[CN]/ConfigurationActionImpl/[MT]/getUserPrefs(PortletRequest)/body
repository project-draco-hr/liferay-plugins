{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String portletId=ParamUtil.getString(portletRequest,"portletResource");
  Portlet portlet=PortletLocalServiceUtil.getPortletById(themeDisplay.getCompanyId(),portletId);
  Gadget gadget=ShindigUtil.getGadget(portlet.getPortletName());
  GadgetSpec gadgetSpec=ShindigUtil.getGadgetSpec(gadget);
  return gadgetSpec.getUserPrefs();
}
