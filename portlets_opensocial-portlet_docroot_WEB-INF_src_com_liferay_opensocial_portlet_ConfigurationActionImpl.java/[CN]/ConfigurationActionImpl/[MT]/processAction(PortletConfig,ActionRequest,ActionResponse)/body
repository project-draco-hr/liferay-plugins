{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  JSONObject userPrefsJsonObject=JSONFactoryUtil.createJSONObject();
  List<UserPref> userPrefs=getUserPrefs(actionRequest);
  for (  UserPref userPref : userPrefs) {
    String name=userPref.getName();
    String value=ParamUtil.getString(actionRequest,name);
    userPrefsJsonObject.put(name,value);
  }
  String namespace=ShindigUtil.getPortletResourceNamespace(actionRequest,themeDisplay);
  String columnName=ShindigUtil.getColumnUserPrefs(namespace);
  ExpandoValueServiceUtil.addValue(themeDisplay.getCompanyId(),User.class.getName(),ShindigUtil.getTableOpenSocial(),columnName,themeDisplay.getUserId(),userPrefsJsonObject.toString());
  SessionMessages.add(actionRequest,portletConfig.getPortletName() + ".doConfigure");
}
