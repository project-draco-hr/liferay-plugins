{
  String name=PrincipalThreadLocal.getName();
  try {
    long companyId=PortalUtil.getDefaultCompanyId();
    long defaultUserId=UserLocalServiceUtil.getDefaultUserId(companyId);
    PrincipalThreadLocal.setName(defaultUserId);
    clearData(companyId);
    setupCommunities(companyId,defaultUserId);
    Organization organization=setupOrganizations(companyId,defaultUserId);
    setupRoles(companyId,defaultUserId);
    List<User> users=setupUsers(companyId);
    setupWorkflow(companyId,defaultUserId);
    setupSocialActivityCounters(companyId,organization.getGroup(),users);
  }
  finally {
    PrincipalThreadLocal.setName(name);
  }
}
