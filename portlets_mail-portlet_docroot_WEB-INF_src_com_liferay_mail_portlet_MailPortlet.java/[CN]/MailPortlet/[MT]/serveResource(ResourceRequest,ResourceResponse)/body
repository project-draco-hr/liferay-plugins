{
  String jspPage=resourceRequest.getParameter("jspPage");
  if (jspPage.equals("/attachment.jsp")) {
    HttpServletRequest request=PortalUtil.getHttpServletRequest(resourceRequest);
    String emailAddress=ParamUtil.getString(resourceRequest,"emailAddress");
    String folderName=ParamUtil.getString(resourceRequest,"folderName");
    int messageUid=ParamUtil.getInteger(resourceRequest,"messageUid");
    String fileName=ParamUtil.getString(resourceRequest,"fileName");
    String contentPath=ParamUtil.getString(resourceRequest,"contentPath");
    try {
      MailBoxManager mailBoxManager=new MailBoxManager(PortalUtil.getUser(request),emailAddress);
      Part messagePart=mailBoxManager.getAttachment(folderName,messageUid,contentPath);
      if (Validator.isNotNull(messagePart)) {
        InputStream is=messagePart.getInputStream();
        String contentType=MimeTypesUtil.getContentType(fileName);
        PortletResponseUtil.sendFile(resourceResponse,fileName,is,contentType);
      }
    }
 catch (    MessagingException me) {
    }
catch (    PortalException pe) {
    }
catch (    SystemException se) {
    }
  }
 else {
    super.serveResource(resourceRequest,resourceResponse);
  }
}
