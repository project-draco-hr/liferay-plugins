{
  if (!userName.equals(bbbParticipant.getName())) {
    bbbParticipant=BBBParticipantLocalServiceUtil.addBBBParticipant(bbbParticipant.getUserId(),bbbParticipant.getGroupId(),bbbParticipant.getBbbMeetingId(),userName,null,bbbParticipant.getType(),BBBParticipantConstants.STATUS_INVITED,new ServiceContext());
  }
  StringBundler sb=new StringBundler(11);
  sb.append(BBBConstants.API_PARAMETER_FULL_NAME);
  sb.append(StringPool.EQUAL);
  sb.append(HtmlUtil.escapeURL(bbbParticipant.getName()));
  sb.append(StringPool.AMPERSAND);
  sb.append(BBBConstants.API_PARAMETER_MEETING_ID);
  sb.append(StringPool.EQUAL);
  BBBMeeting bbbMeeting=BBBMeetingLocalServiceUtil.getBBBMeeting(bbbParticipant.getBbbMeetingId());
  sb.append(bbbMeeting.getBbbMeetingId());
  sb.append(StringPool.AMPERSAND);
  sb.append(BBBConstants.API_PARAMETER_PASSWORD);
  sb.append(StringPool.EQUAL);
  if (bbbParticipant.getType() == BBBParticipantConstants.TYPE_MODERATOR) {
    sb.append(HtmlUtil.escapeURL(bbbMeeting.getModeratorPassword()));
  }
 else {
    sb.append(HtmlUtil.escapeURL(bbbMeeting.getAttendeePassword()));
  }
  BBBServer bbbServer=BBBServerLocalServiceUtil.getBBBServer(bbbMeeting.getBbbServerId());
  return getURL(bbbServer,BBBConstants.API_METHOD_JOIN,sb.toString());
}
