{
  IMAPFolder imapFolder=null;
  try {
    imapFolder=openFolder(_account.getSentFolderId());
    Message jxMessage=createMessage(personalName,sender,to,cc,bcc,subject,body,mailFiles);
    Transport transport=_imapConnection.getTransport();
    transport.sendMessage(jxMessage,jxMessage.getAllRecipients());
    transport.close();
    imapFolder.addMessageCountListener(new IMAPMessageCountListener(_user,_account,_password));
    imapFolder.appendMessages(new Message[]{jxMessage});
  }
 catch (  MessagingException me) {
    throw new MailException(me);
  }
catch (  UnsupportedEncodingException uee) {
    throw new MailException(uee);
  }
 finally {
    closeFolder(imapFolder,false);
  }
}
