{
  WSRPConsumer wsrpConsumer=wsrpConsumerPersistence.findByPrimaryKey(wsrpConsumerId);
  Date now=new Date();
  validate(name,portletHandle);
  long wsrpConsumerPortletId=CounterLocalServiceUtil.increment();
  WSRPConsumerPortlet wsrpConsumerPortlet=wsrpConsumerPortletPersistence.create(wsrpConsumerPortletId);
  wsrpConsumerPortlet.setCompanyId(wsrpConsumer.getCompanyId());
  wsrpConsumerPortlet.setCreateDate(now);
  wsrpConsumerPortlet.setModifiedDate(now);
  wsrpConsumerPortlet.setWsrpConsumerId(wsrpConsumerId);
  wsrpConsumerPortlet.setName(name);
  wsrpConsumerPortlet.setPortletHandle(portletHandle);
  wsrpConsumerPortletPersistence.update(wsrpConsumerPortlet,false);
  Message message=new Message();
  message.put("command","add");
  message.put("companyId",wsrpConsumer.getCompanyId());
  message.put("name",name);
  message.put("portletHandle",portletHandle);
  message.put("wsrpConsumerId",wsrpConsumerId);
  message.put("wsrpConsumerPortletId",wsrpConsumerPortletId);
  message.put("userToken",userToken);
  MessageBusUtil.sendMessage(DestinationNames.WSRP,message);
  return wsrpConsumerPortlet;
}
