{
  WSRPConsumer wsrpConsumer=wsrpConsumerPersistence.findByPrimaryKey(wsrpConsumerId);
  Date now=new Date();
  validate(name,portletHandle);
  long wsrpConsumerPortletId=CounterLocalServiceUtil.increment();
  WSRPConsumerPortlet wsrpConsumerPortlet=wsrpConsumerPortletPersistence.create(wsrpConsumerPortletId);
  wsrpConsumerPortlet.setCompanyId(wsrpConsumer.getCompanyId());
  wsrpConsumerPortlet.setCreateDate(now);
  wsrpConsumerPortlet.setModifiedDate(now);
  wsrpConsumerPortlet.setWsrpConsumerId(wsrpConsumerId);
  wsrpConsumerPortlet.setName(name);
  wsrpConsumerPortlet.setPortletHandle(portletHandle);
  wsrpConsumerPortletPersistence.update(wsrpConsumerPortlet,false);
  Message message=new Message();
  message.put("command","add");
  message.put("wsrpConsumerPortlet",Base64.objectToString(wsrpConsumerPortlet));
  message.put("userToken",userToken);
  MessageBusUtil.sendMessage(_WSRP_REPOSITORY,message);
  return wsrpConsumerPortlet;
}
