{
  long userId=message.getLong("userId");
  long accountId=message.getLong("accountId");
  long folderId=message.getLong("folderId");
  long messageId=message.getLong("messageId");
  String password=message.getString("password");
  int flag=message.getInteger("flag");
  boolean flagValue=message.getBoolean("flagValue");
  if (_log.isDebugEnabled()) {
    _log.debug("Flagging message for messageId " + messageId);
  }
  if (password.equals(StringPool.BLANK)) {
    return;
  }
  Mailbox mailbox=MailboxFactoryUtil.getMailbox(userId,accountId,password);
  mailbox.updateFlags(folderId,new long[]{messageId},flag,flagValue);
}
