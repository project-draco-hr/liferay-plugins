{
  Message[] messages=messageCountEvent.getMessages();
  IMAPFolder imapFolder=null;
  try {
    imapFolder=_imapUtil.openFolder((IMAPFolder)messages[0].getFolder());
    Folder localFolder=FolderLocalServiceUtil.getFolder(_account.getAccountId(),imapFolder.getFullName());
    long[] messageIds=_imapUtil.getMessageUIDs(imapFolder,messages);
    for (    long messageId : messageIds) {
      com.liferay.mail.model.Message localMessage=MessageLocalServiceUtil.getMessage(localFolder.getFolderId(),messageId);
      MessageLocalServiceUtil.deleteMessage(localMessage.getMessageId());
    }
  }
 catch (  Exception e) {
    _log.error("Unable to delete messages",e);
  }
 finally {
    try {
      _imapUtil.closeFolder(imapFolder,false);
    }
 catch (    MailException me) {
      _log.error(me);
    }
  }
}
