{
  final PortletSession session=request.getPortletSession();
  JiraProxy proxy=(JiraProxy)session.getAttribute(JiraPortletConstants.PROXY_KEY);
  if (proxy == null) {
    return;
  }
  String securityToken=(String)session.getAttribute(JiraPortletConstants.SECURITY_TOKEN_KEY);
  if (StringUtil.isEmpty(securityToken)) {
    return;
  }
  final Issue issue=(Issue)command;
  final String issueKey;
  try {
    issueKey=proxy.createIssue(securityToken,issue);
  }
 catch (  Exception e) {
    if (log.isErrorEnabled()) {
      log.error("Unabl to create issue: ",e);
    }
    throw e;
  }
  response.setRenderParameter(JiraPortletConstants.TICKET_ID_KEY,issueKey);
  response.setRenderParameter(JiraPortletConstants.URL_PREFERENCE,request.getPreferences().getValue(JiraPortletConstants.URL_PREFERENCE,StringUtil.EMPTY_STRING));
}
