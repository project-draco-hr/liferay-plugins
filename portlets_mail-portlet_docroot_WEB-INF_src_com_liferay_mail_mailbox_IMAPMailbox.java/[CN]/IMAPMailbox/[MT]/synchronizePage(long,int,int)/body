{
  long[] remoteMessageIds=_imapAccessor.getMessageUIDs(folderId,pageNumber,messagesPerPage);
  List<Long> missingRemoteMessageIds=new ArrayList<Long>();
  for (int i=0; i < remoteMessageIds.length; i++) {
    long remoteMessageId=remoteMessageIds[i];
    try {
      MessageLocalServiceUtil.getMessage(folderId,remoteMessageId);
    }
 catch (    NoSuchMessageException nsme) {
      missingRemoteMessageIds.add(remoteMessageId);
    }
  }
  if (!missingRemoteMessageIds.isEmpty()) {
    long[] tempRemoteMessageIds=new long[missingRemoteMessageIds.size()];
    for (int i=0; i < missingRemoteMessageIds.size(); i++) {
      tempRemoteMessageIds[i]=missingRemoteMessageIds.get(i);
    }
    _imapAccessor.storeEnvelopes(folderId,tempRemoteMessageIds);
  }
}
