{
  if (_log.isDebugEnabled()) {
    _log.debug("Updating folders");
  }
  List<javax.mail.Folder> jxFolders=_imapAccessor.getFolders();
  long draftFolderId=account.getDraftFolderId();
  long inboxFolderId=account.getInboxFolderId();
  long sentFolderId=account.getSentFolderId();
  long trashFolderId=account.getTrashFolderId();
  String[] draftFolderNames=PortletPropsValues.DRAFT_FOLDER_NAMES;
  String[] inboxFolderNames=PortletPropsValues.INBOX_FOLDER_NAMES;
  String[] sentFolderNames=PortletPropsValues.SENT_FOLDER_NAMES;
  String[] trashFolderNames=PortletPropsValues.TRASH_FOLDER_NAMES;
  for (  javax.mail.Folder jxFolder : jxFolders) {
    Folder folder=null;
    try {
      folder=FolderLocalServiceUtil.getFolder(account.getAccountId(),jxFolder.getFullName());
    }
 catch (    NoSuchFolderException nsfe) {
      folder=FolderLocalServiceUtil.addFolder(user.getUserId(),account.getAccountId(),jxFolder.getFullName(),jxFolder.getName(),0);
    }
    String folderName=jxFolder.getName();
    if ((draftFolderId == 0) && findFolderName(folderName,draftFolderNames)) {
      draftFolderId=folder.getFolderId();
    }
 else     if ((inboxFolderId == 0) && findFolderName(folderName,inboxFolderNames)) {
      inboxFolderId=folder.getFolderId();
    }
 else     if ((sentFolderId == 0) && findFolderName(folderName,sentFolderNames)) {
      sentFolderId=folder.getFolderId();
    }
 else     if ((trashFolderId == 0) && findFolderName(folderName,trashFolderNames)) {
      trashFolderId=folder.getFolderId();
    }
  }
  if (draftFolderId == 0) {
    _log.error("draft folder id is not updated properly please refer to" + " your mail server setttings and set your draft forlder" + " name in portlet.properties");
  }
  if (inboxFolderId == 0) {
    _log.error("inbox folder id is not updated properly please refer to" + " your mail server setttings and set your inbox folder" + " name in portlet.properties");
  }
  if (sentFolderId == 0) {
    _log.error("sent folder id is not updated properly please refer to" + " your mail server setttings and set your sent folder" + " name in portlet.properties");
  }
  if (trashFolderId == 0) {
    _log.error("trash folder id is not updated properly please refer to" + " your mail server setttings and set your trash folder" + " name in portlet.properties");
  }
  AccountLocalServiceUtil.updateFolders(account.getAccountId(),inboxFolderId,draftFolderId,sentFolderId,trashFolderId);
}
