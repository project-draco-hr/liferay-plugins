{
  long userId=portletDataContext.getUserId(calendarBooking.getUserUuid());
  String calendarPath=ExportImportPathUtil.getModelPath(portletDataContext,Calendar.class.getName(),calendarBooking.getCalendarId());
  Calendar calendar=(Calendar)portletDataContext.getZipEntryAsObject(calendarPath);
  StagedModelDataHandlerUtil.importStagedModel(portletDataContext,calendar);
  Map<Long,Long> calendarIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(Calendar.class);
  long calendarId=MapUtil.getLong(calendarIds,calendarBooking.getCalendarId(),calendarBooking.getCalendarId());
  long parentCalendarBookingId=CalendarBookingConstants.PARENT_CALENDAR_BOOKING_ID_DEFAULT;
  if (!calendarBooking.isMasterBooking()) {
    String parentCalendarBookingPath=ExportImportPathUtil.getModelPath(portletDataContext,CalendarBooking.class.getName(),calendarBooking.getParentCalendarBookingId());
    CalendarBooking parentCalendarBooking=(CalendarBooking)portletDataContext.getZipEntryAsObject(parentCalendarBookingPath);
    StagedModelDataHandlerUtil.importStagedModel(portletDataContext,parentCalendarBooking);
    Map<Long,Long> calendarBookingIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(CalendarBooking.class);
    parentCalendarBookingId=MapUtil.getLong(calendarBookingIds,calendarBooking.getParentCalendarBookingId(),calendarBooking.getParentCalendarBookingId());
  }
  ServiceContext serviceContext=portletDataContext.createServiceContext(calendarBooking,CalendarPortletDataHandler.NAMESPACE);
  CalendarBooking importedCalendarBooking=null;
  if (portletDataContext.isDataStrategyMirror()) {
    CalendarBooking existingCalendarBooking=CalendarBookingLocalServiceUtil.fetchCalendarBookingByUuidAndGroupId(calendarBooking.getUuid(),portletDataContext.getScopeGroupId());
    if (existingCalendarBooking == null) {
      serviceContext.setUuid(calendarBooking.getUuid());
      importedCalendarBooking=CalendarBookingLocalServiceUtil.addCalendarBooking(userId,calendarId,new long[0],parentCalendarBookingId,calendarBooking.getTitleMap(),calendarBooking.getDescriptionMap(),calendarBooking.getLocation(),calendarBooking.getStartTime(),calendarBooking.getEndTime(),calendarBooking.isAllDay(),calendarBooking.getRecurrence(),calendarBooking.getFirstReminder(),calendarBooking.getFirstReminderType(),calendarBooking.getSecondReminder(),calendarBooking.getSecondReminderType(),serviceContext);
    }
 else {
      importedCalendarBooking=CalendarBookingLocalServiceUtil.updateCalendarBooking(userId,existingCalendarBooking.getCalendarBookingId(),calendarId,calendarBooking.getTitleMap(),calendarBooking.getDescriptionMap(),calendarBooking.getLocation(),calendarBooking.getStartTime(),calendarBooking.getEndTime(),calendarBooking.isAllDay(),calendarBooking.getRecurrence(),calendarBooking.getFirstReminder(),calendarBooking.getFirstReminderType(),calendarBooking.getSecondReminder(),calendarBooking.getSecondReminderType(),calendarBooking.getStatus(),serviceContext);
    }
  }
 else {
    importedCalendarBooking=CalendarBookingLocalServiceUtil.addCalendarBooking(userId,calendarId,new long[0],parentCalendarBookingId,calendarBooking.getTitleMap(),calendarBooking.getDescriptionMap(),calendarBooking.getLocation(),calendarBooking.getStartTime(),calendarBooking.getEndTime(),calendarBooking.isAllDay(),calendarBooking.getRecurrence(),calendarBooking.getFirstReminder(),calendarBooking.getFirstReminderType(),calendarBooking.getSecondReminder(),calendarBooking.getSecondReminderType(),serviceContext);
  }
  portletDataContext.importClassedModel(calendarBooking,importedCalendarBooking,CalendarPortletDataHandler.NAMESPACE);
}
