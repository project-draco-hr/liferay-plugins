{
  String actionName=ParamUtil.getString(actionRequest,ActionRequest.ACTION_NAME);
  if (actionName.equals("updateFieldGroup")) {
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
    try {
      updateProjectsEntries(actionRequest,actionResponse);
      String redirect=ParamUtil.getString(actionRequest,"redirect");
      jsonObject.put("redirect",redirect);
      jsonObject.put("success",true);
    }
 catch (    Exception e) {
      ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
      String message=LanguageUtil.get(themeDisplay.getLocale(),"your-request-failed-to-complete");
      jsonObject.put("message",message);
      jsonObject.put("success",false);
    }
    HttpServletResponse response=PortalUtil.getHttpServletResponse(actionResponse);
    response.setContentType(ContentTypes.TEXT_JAVASCRIPT);
    ServletResponseUtil.write(response,jsonObject.toString());
  }
 else {
    updateProjectsEntries(actionRequest,actionResponse);
    DynamicActionRequest dynamicActionRequest=new DynamicActionRequest(actionRequest);
    if (cmd.equals(Constants.UPDATE)) {
      User user=PortalUtil.getSelectedUser(actionRequest);
      List<Role> curRoles=user.getRoles();
      Role socialOfficeRole=RoleLocalServiceUtil.getRole(user.getCompanyId(),RoleConstants.SOCIAL_OFFICE_USER);
      long[] roleIds=getLongArray(actionRequest,"rolesSearchContainerPrimaryKeys");
      boolean containsSocialOfficeRole=ArrayUtil.contains(roleIds,socialOfficeRole.getRoleId());
      if (containsSocialOfficeRole && !curRoles.contains(socialOfficeRole)) {
        LayoutSetPrototype[] layoutSetPrototypes=LayoutSetPrototypeUtil.getLayoutSetPrototypes(user);
        dynamicActionRequest.setParameter("publicLayoutSetPrototypeId",String.valueOf(layoutSetPrototypes[0].getLayoutSetPrototypeId()));
        dynamicActionRequest.setParameter("privateLayoutSetPrototypeId",String.valueOf(layoutSetPrototypes[1].getLayoutSetPrototypeId()));
        dynamicActionRequest.setParameter("publicLayoutSetPrototypeLinkEnabled",String.valueOf(true));
        dynamicActionRequest.setParameter("privateLayoutSetPrototypeLinkEnabled",String.valueOf(true));
      }
 else       if (!containsSocialOfficeRole && curRoles.contains(socialOfficeRole)) {
        dynamicActionRequest.setParameter("publicLayoutSetPrototypeId",StringPool.BLANK);
        dynamicActionRequest.setParameter("privateLayoutSetPrototypeId",StringPool.BLANK);
        dynamicActionRequest.setParameter("publicLayoutSetPrototypeLinkEnabled",String.valueOf(false));
        dynamicActionRequest.setParameter("privateLayoutSetPrototypeLinkEnabled",String.valueOf(false));
      }
    }
    originalStrutsPortletAction.processAction(portletConfig,dynamicActionRequest,actionResponse);
  }
}
