{
  try {
    String cmd=ParamUtil.getString(actionRequest,Constants.CMD);
    KBArticle article=null;
    if (cmd.equals(Constants.DELETE)) {
      deleteArticle(actionRequest);
    }
 else     if (cmd.equals(Constants.UPDATE)) {
      article=updateArticle(actionRequest);
    }
 else     if (cmd.equals(Constants.SUBSCRIBE)) {
      subscribe(actionRequest);
    }
 else     if (cmd.equals(Constants.UNSUBSCRIBE)) {
      unsubscribe(actionRequest);
    }
 else     if (cmd.equals("subscribe_article")) {
      subscribeArticle(actionRequest);
    }
 else     if (cmd.equals("unsubscribe_article")) {
      unsubscribeArticle(actionRequest);
    }
 else     if (cmd.equals("add_attachment")) {
      addAttachment(actionRequest);
    }
 else     if (cmd.equals("delete_attachment")) {
      deleteAttachment(actionRequest);
    }
    boolean preview=ParamUtil.getBoolean(actionRequest,"preview");
    if (preview) {
      actionResponse.setRenderParameters(actionRequest.getParameterMap());
    }
 else     if (Validator.isNotNull(cmd)) {
      String redirect=ParamUtil.getString(actionRequest,"redirect");
      if (article != null) {
        String saveAndContinueRedirect=ParamUtil.getString(actionRequest,"saveAndContinueRedirect");
        if (Validator.isNotNull(saveAndContinueRedirect)) {
          redirect=saveAndContinueRedirect;
        }
 else         if (redirect.endsWith("title=")) {
          redirect+=article.getTitle();
        }
      }
      if (SessionErrors.isEmpty(actionRequest)) {
        SessionMessages.add(actionRequest,"request_processed");
      }
      sendRedirect(actionRequest,actionResponse,redirect);
      return;
    }
  }
 catch (  Exception e) {
    if (e instanceof NoSuchArticleException || e instanceof PrincipalException) {
      SessionErrors.add(actionRequest,e.getClass().getName());
      actionResponse.setRenderParameters(actionRequest.getParameterMap());
      actionResponse.setRenderParameter(Constants.CMD,"error");
    }
 else     if (e instanceof ArticleTitleException || e instanceof ArticleVersionException || e instanceof EntryNameException|| e instanceof PrincipalException) {
      SessionErrors.add(actionRequest,e.getClass().getName());
      actionResponse.setRenderParameters(actionRequest.getParameterMap());
      actionResponse.setRenderParameter(Constants.CMD,"edit_article");
    }
 else {
      throw new PortletException(e);
    }
  }
}
