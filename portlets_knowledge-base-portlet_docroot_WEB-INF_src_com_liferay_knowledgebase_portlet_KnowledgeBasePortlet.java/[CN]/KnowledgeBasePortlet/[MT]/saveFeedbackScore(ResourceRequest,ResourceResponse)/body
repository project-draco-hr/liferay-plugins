{
  int score=ParamUtil.getInteger(resourceRequest,"score");
  long articleResourcePrimKey=ParamUtil.getLong(resourceRequest,"articleResourcePrimKey");
  long userId=ParamUtil.getLong(resourceRequest,"userId");
  KBFeedbackEntryLocalServiceUtil.updateScore(articleResourcePrimKey,userId,score);
  KBFeedbackStats feedbackStats=KBFeedbackStatsLocalServiceUtil.getArticleFeedbackStats(articleResourcePrimKey);
  int totalScoreEntries=feedbackStats.getTotalScoreEntries();
  double averageScore=MathUtil.format(feedbackStats.getAverageScore(),1,1);
  Map<String,String> parameterMap=new HashMap<String,String>();
  parameterMap.put("averageScore",String.valueOf(averageScore));
  parameterMap.put("totalScoreEntries",String.valueOf(totalScoreEntries));
  sendJSON(resourceResponse,parameterMap);
}
