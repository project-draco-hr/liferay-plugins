{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  int pos=fileName.indexOf(StringPool.SLASH);
  if (pos != -1) {
    title=fileName.substring(0,pos);
    fileName=fileName.substring(pos + 1);
  }
  InputStream is=null;
  try {
    KBArticle page=KBArticleServiceUtil.getArticle(themeDisplay.getPortletGroupId(),title);
    is=DLLocalServiceUtil.getFileAsStream(page.getCompanyId(),CompanyConstants.SYSTEM,page.getAttachmentsDir() + "/" + fileName);
    String contentType=MimeTypesUtil.getContentType(fileName);
    PortletResponseUtil.sendFile(response,fileName,is,contentType);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
 finally {
    ServletResponseUtil.cleanUp(is);
  }
}
