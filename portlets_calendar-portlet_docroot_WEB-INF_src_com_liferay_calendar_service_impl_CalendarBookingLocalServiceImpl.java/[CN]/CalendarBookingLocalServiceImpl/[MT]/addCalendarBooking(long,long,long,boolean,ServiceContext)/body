{
  User user=userPersistence.findByPrimaryKey(userId);
  long groupId=serviceContext.getScopeGroupId();
  CalendarEvent calendarEvent=calendarEventPersistence.findByPrimaryKey(calendarEventId);
  CalendarResource calendarResource=calendarResourcePersistence.findByPrimaryKey(calendarResourceId);
  Date now=new Date();
  long calendarBookingId=counterLocalService.increment();
  CalendarBooking calendarBooking=calendarBookingPersistence.create(calendarBookingId);
  calendarBooking.setUuid(serviceContext.getUuid());
  calendarBooking.setGroupId(groupId);
  calendarBooking.setCompanyId(user.getCompanyId());
  calendarBooking.setUserId(user.getUserId());
  calendarBooking.setUserName(user.getFullName());
  calendarBooking.setCreateDate(serviceContext.getCreateDate(now));
  calendarBooking.setModifiedDate(serviceContext.getModifiedDate(now));
  calendarBooking.setCalendarEventId(calendarEventId);
  calendarBooking.setCalendarResourceId(calendarResourceId);
  calendarBooking.setClassNameId(calendarResource.getClassNameId());
  calendarBooking.setClassPK(calendarResource.getClassPK());
  calendarBooking.setTitleMap(calendarEvent.getTitleMap());
  calendarBooking.setNameMap(calendarResource.getNameMap());
  calendarBooking.setDescriptionMap(calendarEvent.getDescriptionMap());
  calendarBooking.setLocation(calendarEvent.getLocation());
  calendarBooking.setStartDate(calendarEvent.getStartDate());
  calendarBooking.setEndDate(calendarEvent.getEndDate());
  calendarBooking.setDurationHour(calendarEvent.getDurationHour());
  calendarBooking.setDurationMinute(calendarEvent.getDurationMinute());
  calendarBooking.setRecurrence(calendarEvent.getRecurrence());
  calendarBooking.setType(calendarEvent.getType());
  calendarBooking.setRequired(required);
  calendarBookingPersistence.update(calendarBooking,false);
  return calendarBooking;
}
