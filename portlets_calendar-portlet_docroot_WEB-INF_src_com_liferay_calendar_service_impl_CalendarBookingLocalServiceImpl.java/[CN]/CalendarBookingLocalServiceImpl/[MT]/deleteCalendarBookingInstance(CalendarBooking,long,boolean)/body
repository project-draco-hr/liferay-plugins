{
  Date now=new Date();
  java.util.Calendar startTimeJCalendar=JCalendarUtil.getJCalendar(startTime);
  Recurrence recurrenceObj=calendarBooking.getRecurrenceObj();
  if (allFollowing) {
    if (startTime == calendarBooking.getStartTime()) {
      calendarBookingLocalService.deleteCalendarBooking(calendarBooking);
      return;
    }
    if (recurrenceObj.getCount() > 0) {
      recurrenceObj.setCount(0);
    }
    startTimeJCalendar.add(java.util.Calendar.DATE,-1);
    recurrenceObj.setUntilJCalendar(startTimeJCalendar);
  }
 else {
    recurrenceObj.addExceptionDate(startTimeJCalendar);
  }
  String recurrence=RecurrenceSerializer.serialize(recurrenceObj);
  List<CalendarBooking> childCalendarBookings=getChildCalendarBookings(calendarBooking.getCalendarBookingId());
  for (  CalendarBooking childCalendarBooking : childCalendarBookings) {
    childCalendarBooking.setModifiedDate(now);
    childCalendarBooking.setRecurrence(recurrence);
    calendarBookingPersistence.update(childCalendarBooking);
  }
}
