{
  if (!calendarBooking.isMasterBooking()) {
    return;
  }
  List<CalendarBooking> childCalendarBookings=calendarBookingPersistence.findByParentCalendarBookingId(calendarBooking.getCalendarBookingId());
  Set<Long> existingCalendarBookingIds=new HashSet<Long>(childCalendarIds.length);
  boolean sendEmail=ParamUtil.getBoolean(serviceContext,"sendEmail",true);
  for (  CalendarBooking childCalendarBooking : childCalendarBookings) {
    if (childCalendarBooking.isMasterBooking() || childCalendarBooking.isDenied()) {
      continue;
    }
    deleteCalendarBooking(childCalendarBooking.getCalendarBookingId());
    existingCalendarBookingIds.add(childCalendarBooking.getCalendarId());
  }
  for (  long calendarId : childCalendarIds) {
    int count=calendarBookingPersistence.countByC_P(calendarId,calendarBooking.getCalendarBookingId());
    if (count > 0) {
      continue;
    }
    CalendarBooking childCalendarBooking=addCalendarBooking(calendarBooking.getUserId(),calendarId,new long[0],calendarBooking.getCalendarBookingId(),calendarBooking.getTitleMap(),calendarBooking.getDescriptionMap(),calendarBooking.getLocation(),calendarBooking.getStartTime(),calendarBooking.getEndTime(),calendarBooking.getAllDay(),calendarBooking.getRecurrence(),calendarBooking.getFirstReminder(),calendarBooking.getFirstReminderType(),calendarBooking.getSecondReminder(),calendarBooking.getSecondReminderType(),serviceContext);
    NotificationTemplateType notificationTemplateType=NotificationTemplateType.INVITE;
    if (existingCalendarBookingIds.contains(childCalendarBooking.getCalendarId())) {
      notificationTemplateType=NotificationTemplateType.UPDATE;
    }
    if (sendEmail) {
      sendNotification(childCalendarBooking,notificationTemplateType);
    }
  }
}
