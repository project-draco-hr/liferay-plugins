{
  if (!calendarBooking.isMasterBooking()) {
    return;
  }
  List<CalendarBooking> childCalendarBookings=calendarBookingPersistence.findByParentCalendarBookingId(calendarBooking.getCalendarBookingId());
  Set<Long> existingCalendarBookingIds=new HashSet<Long>(childCalendarIds.length);
  for (  CalendarBooking childCalendarBooking : childCalendarBookings) {
    if (!childCalendarBooking.isMasterBooking() && !childCalendarBooking.isDenied()) {
      deleteCalendarBooking(childCalendarBooking.getCalendarBookingId());
      existingCalendarBookingIds.add(childCalendarBooking.getCalendarId());
    }
  }
  for (  long calendarId : childCalendarIds) {
    int count=calendarBookingPersistence.countByC_P(calendarId,calendarBooking.getCalendarBookingId());
    if (count > 0) {
      continue;
    }
    CalendarBooking childCalendarBooking=addCalendarBooking(calendarBooking.getUserId(),calendarId,new long[0],calendarBooking.getCalendarBookingId(),calendarBooking.getTitleMap(),calendarBooking.getDescriptionMap(),calendarBooking.getLocation(),calendarBooking.getStartTime(),calendarBooking.getEndTime(),calendarBooking.getAllDay(),calendarBooking.getRecurrence(),calendarBooking.getFirstReminder(),calendarBooking.getFirstReminderType(),calendarBooking.getSecondReminder(),calendarBooking.getSecondReminderType(),serviceContext);
    try {
      NotificationType notificationType=NotificationType.parse(PortletPropsValues.CALENDAR_NOTIFICATION_DEFAULT_TYPE);
      NotificationTemplateType notificationTemplateType=NotificationTemplateType.INVITE;
      if (existingCalendarBookingIds.contains(childCalendarBooking.getCalendarId())) {
        notificationTemplateType=NotificationTemplateType.UPDATE;
      }
      NotificationUtil.notifyCalendarBookingRecipients(childCalendarBooking,notificationType,notificationTemplateType,serviceContext);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn(e,e);
      }
    }
  }
}
