{
  PortletConfig portletConfig=getPortletConfig();
  PortletContext portletContext=getPortletContext();
  if (language.equals("javascript")) {
    try {
      Context context=Context.enter();
      Scriptable scope=context.initStandardObjects();
      BeanDeclarator.declareRhinoBeans(scope,portletConfig,portletContext,portletRequest,portletResponse);
      context.evaluateString(scope,script,"javascript script",1,null);
    }
  finally {
      Context.exit();
    }
  }
 else {
    BeanDeclarator.declareBSFBeans(bsfManager,portletConfig,portletContext,portletRequest,portletResponse);
    ScriptingLanguageInfo selectedLanguageInfo=(ScriptingLanguageInfo)ConfigurationActionImpl.getSupportedLanguagesInfo().get(language);
    BSFManager.registerScriptingEngine(language,selectedLanguageInfo.getScriptingEngineClassName(),new String[]{selectedLanguageInfo.getScriptingEngineExtension()});
    bsfManager.exec(language,language + " script",0,0,script);
  }
}
