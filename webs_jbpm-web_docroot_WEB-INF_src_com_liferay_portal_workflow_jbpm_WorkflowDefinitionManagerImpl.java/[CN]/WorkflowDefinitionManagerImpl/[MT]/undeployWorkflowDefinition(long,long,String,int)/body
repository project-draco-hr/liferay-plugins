{
  JbpmContext jbpmContext=_jbpmConfiguration.createJbpmContext();
  try {
    GraphSession graphSession=jbpmContext.getGraphSession();
    ProcessDefinition processDefinition=graphSession.findProcessDefinition(name,version);
    if (processDefinition != null) {
      List<ProcessInstance> processInstances=graphSession.findProcessInstances(processDefinition.getId());
      for (      ProcessInstance processInstance : processInstances) {
        if (!processInstance.hasEnded()) {
          throw new WorkflowException("Process instance " + processInstance.getId() + " is required");
        }
      }
      CustomSession customSession=new CustomSession(jbpmContext);
      customSession.deleteWorkflowDefinitionStatus(processDefinition.getId());
      graphSession.deleteProcessDefinition(processDefinition);
    }
  }
  finally {
    jbpmContext.close();
  }
}
