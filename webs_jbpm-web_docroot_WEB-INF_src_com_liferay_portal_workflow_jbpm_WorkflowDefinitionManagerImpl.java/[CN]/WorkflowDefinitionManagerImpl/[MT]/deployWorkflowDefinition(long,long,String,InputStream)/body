{
  ProcessDefinition processDefinition=null;
  ZipInputStream processStream=new ZipInputStream(inputStream);
  try {
    ProcessArchive processArchive=new ProcessArchive(processStream);
    processDefinition=processArchive.parseProcessDefinition();
  }
 catch (  IOException ioe) {
    throw new WorkflowException(ioe);
  }
catch (  JpdlException jpdle) {
    throw new WorkflowDefinitionFileException(jpdle);
  }
 finally {
    try {
      processStream.close();
    }
 catch (    IOException ioe) {
    }
  }
  if (Validator.isNotNull(name)) {
    processDefinition.setName(name);
  }
  JbpmContext jbpmContext=_jbpmConfiguration.createJbpmContext();
  try {
    jbpmContext.deployProcessDefinition(processDefinition);
    WorkflowDefinitionStatusImpl wfDefinitionStatus=new WorkflowDefinitionStatusImpl(true,processDefinition);
    jbpmContext.getSession().save(wfDefinitionStatus);
  }
  finally {
    jbpmContext.close();
  }
  return new WorkflowDefinitionImpl(processDefinition,true);
}
