{
  ProcessDefinition processDefinition=null;
  ZipInputStream processStream=new ZipInputStream(inputStream);
  try {
    ProcessArchive processArchive=new ProcessArchive(processStream);
    processDefinition=processArchive.parseProcessDefinition();
  }
 catch (  IOException ioe) {
    throw new WorkflowException(ioe);
  }
catch (  JpdlException jpdle) {
    throw new WorkflowDefinitionFileException(jpdle);
  }
 finally {
    try {
      processStream.close();
    }
 catch (    IOException ioe) {
    }
  }
  JbpmContext jbpmContext=_jbpmConfiguration.createJbpmContext();
  try {
    jbpmContext.deployProcessDefinition(processDefinition);
    WorkflowDefinitionStatusImpl workflowDefinitionStatus=new WorkflowDefinitionStatusImpl(processDefinition,true);
    Session session=jbpmContext.getSession();
    session.save(workflowDefinitionStatus);
  }
  finally {
    jbpmContext.close();
  }
  return new WorkflowDefinitionImpl(processDefinition,true);
}
