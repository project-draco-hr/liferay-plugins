{
  JbpmContext jbpmContext=_jbpmConfiguration.createJbpmContext();
  try {
    GraphSession graphSession=jbpmContext.getGraphSession();
    ProcessDefinition processDefinition=graphSession.findProcessDefinition(workflowDefinition.getName(),workflowDefinition.getVersion());
    if (processDefinition != null) {
      List<ProcessInstance> processInstances=graphSession.findProcessInstances(processDefinition.getId());
      for (      ProcessInstance processInstance : processInstances) {
        if (!processInstance.hasEnded()) {
          throw new WorkflowException("Process instance " + processInstance.getId() + " is required");
        }
      }
      graphSession.deleteProcessDefinition(processDefinition);
    }
  }
  finally {
    jbpmContext.close();
  }
}
