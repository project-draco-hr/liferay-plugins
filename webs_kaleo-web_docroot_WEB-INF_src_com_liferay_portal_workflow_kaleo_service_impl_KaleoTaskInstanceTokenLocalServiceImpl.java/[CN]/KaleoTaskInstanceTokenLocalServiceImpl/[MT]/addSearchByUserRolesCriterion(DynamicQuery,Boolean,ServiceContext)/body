{
  if (searchByUserRoles == null) {
    return;
  }
  if (!searchByUserRoles) {
    dynamicQuery.add(PropertyFactoryUtil.forName("assigneeClassName").eq(User.class.getName()));
    dynamicQuery.add(PropertyFactoryUtil.forName("assigneeClassPK").eq(serviceContext.getUserId()));
    return;
  }
  List<Long> roleIds=RoleRetrievalUtil.getRoleIds(serviceContext);
  List<UserGroupRole> userGroupRoles=UserGroupRoleLocalServiceUtil.getUserGroupRoles(serviceContext.getUserId());
  if (userGroupRoles.isEmpty()) {
    dynamicQuery.add(PropertyFactoryUtil.forName("assigneeClassName").eq(Role.class.getName()));
    dynamicQuery.add(PropertyFactoryUtil.forName("assigneeClassPK").in(roleIds.toArray(new Long[roleIds.size()])));
  }
 else {
    Junction junction=RestrictionsFactoryUtil.disjunction();
    junction.add(RestrictionsFactoryUtil.and(PropertyFactoryUtil.forName("assigneeClassName").eq(Role.class.getName()),PropertyFactoryUtil.forName("assigneeClassPK").in(roleIds.toArray(new Long[roleIds.size()]))));
    for (    UserGroupRole userGroupRole : userGroupRoles) {
      junction.add(RestrictionsFactoryUtil.and(PropertyFactoryUtil.forName("groupId").eq(userGroupRole.getGroupId()),RestrictionsFactoryUtil.and(PropertyFactoryUtil.forName("assigneeClassName").eq(Role.class.getName()),PropertyFactoryUtil.forName("assigneeClassPK").eq(userGroupRole.getRoleId()))));
    }
    dynamicQuery.add(junction);
  }
}
