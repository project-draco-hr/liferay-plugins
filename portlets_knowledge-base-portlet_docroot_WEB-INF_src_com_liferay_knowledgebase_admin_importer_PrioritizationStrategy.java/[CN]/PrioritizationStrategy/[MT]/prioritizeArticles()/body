{
  if (_prioritizeUpdatedArticles) {
    _initNonImportedArticles();
  }
 else {
    _initNewArticles();
  }
  if (_prioritizeByNumericalPrefix) {
    Set<String> importedKBArticleUrlTitles=_importedUrlTitlesPrioritiesMap.keySet();
    for (    String importedKBArticleUrlTitle : importedKBArticleUrlTitles) {
      KBArticle kbArticle=KBArticleLocalServiceUtil.getKBArticleByUrlTitle(_groupId,_parentKBFolderId,importedKBArticleUrlTitle);
      long resourcePrimKey=kbArticle.getResourcePrimKey();
      double priority=_importedUrlTitlesPrioritiesMap.get(importedKBArticleUrlTitle);
      KBArticleLocalServiceUtil.updatePriority(resourcePrimKey,priority);
      if (_importedParentArticles != null) {
        if (_importedParentArticles.contains(kbArticle)) {
          _importedParentArticles.remove(kbArticle);
        }
      }
      if (_importedParentUrlTitles != null) {
        if (_importedParentUrlTitles.contains(importedKBArticleUrlTitle)) {
          _importedParentUrlTitles.remove(importedKBArticleUrlTitle);
        }
      }
      if (_newParentArticles != null) {
        if (_newParentArticles.contains(kbArticle)) {
          _newParentArticles.remove(kbArticle);
        }
      }
      if (_newParentUrlTitles != null) {
        if (_newParentUrlTitles.contains(importedKBArticleUrlTitle)) {
          _newParentUrlTitles.remove(importedKBArticleUrlTitle);
        }
      }
      Set<String> parentKBArticleUrlTitles=_importedChildArticlesMap.keySet();
      for (      String parentKBArticleUrlTitle : parentKBArticleUrlTitles) {
        if (_importedChildArticlesMap != null) {
          List<KBArticle> importedChildKBArticles=_importedChildArticlesMap.get(parentKBArticleUrlTitle);
          if (importedChildKBArticles.contains(kbArticle)) {
            importedChildKBArticles.remove(kbArticle);
          }
          _importedChildArticlesMap.put(parentKBArticleUrlTitle,importedChildKBArticles);
        }
        if (_importedChildUrlTitlesMap != null) {
          List<String> importedChildKBArticlesUrlTitles=_importedChildUrlTitlesMap.get(parentKBArticleUrlTitle);
          if (importedChildKBArticlesUrlTitles.contains(importedKBArticleUrlTitle)) {
            importedChildKBArticlesUrlTitles.remove(importedKBArticleUrlTitle);
          }
          _importedChildUrlTitlesMap.put(parentKBArticleUrlTitle,importedChildKBArticlesUrlTitles);
        }
        if (_newChildArticlesMap != null) {
          List<KBArticle> newChildKBArticles=_newChildArticlesMap.get(parentKBArticleUrlTitle);
          if (newChildKBArticles == null) {
            continue;
          }
          if (newChildKBArticles.contains(kbArticle)) {
            newChildKBArticles.remove(kbArticle);
          }
          _newChildArticlesMap.put(parentKBArticleUrlTitle,newChildKBArticles);
        }
        if (_newChildUrlTitlesMap != null) {
          List<String> newChildKBArticleUrlTitles=_newChildUrlTitlesMap.get(parentKBArticleUrlTitle);
          if (newChildKBArticleUrlTitles == null) {
            continue;
          }
          if (newChildKBArticleUrlTitles.contains(importedKBArticleUrlTitle)) {
            newChildKBArticleUrlTitles.remove(importedKBArticleUrlTitle);
          }
          _newChildUrlTitlesMap.put(parentKBArticleUrlTitle,newChildKBArticleUrlTitles);
        }
      }
    }
  }
  KBArticleComparator comparator=new KBArticleComparator();
  if (_prioritizeUpdatedArticles) {
    double maxParentKBArticlePriority=0.0;
    Map<String,Double> maxChildKBArticlePriorityMap=new HashMap<String,Double>();
    for (    KBArticle parentKBArticle : _nonImportedParentArticles) {
      double parentKBArticlePriority=parentKBArticle.getPriority();
      if (parentKBArticlePriority > maxParentKBArticlePriority) {
        maxParentKBArticlePriority=parentKBArticlePriority;
      }
      String parentKBArticleUrlTitle=parentKBArticle.getUrlTitle();
      List<KBArticle> childKBArticles=_nonImportedChildArticlesMap.get(parentKBArticleUrlTitle);
      if (childKBArticles == null) {
        continue;
      }
      double maxChildKBArticlePriority=0.0;
      for (      KBArticle childArticle : childKBArticles) {
        double childKBArticlePriority=childArticle.getPriority();
        if (childKBArticlePriority > maxChildKBArticlePriority) {
          maxChildKBArticlePriority=childKBArticlePriority;
        }
      }
      maxChildKBArticlePriorityMap.put(parentKBArticleUrlTitle,maxChildKBArticlePriority);
    }
    ListUtil.sort(_importedParentUrlTitles);
    for (    String importedParentKBArticleUrlTitle : _importedParentUrlTitles) {
      KBArticle parentKBArticle=KBArticleLocalServiceUtil.getKBArticleByUrlTitle(_groupId,_parentKBFolderId,importedParentKBArticleUrlTitle);
      long parentResourcePrimKey=parentKBArticle.getResourcePrimKey();
      maxParentKBArticlePriority++;
      KBArticleLocalServiceUtil.updatePriority(parentResourcePrimKey,maxParentKBArticlePriority);
    }
    Set<String> parentKBArticleUrlTitles=_importedChildArticlesMap.keySet();
    for (    String parentKBArticleUrlTitle : parentKBArticleUrlTitles) {
      List<KBArticle> childKBArticles=_importedChildArticlesMap.get(parentKBArticleUrlTitle);
      if (childKBArticles != null) {
        ListUtil.sort(childKBArticles,comparator);
        int childSize=childKBArticles.size();
        for (int i=0; i < childSize; i++) {
          KBArticle childKBArticle=childKBArticles.get(i);
          long childKBArticleResourcePrimKey=childKBArticle.getResourcePrimKey();
          Double maxChildKBArticlePriority=maxChildKBArticlePriorityMap.get(parentKBArticleUrlTitle);
          if (maxChildKBArticlePriority == null) {
            maxChildKBArticlePriority=0.0;
          }
          KBArticleLocalServiceUtil.updatePriority(childKBArticleResourcePrimKey,maxChildKBArticlePriority + 1 + i);
        }
      }
    }
  }
 else {
    double maxParentPriority=0.0;
    Map<String,Double> maxChildPriorityMap=new HashMap<String,Double>();
    for (    KBArticle parentArticle : _existingParentArticles) {
      double parentPriority=parentArticle.getPriority();
      if (parentPriority > maxParentPriority) {
        maxParentPriority=parentPriority;
      }
      String parentUrlTitle=parentArticle.getUrlTitle();
      List<KBArticle> childArticles=_existingChildArticlesMap.get(parentUrlTitle);
      double maxChildPriority=0.0;
      for (      KBArticle childArticle : childArticles) {
        double childPriority=childArticle.getPriority();
        if (childPriority > maxChildPriority) {
          maxChildPriority=childPriority;
        }
      }
      maxChildPriorityMap.put(parentUrlTitle,maxChildPriority);
    }
    ListUtil.sort(_newParentUrlTitles);
    int parentSize=_newParentUrlTitles.size();
    for (int i=0; i < parentSize; i++) {
      KBArticle parentArticle=KBArticleLocalServiceUtil.getKBArticleByUrlTitle(_groupId,_parentKBFolderId,_newParentUrlTitles.get(i));
      long parentResourcePrimKey=parentArticle.getResourcePrimKey();
      KBArticleLocalServiceUtil.updatePriority(parentResourcePrimKey,maxParentPriority + 1 + i);
    }
    Set<String> childKeySet=_newChildArticlesMap.keySet();
    for (    String childKey : childKeySet) {
      List<KBArticle> childArticles=_newChildArticlesMap.get(childKey);
      if (childArticles != null) {
        ListUtil.sort(childArticles,comparator);
        int childSize=childArticles.size();
        for (int i=0; i < childSize; i++) {
          KBArticle childArticle=childArticles.get(i);
          long childArticleResourcePrimKey=childArticle.getResourcePrimKey();
          Double maxChildArticlePriority=maxChildPriorityMap.get(childKey);
          if (maxChildArticlePriority == null) {
            maxChildArticlePriority=0.0;
          }
          KBArticleLocalServiceUtil.updatePriority(childArticleResourcePrimKey,maxChildArticlePriority + 1 + i);
        }
      }
    }
  }
}
