{
  String content=HtmlUtil.escape(microblogsEntry.getContent());
  ThemeDisplay themeDisplay=serviceContext.getThemeDisplay();
  Matcher matcher=_tagPattern1.matcher(microblogsEntry.getContent());
  while (matcher.find()) {
    String result=matcher.group();
    StringBuilder sb=new StringBuilder(5);
    sb.append("<a href=\"");
    PortletURL portletURL=null;
    Group group=GroupLocalServiceUtil.getUserGroup(themeDisplay.getCompanyId(),themeDisplay.getUserId());
    long portletPlid=PortalUtil.getPlidFromPortletId(group.getGroupId(),true,"1_WAR_microblogsportlet");
    if (portletPlid != 0) {
      portletURL=PortletURLFactoryUtil.create(serviceContext.getLiferayPortletRequest(),"1_WAR_microblogsportlet",portletPlid,PortletRequest.RENDER_PHASE);
      try {
        portletURL.setWindowState(LiferayWindowState.NORMAL);
      }
 catch (      WindowStateException wse) {
      }
    }
 else {
      LiferayPortletResponse liferayPortletResponse=serviceContext.getLiferayPortletResponse();
      portletURL=liferayPortletResponse.createRenderURL("1_WAR_microblogsportlet");
      try {
        portletURL.setWindowState(WindowState.MAXIMIZED);
      }
 catch (      WindowStateException wse) {
      }
    }
    portletURL.setParameter("mvcPath","/microblogs/view.jsp");
    String assetTagName=result.substring(1);
    portletURL.setParameter("tabs1",assetTagName);
    portletURL.setParameter("assetTagName",assetTagName);
    sb.append(portletURL);
    sb.append("\">");
    sb.append(assetTagName);
    sb.append("</a>");
    String tagLink=sb.toString();
    content=StringUtil.replace(content,result,tagLink);
  }
  matcher=_tagPattern2.matcher(content);
  while (matcher.find()) {
    String result=matcher.group();
    try {
      StringBuilder sb=new StringBuilder(5);
      sb.append("<a href=\"");
      String assetTagScreenName=result.replace("[@",StringPool.BLANK);
      assetTagScreenName=assetTagScreenName.replace("]",StringPool.BLANK);
      User assetTagUser=UserLocalServiceUtil.getUserByScreenName(microblogsEntry.getCompanyId(),assetTagScreenName);
      sb.append(assetTagUser.getDisplayURL(themeDisplay));
      sb.append("\">");
      String assetTagUserName=PortalUtil.getUserName(assetTagUser.getUserId(),assetTagScreenName);
      sb.append(assetTagUserName);
      sb.append("</a>");
      String userLink=sb.toString();
      content=StringUtil.replace(content,result,userLink);
    }
 catch (    NoSuchUserException nsue) {
    }
  }
  return content;
}
