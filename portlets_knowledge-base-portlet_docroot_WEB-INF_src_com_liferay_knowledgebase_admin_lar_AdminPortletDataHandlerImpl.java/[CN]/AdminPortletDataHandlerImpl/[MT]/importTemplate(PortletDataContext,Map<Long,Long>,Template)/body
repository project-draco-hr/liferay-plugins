{
  long userId=portletDataContext.getUserId(template.getUserUuid());
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddCommunityPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  serviceContext.setCreateDate(template.getCreateDate());
  serviceContext.setModifiedDate(template.getModifiedDate());
  serviceContext.setScopeGroupId(portletDataContext.getScopeGroupId());
  Template importedTemplate=null;
  if (portletDataContext.isDataStrategyMirror()) {
    Template existingTemplate=TemplateUtil.fetchByUUID_G(template.getUuid(),portletDataContext.getScopeGroupId());
    if (existingTemplate == null) {
      serviceContext.setUuid(template.getUuid());
      importedTemplate=TemplateLocalServiceUtil.addTemplate(userId,template.getTitle(),template.getContent(),template.getDescription(),serviceContext);
    }
 else {
      importedTemplate=TemplateLocalServiceUtil.updateTemplate(existingTemplate.getTemplateId(),template.getTitle(),template.getContent(),template.getDescription(),serviceContext);
    }
  }
 else {
    importedTemplate=TemplateLocalServiceUtil.addTemplate(userId,template.getTitle(),template.getContent(),template.getDescription(),serviceContext);
  }
  templateIds.put(template.getTemplateId(),importedTemplate.getTemplateId());
  portletDataContext.importPermissions(Template.class,template.getTemplateId(),importedTemplate.getTemplateId());
}
