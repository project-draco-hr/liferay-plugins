{
  long importId=CounterLocalServiceUtil.increment();
  Map<Long,Long> resourcePrimKeys=new HashMap<Long,Long>();
  Map<String,String> dirNames=new HashMap<String,String>();
  try {
    if (context.getBooleanParameter(_NAMESPACE_ARTICLE,"attachments")) {
      DLServiceUtil.addDirectory(context.getCompanyId(),CompanyConstants.SYSTEM,"knowledgebase/temp/import/" + importId);
      importArticleAttachments(context,importId,dirNames,root);
    }
    for (    Element articleEl : root.elements("article")) {
      String path=articleEl.attributeValue("path");
      if (!context.isPathNotProcessed(path)) {
        continue;
      }
      Article article=(Article)context.getZipEntryAsObject(path);
      importArticle(context,resourcePrimKeys,dirNames,articleEl,article);
    }
  }
  finally {
    if (context.getBooleanParameter(_NAMESPACE_ARTICLE,"attachments")) {
      DLServiceUtil.deleteDirectory(context.getCompanyId(),CompanyConstants.SYSTEM_STRING,CompanyConstants.SYSTEM,"knowledgebase/temp/import/" + importId);
    }
  }
}
