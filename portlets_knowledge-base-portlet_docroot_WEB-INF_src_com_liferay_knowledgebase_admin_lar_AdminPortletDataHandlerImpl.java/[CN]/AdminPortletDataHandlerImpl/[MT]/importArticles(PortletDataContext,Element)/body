{
  long importId=CounterLocalServiceUtil.increment();
  Map<Long,Long> resourcePrimKeys=new HashMap<Long,Long>();
  Map<String,String> dirNames=new HashMap<String,String>();
  try {
    if (context.getBooleanParameter(_NAMESPACE_ARTICLE,"attachments")) {
      DLLocalServiceUtil.addDirectory(context.getCompanyId(),CompanyConstants.SYSTEM,"knowledgebase/temp/import/" + importId);
      importArticleAttachments(context,importId,dirNames,rootElement);
    }
    for (    Element articleElement : rootElement.elements("article")) {
      String path=articleElement.attributeValue("path");
      if (!context.isPathNotProcessed(path)) {
        continue;
      }
      Article article=(Article)context.getZipEntryAsObject(path);
      importArticle(context,resourcePrimKeys,dirNames,articleElement,article);
    }
    importComments(context,"article-comment",resourcePrimKeys,rootElement);
  }
  finally {
    if (context.getBooleanParameter(_NAMESPACE_ARTICLE,"attachments")) {
      DLLocalServiceUtil.deleteDirectory(context.getCompanyId(),CompanyConstants.SYSTEM_STRING,CompanyConstants.SYSTEM,"knowledgebase/temp/import/" + importId);
    }
  }
}
