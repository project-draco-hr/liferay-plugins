{
  long importId=CounterLocalServiceUtil.increment();
  Map<Long,Long> resourcePrimKeys=new HashMap<Long,Long>();
  Map<String,String> dirNames=new HashMap<String,String>();
  try {
    if (portletDataContext.getBooleanParameter(_NAMESPACE_ARTICLE,"attachments")) {
      DLLocalServiceUtil.addDirectory(portletDataContext.getCompanyId(),CompanyConstants.SYSTEM,"knowledgebase/temp/import/" + importId);
      importArticleAttachments(portletDataContext,importId,dirNames,rootElement);
    }
    List<Element> articleElements=rootElement.elements("article");
    for (int i=0; i < articleElements.size(); i++) {
      Element articleElement=articleElements.get(i);
      String path=articleElement.attributeValue("path");
      if (!portletDataContext.isPathNotProcessed(path)) {
        continue;
      }
      Article article=(Article)portletDataContext.getZipEntryAsObject(path);
      importArticle(portletDataContext,i + 1,resourcePrimKeys,dirNames,articleElement,article);
    }
    importComments(portletDataContext,"article-comment",resourcePrimKeys,rootElement);
  }
  finally {
    if (portletDataContext.getBooleanParameter(_NAMESPACE_ARTICLE,"attachments")) {
      DLLocalServiceUtil.deleteDirectory(portletDataContext.getCompanyId(),CompanyConstants.SYSTEM_STRING,CompanyConstants.SYSTEM,"knowledgebase/temp/import/" + importId);
    }
  }
}
