{
  Element versionsElement=kbArticleElement.element("versions");
  List<Element> kbArticleElements=versionsElement.elements("kb-article");
  KBArticle importedKBArticle=null;
  for (  Element curKBArticleElement : kbArticleElements) {
    KBArticle curKBArticle=(KBArticle)portletDataContext.getZipEntryAsObject(curKBArticleElement.attributeValue("path"));
    long userId=portletDataContext.getUserId(curKBArticle.getUserUuid());
    String curDirName=StringPool.BLANK;
    long[] curAssetCategoryIds=null;
    String[] curAssetTagNames=null;
    int index=kbArticleElements.indexOf(curKBArticleElement);
    if (index == (kbArticleElements.size() - 1)) {
      curDirName=dirName;
      curAssetCategoryIds=assetCategoryIds;
      curAssetTagNames=assetTagNames;
    }
    ServiceContext serviceContext=new ServiceContext();
    serviceContext.setAddCommunityPermissions(true);
    serviceContext.setAddGuestPermissions(true);
    serviceContext.setAssetCategoryIds(curAssetCategoryIds);
    serviceContext.setAssetTagNames(curAssetTagNames);
    serviceContext.setCreateDate(curKBArticle.getCreateDate());
    serviceContext.setModifiedDate(curKBArticle.getModifiedDate());
    serviceContext.setScopeGroupId(portletDataContext.getScopeGroupId());
    if (importedKBArticle == null) {
      serviceContext.setUuid(uuid);
      importedKBArticle=KBArticleLocalServiceUtil.addKBArticle(userId,parentResourcePrimKey,curKBArticle.getTitle(),curKBArticle.getContent(),curKBArticle.getDescription(),curDirName,serviceContext);
    }
 else {
      importedKBArticle=KBArticleLocalServiceUtil.updateKBArticle(userId,importedKBArticle.getResourcePrimKey(),curKBArticle.getTitle(),curKBArticle.getContent(),curKBArticle.getDescription(),curDirName,serviceContext);
    }
  }
  return importedKBArticle;
}
