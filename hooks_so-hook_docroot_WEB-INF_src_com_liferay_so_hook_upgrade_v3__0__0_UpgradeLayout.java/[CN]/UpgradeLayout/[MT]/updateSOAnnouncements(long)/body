{
  ActionableDynamicQuery actionableDynamicQuery=new LayoutActionableDynamicQuery(){
    @Override protected void performAction(    Object object) throws PortalException, SystemException {
      Layout layout=(Layout)object;
      if (!SocialOfficeServiceUtil.isSocialOfficeGroup(layout.getGroupId())) {
        return;
      }
      Group group=GroupLocalServiceUtil.fetchGroup(layout.getGroupId());
      if (layout.isPublicLayout() && group.isUser()) {
        return;
      }
      LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
      if (layoutTypePortlet.hasPortletId(PortletKeys.SO_ANNOUNCEMENTS)) {
        return;
      }
      UnicodeProperties typeSettingsProperties=layout.getTypeSettingsProperties();
      String columnProperty=StringPool.BLANK;
      if (layoutTypePortlet.hasPortletId(PortletKeys.ANNOUNCEMENTS)) {
        LayoutTemplate layoutTemplate=layoutTypePortlet.getLayoutTemplate();
        for (        String columnName : layoutTemplate.getColumns()) {
          columnProperty=typeSettingsProperties.getProperty(columnName);
          columnProperty=StringUtil.replace(columnProperty,PortletKeys.ANNOUNCEMENTS,PortletKeys.SO_ANNOUNCEMENTS);
          typeSettingsProperties.setProperty(columnName,columnProperty);
        }
        layout.setTypeSettingsProperties(typeSettingsProperties);
        LayoutLocalServiceUtil.updateLayout(layout);
      }
 else {
        columnProperty=typeSettingsProperties.getProperty("column-1");
        if (Validator.isNotNull(columnProperty)) {
          int columnPos=0;
          if (StringUtil.contains(columnProperty,PortletKeys.MICROBLOGS)) {
            columnPos=1;
          }
          layoutTypePortlet.addPortletId(0,PortletKeys.SO_ANNOUNCEMENTS,"column-1",columnPos,false);
          layout=layoutTypePortlet.getLayout();
          LayoutLocalServiceUtil.updateLayout(layout);
        }
      }
    }
  }
;
  actionableDynamicQuery.performActions();
}
