{
  long companyId=targetLayout.getCompanyId();
  LayoutLocalServiceUtil.updateLayout(targetLayout.getGroupId(),targetLayout.isPrivateLayout(),targetLayout.getLayoutId(),sourceLayout.getTypeSettings());
  LayoutTypePortlet sourceLayoutTypePortlet=(LayoutTypePortlet)sourceLayout.getLayoutType();
  List<Portlet> sourcePortlets=sourceLayoutTypePortlet.getAllPortlets();
  for (  Portlet sourcePortlet : sourcePortlets) {
    String sourcePortletId=sourcePortlet.getPortletId();
    PortletPreferencesLocalServiceUtil.getPreferences(companyId,PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,targetLayout.getPlid(),sourcePortletId);
    PortletPreferences sourcePreferences=PortletPreferencesLocalServiceUtil.getPreferences(companyId,PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,sourceLayout.getPlid(),sourcePortletId);
    PortletPreferencesLocalServiceUtil.updatePreferences(PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,targetLayout.getPlid(),sourcePortletId,sourcePreferences);
  }
}
