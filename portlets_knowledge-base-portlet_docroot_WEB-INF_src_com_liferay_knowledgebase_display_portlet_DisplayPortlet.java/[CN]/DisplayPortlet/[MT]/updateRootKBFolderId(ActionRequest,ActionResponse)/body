{
  long kbFolderId=ParamUtil.getLong(actionRequest,"rootKBFolderId");
  if (kbFolderId == KBFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    return;
  }
  KBFolder kbFolder=KBFolderServiceUtil.getKBFolder(kbFolderId);
  PortalPreferences portalPreferences=PortletPreferencesFactoryUtil.getPortalPreferences(PortalUtil.getLiferayPortletRequest(actionRequest));
  portalPreferences.setValue(PortletKeys.KNOWLEDGE_BASE_DISPLAY,"preferredKBFolderUrlTitle",kbFolder.getUrlTitle());
  String urlTitle=ParamUtil.getString(actionRequest,"urlTitle");
  if (Validator.isNotNull(urlTitle)) {
    KBArticle kbArticle=KBArticleLocalServiceUtil.fetchKBArticleByUrlTitle(kbFolder.getGroupId(),kbFolder.getUrlTitle(),urlTitle);
    ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
    if ((kbArticle != null) && KBArticlePermission.contains(themeDisplay.getPermissionChecker(),kbArticle,ActionKeys.VIEW)) {
      actionResponse.setRenderParameter("kbFolderUrlTitle",kbFolder.getUrlTitle());
      actionResponse.setRenderParameter("urlTitle",urlTitle);
    }
  }
}
