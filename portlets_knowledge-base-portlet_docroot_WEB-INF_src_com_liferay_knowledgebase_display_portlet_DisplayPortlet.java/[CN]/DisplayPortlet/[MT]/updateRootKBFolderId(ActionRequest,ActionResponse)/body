{
  long kbFolderId=ParamUtil.getLong(actionRequest,"rootKBFolderId");
  if (kbFolderId == KBFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    return;
  }
  KBFolder kbFolder=KBFolderServiceUtil.getKBFolder(kbFolderId);
  PortalPreferences portalPreferences=PortletPreferencesFactoryUtil.getPortalPreferences(PortalUtil.getLiferayPortletRequest(actionRequest));
  PortletPreferences portletPreferences=actionRequest.getPreferences();
  String contentRootPrefix=GetterUtil.getString(portletPreferences.getValue("contentRootPrefix",null));
  String previousPreferredKBFolderURLTitle=KnowledgeBaseUtil.getPreferredKBFolderURLTitle(portalPreferences,contentRootPrefix);
  KnowledgeBaseUtil.setPreferredKBFolderURLTitle(portalPreferences,contentRootPrefix,kbFolder.getUrlTitle());
  String urlTitle=ParamUtil.getString(actionRequest,"urlTitle");
  if (Validator.isNull(urlTitle)) {
    return;
  }
  KBArticle kbArticle=KBArticleLocalServiceUtil.fetchKBArticleByUrlTitle(kbFolder.getGroupId(),kbFolder.getUrlTitle(),urlTitle);
  if (kbArticle == null) {
    if (Validator.isNull(previousPreferredKBFolderURLTitle)) {
      return;
    }
    kbArticle=_findClosestMatchingKBArticle(kbFolder.getGroupId(),previousPreferredKBFolderURLTitle,kbFolder.getUrlTitle(),urlTitle);
    if (kbArticle == null) {
      return;
    }
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  if (!KBArticlePermission.contains(themeDisplay.getPermissionChecker(),kbArticle,ActionKeys.VIEW)) {
    return;
  }
  PortletURL redirectURL=PortletURLFactoryUtil.create(actionRequest,PortletKeys.KNOWLEDGE_BASE_DISPLAY,themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
  redirectURL.setParameter("kbFolderUrlTitle",kbFolder.getUrlTitle());
  redirectURL.setParameter("urlTitle",kbArticle.getUrlTitle());
  actionResponse.sendRedirect(redirectURL.toString());
}
