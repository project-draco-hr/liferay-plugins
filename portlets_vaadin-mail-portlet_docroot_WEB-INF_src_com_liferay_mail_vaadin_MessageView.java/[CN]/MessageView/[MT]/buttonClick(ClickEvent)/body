{
  Button b=event.getButton();
  Object data=b.getData();
  if (data != null && data instanceof Attachment) {
    final Attachment attachment=(Attachment)data;
    try {
      final AttachmentHandler handler=Controller.get().getMailManager().getAttachment(attachment.getAttachmentId());
      StreamResource r=new StreamResource(new StreamResource.StreamSource(){
        public InputStream getStream(){
          return handler.getInputStream();
        }
      }
,attachment.getFileName(),Controller.get().getApplication());
      String contentType=MimeTypesUtil.getContentType(attachment.getFileName());
      r.setMIMEType(contentType);
      Controller.get().getApplication().getMainWindow().open(r);
    }
 catch (    PortalException e) {
      Controller.get().showError(Lang.get("unable-to-fetch-attachment"),e);
    }
catch (    SystemException e) {
      Controller.get().showError(Lang.get("unable-to-fetch-attachment"),e);
    }
catch (    IOException e) {
      Controller.get().showError(Lang.get("unable-to-fetch-attachment"),e);
    }
  }
}
