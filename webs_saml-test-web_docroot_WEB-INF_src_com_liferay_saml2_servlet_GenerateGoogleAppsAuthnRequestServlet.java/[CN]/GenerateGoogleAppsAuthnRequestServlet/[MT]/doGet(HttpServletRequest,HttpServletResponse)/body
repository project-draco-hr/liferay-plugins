{
  String authnRequestId=OpenSAMLUtil.generateIdentifier();
  DateTime issueInstant=new DateTime();
  Issuer issuer=OpenSAMLUtil.buildIssuer(PropsValues.GOOGLE_APPS_ISSUER);
  AuthnRequest authnRequest=OpenSAMLUtil.buildAuthnRequest();
  authnRequest.setID(authnRequestId);
  authnRequest.setIssueInstant(issueInstant);
  authnRequest.setIssuer(issuer);
  authnRequest.setAssertionConsumerServiceURL(PropsValues.GOOGLE_APPS_ACS_URL);
  authnRequest.setIsPassive(Boolean.valueOf(PropsValues.SAML_SP_AUTHN_REQUEST_PASSIVE));
  authnRequest.setForceAuthn(Boolean.FALSE);
  Endpoint endpoint=OpenSAMLUtil.buildEndpoint(SAMLConstants.SAML2_REDIRECT_BINDING_URI,PropsValues.SAML_IDP_SSO_URL);
  SAMLMessageContext<SAMLObject,AuthnRequest,NameID> context=new BasicSAMLMessageContext<SAMLObject,AuthnRequest,NameID>();
  context.setPeerEntityEndpoint(endpoint);
  context.setOutboundSAMLMessage(authnRequest);
  context.setOutboundMessageTransport(new HttpServletResponseAdapter(response,request.isSecure()));
  context.setRelayState(PropsValues.GOOGLE_APPS_RELAY_STATE_URL);
  HTTPRedirectDeflateEncoder encoder=new HTTPRedirectDeflateEncoder();
  try {
    encoder.encode(context);
  }
 catch (  MessageEncodingException e) {
    throw new ServletException(e);
  }
}
