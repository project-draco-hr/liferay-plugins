{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  KBArticle article=(KBArticle)request.getAttribute(KnowledgeBaseKeys.ARTICLE);
  long userId=themeDisplay.getUserId();
  KBFeedbackEntry feedbackEntry=null;
  KBFeedbackStats feedbackStats=null;
  if (article != null) {
    try {
      feedbackEntry=KBFeedbackEntryLocalServiceUtil.getFeedbackEntry(article.getResourcePrimKey(),userId);
    }
 catch (    NoSuchFeedbackEntryException nsfee) {
      feedbackEntry=null;
    }
    feedbackStats=KBFeedbackStatsLocalServiceUtil.getArticleFeedbackStats(article.getResourcePrimKey());
  }
  request.setAttribute(KnowledgeBaseKeys.KNOWLEDGE_BASE_FEEDBACK_ENTRY,feedbackEntry);
  request.setAttribute(KnowledgeBaseKeys.KNOWLEDGE_BASE_FEEDBACK_STATS,feedbackStats);
}
