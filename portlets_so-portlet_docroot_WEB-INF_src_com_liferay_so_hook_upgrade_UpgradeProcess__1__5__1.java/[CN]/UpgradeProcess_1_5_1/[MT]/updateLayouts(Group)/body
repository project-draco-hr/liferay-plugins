{
  if (!group.isCommunity()) {
    return;
  }
  if ((group.getType() == GroupConstants.TYPE_COMMUNITY_PRIVATE) && group.hasPrivateLayouts()) {
    return;
  }
  if ((group.getType() == GroupConstants.TYPE_COMMUNITY_OPEN) && group.hasPublicLayouts()) {
    return;
  }
  long companyId=group.getCompanyId();
  boolean privateLayout=group.hasPrivateLayouts();
  List<Layout> layouts=LayoutLocalServiceUtil.getLayouts(group.getGroupId(),privateLayout);
  for (  Layout layout : layouts) {
    Layout targetLayout=LayoutLocalServiceUtil.addLayout(group.getCreatorUserId(),group.getGroupId(),!privateLayout,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID,layout.getName("en_US"),StringPool.BLANK,StringPool.BLANK,LayoutConstants.TYPE_PORTLET,false,layout.getFriendlyURL());
    LayoutLocalServiceUtil.updateLayout(targetLayout.getGroupId(),targetLayout.isPrivateLayout(),targetLayout.getLayoutId(),layout.getTypeSettings());
    LayoutTypePortlet sourceLayoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
    List<Portlet> sourcePortlets=sourceLayoutTypePortlet.getAllPortlets();
    for (    Portlet sourcePortlet : sourcePortlets) {
      String sourcePortletId=sourcePortlet.getPortletId();
      PortletPreferencesLocalServiceUtil.getPreferences(companyId,PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,targetLayout.getPlid(),sourcePortletId);
      PortletPreferences sourcePreferences=PortletPreferencesLocalServiceUtil.getPreferences(companyId,PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,layout.getPlid(),sourcePortletId);
      PortletPreferencesLocalServiceUtil.updatePreferences(PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,targetLayout.getPlid(),sourcePortletId,sourcePreferences);
    }
    LayoutLocalServiceUtil.deleteLayout(layout.getPlid());
  }
}
