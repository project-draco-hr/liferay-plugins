{
  int importedKBArticlesCount=0;
  PrioritizationStrategy strategy=PrioritizationStrategy.create(groupId,parentKBFolderId,prioritizeUpdatedArticles,prioritizeByNumericalPrefix);
  Map<String,Double> importedUrlTitlesPrioritiesMap=new HashMap<String,Double>();
  Map<String,List<String>> folderNameFileEntryNamesMap=getFolderNameFileEntryNamesMap(zipReader);
  Set<String> folderNames=folderNameFileEntryNamesMap.keySet();
  for (  String folderName : folderNames) {
    List<String> fileEntryNames=folderNameFileEntryNamesMap.get(folderName);
    String sectionIntroFileEntryName=null;
    List<String> sectionFileEntryNames=new ArrayList<>();
    for (    String fileEntryName : fileEntryNames) {
      if (fileEntryName.endsWith(PortletPropsValues.MARKDOWN_IMPORTER_ARTICLE_INTRO)) {
        sectionIntroFileEntryName=fileEntryName;
      }
 else {
        sectionFileEntryNames.add(fileEntryName);
      }
    }
    long parentResourceClassNameId=PortalUtil.getClassNameId(KBFolderConstants.getClassName());
    long parentResourcePrimaryKey=parentKBFolderId;
    long sectionResourceClassNameId=parentResourceClassNameId;
    long sectionResourcePrimaryKey=parentResourcePrimaryKey;
    if (Validator.isNotNull(sectionIntroFileEntryName)) {
      KBArticle sectionIntroKBArticle=addKBArticleMarkdown(userId,groupId,parentKBFolderId,sectionResourceClassNameId,sectionResourcePrimaryKey,zipReader.getEntryAsString(sectionIntroFileEntryName),sectionIntroFileEntryName,zipReader,metadata,serviceContext);
      strategy.addImportedParentArticle(sectionIntroKBArticle);
      if (prioritizeByNumericalPrefix) {
        double folderNamePrefix=_getNumericalPrefix(folderName);
        if (folderNamePrefix > 0) {
          importedUrlTitlesPrioritiesMap.put(sectionIntroKBArticle.getUrlTitle(),folderNamePrefix);
        }
      }
      sectionResourceClassNameId=PortalUtil.getClassNameId(KBArticleConstants.getClassName());
      sectionResourcePrimaryKey=sectionIntroKBArticle.getResourcePrimKey();
      importedKBArticlesCount++;
    }
    for (    String sectionFileEntryName : sectionFileEntryNames) {
      String sectionMarkdown=zipReader.getEntryAsString(sectionFileEntryName);
      if (Validator.isNull(sectionMarkdown)) {
        if (_log.isWarnEnabled()) {
          _log.warn("Missing Markdown in file entry " + sectionFileEntryName);
        }
      }
      KBArticle sectionKBArticle=addKBArticleMarkdown(userId,groupId,parentKBFolderId,sectionResourceClassNameId,sectionResourcePrimaryKey,sectionMarkdown,sectionFileEntryName,zipReader,metadata,serviceContext);
      if (prioritizeByNumericalPrefix) {
        double sectionFileEntryNamePrefix=_getNumericalPrefix(sectionFileEntryName);
        if (sectionFileEntryNamePrefix > 0) {
          importedUrlTitlesPrioritiesMap.put(sectionKBArticle.getUrlTitle(),sectionFileEntryNamePrefix);
        }
      }
      strategy.addImportedChildArticle(sectionKBArticle);
      importedKBArticlesCount++;
    }
  }
  strategy.addImportedUrlTitlesPriorities(importedUrlTitlesPrioritiesMap);
  strategy.prioritizeArticles();
  return importedKBArticlesCount;
}
