{
  KBArticle homeKBArticle=addKBArticleMarkdown(userId,groupId,KBArticleConstants.DEFAULT_PARENT_RESOURCE_PRIM_KEY,zipReader.getEntryAsString(PortletPropsValues.MARKDOWN_IMPORTER_ARTICLE_HOME),PortletPropsValues.MARKDOWN_IMPORTER_ARTICLE_HOME,fileEntriesMap,serviceContext);
  for (  String zipEntry : zipReader.getEntries()) {
    String extension=FileUtil.getExtension(zipEntry);
    if (!ArrayUtil.contains(PortletPropsValues.MARKDOWN_IMPORTER_ARTICLE_EXTENSIONS,StringPool.PERIOD.concat(extension)) || zipEntry.equals(PortletPropsValues.MARKDOWN_IMPORTER_ARTICLE_HOME)) {
      continue;
    }
    String folderName=zipEntry.substring(0,zipEntry.lastIndexOf(StringPool.SLASH));
    List<String> fileEntryNames=_folderNameFileEntryNamesMap.get(folderName);
    if (fileEntryNames == null) {
      fileEntryNames=new ArrayList<String>();
    }
    fileEntryNames.add(zipEntry);
    _folderNameFileEntryNamesMap.put(folderName,fileEntryNames);
  }
  Set<String> folderNames=_folderNameFileEntryNamesMap.keySet();
  for (  String folderName : folderNames) {
    List<String> fileEntryNames=_folderNameFileEntryNamesMap.get(folderName);
    String chapterIntroFileEntryName=null;
    List<String> chapterFileEntryNames=new ArrayList<String>();
    for (    String fileEntryName : fileEntryNames) {
      if (fileEntryName.endsWith(PortletPropsValues.MARKDOWN_IMPORTER_ARTICLE_INTRODUCTION) || fileEntryName.endsWith(PortletPropsValues.MARKDOWN_IMPORTER_ARTICLE_INTRO)) {
        chapterIntroFileEntryName=fileEntryName;
      }
 else {
        chapterFileEntryNames.add(fileEntryName);
      }
    }
    KBArticle chapterIntroKBArticle=addKBArticleMarkdown(userId,groupId,homeKBArticle.getResourcePrimKey(),zipReader.getEntryAsString(chapterIntroFileEntryName),chapterIntroFileEntryName,fileEntriesMap,serviceContext);
    for (    String chapterFileEntryName : chapterFileEntryNames) {
      String chapterMarkdown=zipReader.getEntryAsString(chapterFileEntryName);
      if (Validator.isNull(chapterMarkdown)) {
        if (_log.isWarnEnabled()) {
          _log.warn("Missing Markdown in file entry: " + chapterFileEntryName);
        }
      }
      addKBArticleMarkdown(userId,groupId,chapterIntroKBArticle.getResourcePrimKey(),chapterMarkdown,chapterFileEntryName,fileEntriesMap,serviceContext);
    }
  }
}
