{
  String keystoreType=_getProperty(companyId,PropsKeys.SAML_CREDENTIAL_KEYSTORE_TYPE);
  String keystoreFile=_getProperty(companyId,PropsKeys.SAML_CREDENTIAL_KEYSTORE_FILE);
  String keystorePassword=_getProperty(companyId,PropsKeys.SAML_CREDENTIAL_KEYSTORE_PASSWORD);
  try {
    KeyStore keystore=KeyStore.getInstance(keystoreType);
    InputStream keystoreStream=null;
    if (keystoreFile.startsWith("classpath:")) {
      String path=keystoreFile.substring(10);
      keystoreStream=SAMLMetadataUtil.class.getResourceAsStream(path);
    }
 else {
      keystoreStream=new FileInputStream(keystoreFile);
    }
    keystore.load(keystoreStream,keystorePassword.toCharArray());
    return keystore;
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
}
