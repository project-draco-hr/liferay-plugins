{
  String keystoreKeyAlias=_getProperty(companyId,PropsKeys.SAML_SP_METADATA_CREDENTIAL_ALIAS + "[" + entityId+ "]");
  String keystoreKeyPassword=_getProperty(companyId,PropsKeys.SAML_SP_METADATA_CREDENTIAL_PASSWORD + "[" + entityId+ "]");
  if (Validator.isNull(keystoreKeyAlias)) {
    keystoreKeyAlias=_getProperty(companyId,PropsKeys.SAML_IDP_CREDENTIAL_ALIAS);
    keystoreKeyPassword=_getProperty(companyId,PropsKeys.SAML_IDP_CREDENTIAL_PASSWORD);
  }
  if (Validator.isNull(keystoreKeyAlias)) {
    return null;
  }
  PublicKey publicKey=null;
  PrivateKey privateKey=null;
  try {
    KeyStore keystore=getKeyStore(companyId);
    privateKey=(PrivateKey)keystore.getKey(keystoreKeyAlias,keystoreKeyPassword.toCharArray());
    Certificate cert=keystore.getCertificate(keystoreKeyAlias);
    publicKey=cert.getPublicKey();
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
  return OpenSAMLUtil.getCredential(publicKey,privateKey);
}
