{
  try {
    KaleoTaskInstanceToken kaleoTaskInstanceToken=KaleoTaskInstanceTokenLocalServiceUtil.getKaleoTaskInstanceToken(workflowTaskInstanceId);
    KaleoTask kaleoTask=kaleoTaskInstanceToken.getKaleoTask();
    List<KaleoTaskAssignment> kaleoTaskAssignments=KaleoTaskAssignmentLocalServiceUtil.getKaleoTaskAssignments(kaleoTask.getKaleoTaskId(),Role.class.getName());
    PrimitiveLongSet pooledActors=new PrimitiveLongSet();
    for (    KaleoTaskAssignment kaleoTaskAssignment : kaleoTaskAssignments) {
      long roleId=kaleoTaskAssignment.getAssigneeClassPK();
      Role role=RoleLocalServiceUtil.getRole(roleId);
      if ((role.getType() == RoleConstants.TYPE_SITE) || (role.getType() == RoleConstants.TYPE_ORGANIZATION)) {
        long groupId=kaleoTaskInstanceToken.getGroupId();
        List<UserGroupRole> userGroupRoles=UserGroupRoleLocalServiceUtil.getUserGroupRolesByGroupAndRole(groupId,roleId);
        for (        UserGroupRole userGroupRole : userGroupRoles) {
          pooledActors.add(userGroupRole.getUserId());
        }
        List<UserGroupGroupRole> userGroupGroupRoles=UserGroupGroupRoleLocalServiceUtil.getUserGroupGroupRolesByGroupAndRole(groupId,roleId);
        for (        UserGroupGroupRole userGroupGroupRole : userGroupGroupRoles) {
          long userGroupId=userGroupGroupRole.getUserGroupId();
          List<User> userGroupUsers=UserLocalServiceUtil.getUserGroupUsers(userGroupId);
          for (          User user : userGroupUsers) {
            pooledActors.add(user.getUserId());
          }
        }
      }
 else {
        long[] userIds=UserLocalServiceUtil.getRoleUserIds(roleId);
        pooledActors.addAll(userIds);
      }
    }
    return pooledActors.getArray();
  }
 catch (  Exception e) {
    throw new WorkflowException(e);
  }
}
