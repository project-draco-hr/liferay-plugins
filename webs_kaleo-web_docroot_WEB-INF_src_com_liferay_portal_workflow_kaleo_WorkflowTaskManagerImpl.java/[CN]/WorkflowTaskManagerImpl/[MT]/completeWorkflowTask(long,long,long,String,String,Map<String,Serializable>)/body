{
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setCompanyId(companyId);
  serviceContext.setUserId(userId);
  WorkflowTaskAdapter workflowTaskAdapter=(WorkflowTaskAdapter)_taskManager.completeWorkflowTask(workflowTaskInstanceId,transitionName,comment,workflowContext,serviceContext);
  try {
    KaleoTaskInstanceToken kaleoTaskInstanceToken=workflowTaskAdapter.getKaleoTaskInstanceToken();
    KaleoInstanceToken kaleoInstanceToken=kaleoTaskInstanceToken.getKaleoInstanceToken();
    if (workflowContext == null) {
      workflowContext=WorkflowContextUtil.convert(kaleoInstanceToken.getKaleoInstance().getWorkflowContext());
    }
    workflowContext.put(WorkflowConstants.CONTEXT_TASK_COMMENTS,comment);
    workflowContext.put(WorkflowConstants.CONTEXT_TRANSITION_NAME,transitionName);
    ExecutionContext executionContext=new ExecutionContext(kaleoInstanceToken,workflowContext,serviceContext);
    _kaleoSignaler.signalExit(transitionName,executionContext);
  }
 catch (  Exception e) {
    throw new WorkflowException("Unable to complete task",e);
  }
  return workflowTaskAdapter;
}
