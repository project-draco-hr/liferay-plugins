{
  KaleoInstanceToken kaleoInstanceToken=executionContext.getKaleoInstanceToken();
  long groupId=kaleoInstanceToken.getGroupId();
  Group group=GroupLocalServiceUtil.getGroup(groupId);
  if (group.isLayout()) {
    group=GroupLocalServiceUtil.getGroup(group.getParentGroupId());
  }
  KaleoTaskAssignment defaultKaleoTaskAssignment=kaleoTask.getDefaultKaleoTaskAssignment();
  if (isValidAssignment(defaultKaleoTaskAssignment,group)) {
    return defaultKaleoTaskAssignment;
  }
 else {
    List<KaleoTaskAssignment> kaleoTaskAssignments=kaleoTask.getKaleoTaskAssignments();
    for (    KaleoTaskAssignment kaleoTaskAssignment : kaleoTaskAssignments) {
      if (isValidAssignment(kaleoTaskAssignment,group)) {
        return kaleoTaskAssignment;
      }
    }
  }
  throw new WorkflowException("Unable to select a valid assignment for task " + kaleoTask.getKaleoTaskId());
}
