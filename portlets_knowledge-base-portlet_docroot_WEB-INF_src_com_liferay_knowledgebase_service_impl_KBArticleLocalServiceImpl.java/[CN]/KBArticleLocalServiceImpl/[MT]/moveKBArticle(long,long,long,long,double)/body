{
  validate(priority);
  updatePermissionFields(resourcePrimKey,parentResourceClassNameId,parentResourcePrimKey);
  long kbFolderClassNameId=classNameLocalService.getClassNameId(KBFolderConstants.getClassName());
  long kbFolderId=KBFolderConstants.DEFAULT_PARENT_FOLDER_ID;
  if (parentResourceClassNameId == kbFolderClassNameId) {
    kbFolderId=parentResourceClassNameId;
  }
 else {
    KBArticle kbArticle=getLatestKBArticle(parentResourcePrimKey,WorkflowConstants.STATUS_ANY);
    kbFolderId=kbArticle.getKbFolderId();
  }
  List<KBArticle> kbArticles=getKBArticleVersions(resourcePrimKey,WorkflowConstants.STATUS_ANY,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new KBArticleVersionComparator());
  for (  KBArticle kbArticle : kbArticles) {
    kbArticle.setParentResourceClassNameId(parentResourceClassNameId);
    kbArticle.setParentResourcePrimKey(parentResourcePrimKey);
    if (parentResourceClassNameId == kbFolderClassNameId) {
      kbArticle.setKbFolderId(kbFolderId);
    }
    kbArticle.setPriority(priority);
    kbArticlePersistence.update(kbArticle);
  }
  if (parentResourceClassNameId == kbFolderClassNameId) {
    List<KBArticle> descendantKBArticles=getAllDescendantKBArticles(resourcePrimKey,WorkflowConstants.STATUS_ANY,null);
    for (    KBArticle kbArticle : descendantKBArticles) {
      List<KBArticle> kbArticleVersions=getKBArticleVersions(kbArticle.getResourcePrimKey(),WorkflowConstants.STATUS_ANY,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new KBArticleVersionComparator());
      for (      KBArticle kbArticleVersion : kbArticleVersions) {
        kbArticleVersion.setKbFolderId(kbFolderId);
        kbArticlePersistence.update(kbArticleVersion);
      }
    }
  }
  KBArticle kbArticle=getLatestKBArticle(resourcePrimKey,WorkflowConstants.STATUS_ANY);
  JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject();
  extraDataJSONObject.put("title",kbArticle.getTitle());
  if (kbArticle.isApproved() || !kbArticle.isFirstVersion()) {
    socialActivityLocalService.addActivity(userId,kbArticle.getGroupId(),KBArticle.class.getName(),resourcePrimKey,AdminActivityKeys.MOVE_KB_ARTICLE,extraDataJSONObject.toString(),0);
  }
}
