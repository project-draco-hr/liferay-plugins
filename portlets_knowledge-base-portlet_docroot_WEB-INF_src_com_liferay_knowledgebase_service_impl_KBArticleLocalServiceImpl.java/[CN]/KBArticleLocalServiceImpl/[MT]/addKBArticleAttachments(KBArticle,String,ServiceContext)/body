{
  try {
    DLStoreUtil.addDirectory(serviceContext.getCompanyId(),CompanyConstants.SYSTEM,kbArticle.getAttachmentsDirName());
  }
 catch (  DuplicateDirectoryException dde) {
    _log.error("Directory already exists for " + dde.getMessage());
  }
  if (Validator.isNull(dirName) || !DLStoreUtil.hasDirectory(serviceContext.getCompanyId(),CompanyConstants.SYSTEM,dirName)) {
    return;
  }
  String[] fileNames=DLStoreUtil.getFileNames(serviceContext.getCompanyId(),CompanyConstants.SYSTEM,dirName);
  for (  String fileName : fileNames) {
    InputStream inputStream=null;
    String attachmentsDirName=kbArticle.getAttachmentsDirName();
    String fullFileName=attachmentsDirName.concat(StringPool.SLASH).concat(FileUtil.getShortFileName(fileName));
    try {
      inputStream=DLStoreUtil.getFileAsStream(serviceContext.getCompanyId(),CompanyConstants.SYSTEM,fileName);
      if (!DLStoreUtil.hasDirectory(serviceContext.getCompanyId(),CompanyConstants.SYSTEM,dirName)) {
        DLStoreUtil.addDirectory(serviceContext.getCompanyId(),CompanyConstants.SYSTEM,dirName);
      }
      DLStoreUtil.addFile(serviceContext.getCompanyId(),CompanyConstants.SYSTEM,fullFileName,inputStream);
    }
 catch (    DuplicateFileException dfe) {
      _log.error("File already exists for " + dfe.getMessage());
    }
 finally {
      StreamUtil.cleanUp(inputStream);
    }
  }
  Ticket ticket=ticketLocalService.fetchTicket(StringUtil.extractLast(dirName,StringPool.SLASH));
  if (ticket != null) {
    ticketLocalService.deleteTicket(ticket);
  }
}
