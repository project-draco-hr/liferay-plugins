{
  FileEntry fileEntry=fileEntriesMap.get(fileName);
  if (fileEntry != null) {
    return fileEntry;
  }
  String mimeType=MimeTypesUtil.getContentType(fileName);
  try {
    PortletFileRepositoryUtil.getPortletFileEntry(kbArticle.getGroupId(),kbArticle.getAttachmentsFolderId(),fileName);
    PortletFileRepositoryUtil.deletePortletFileEntry(kbArticle.getGroupId(),kbArticle.getAttachmentsFolderId(),fileName);
  }
 catch (  NoSuchFileEntryException nsfee) {
  }
  fileEntry=PortletFileRepositoryUtil.addPortletFileEntry(kbArticle.getGroupId(),userId,KBArticle.class.getName(),kbArticle.getClassPK(),PortletKeys.KNOWLEDGE_BASE_ARTICLE,kbArticle.getAttachmentsFolderId(),inputStream,fileName,mimeType,false);
  fileEntriesMap.put(fileName,fileEntry);
  return fileEntry;
}
