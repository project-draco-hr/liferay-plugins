{
  String folderName=FileUtil.stripExtension(fileName);
  folderName=StringUtil.toLowerCase(folderName);
  Folder imagesFolder=null;
  try {
    KBArticleDLUtil.deleteFolder(folderName,serviceContext);
    imagesFolder=KBArticleDLUtil.addFolder(folderName,serviceContext);
  }
 catch (  Exception e) {
    throw new KBArticleImportException(e);
  }
  for (  String zipEntry : zipReader.getEntries()) {
    if (!zipEntry.contains(_IMAGES)) {
      continue;
    }
    String zipEntryLower=StringUtil.toLowerCase(zipEntry);
    try {
      validateImageFileExtension(zipEntryLower);
    }
 catch (    KBArticleImportException kbaie) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unsupported image file suffix used in ZIP file: " + zipEntry);
      }
      continue;
    }
    try {
      int pos=zipEntry.lastIndexOf(StringPool.SLASH);
      KBArticleDLUtil.addFile(imagesFolder,zipEntry.substring(pos + 1),zipReader.getEntryAsInputStream(zipEntry),fileEntriesMap,serviceContext);
    }
 catch (    Exception e) {
      StringBuilder sb=new StringBuilder(4);
      sb.append("Unable to import image file: ");
      sb.append(zipEntry);
      sb.append(". ");
      sb.append(e.getLocalizedMessage());
      throw new KBArticleImportException(sb.toString());
    }
  }
}
