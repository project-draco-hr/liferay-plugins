{
  String articleAttachments=getEmailArticleAttachments(locale);
  String articleVersion=LanguageUtil.format(locale,"version-x",String.valueOf(_article.getVersion()));
  String categoryTitle=LanguageUtil.get(locale,"category.kb");
  content=StringUtil.replace(content,new String[]{"[$ARTICLE_ATTACHMENTS$]","[$ARTICLE_VERSION$]","[$CATEGORY_TITLE$]"},new String[]{articleAttachments,articleVersion,categoryTitle});
  Subscription subscription=(Subscription)getContextAttribute("subscription");
  if (subscription == null) {
    return super.replaceContent(content,locale);
  }
  String[] portletPrimKeys=ExpandoValueLocalServiceUtil.getData(subscription.getCompanyId(),Subscription.class.getName(),"KB","portletPrimKeys",subscription.getSubscriptionId(),new String[0]);
  String portletPrimKeyPortletId=ArticleConstants.getPortletId(portletPrimKeys[0]);
  String articleURL=KnowledgeBaseUtil.getArticleURL(portletPrimKeyPortletId,_article.getResourcePrimKey(),_portalURL);
  String portletTitle=PortalUtil.getPortletTitle(portletPrimKeyPortletId,locale);
  content=StringUtil.replace(content,new String[]{"[$ARTICLE_URL$]","[$PORTLET_NAME$]"},new String[]{articleURL,portletTitle});
  return super.replaceContent(content,locale);
}
