{
  NodeBuilder nodeBuilder=NodeBuilder.nodeBuilder();
  settingsBuilder.loadFromClasspath(PortletPropsValues.ELASTICSEARCH_EMBEDDED_CONFIG_LOCATION);
  nodeBuilder.settings(settingsBuilder);
  nodeBuilder.clusterName(getClusterName());
  nodeBuilder.client(false);
  nodeBuilder.data(true);
  _node=nodeBuilder.node();
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
    _log.debug("Starting embedded elasticsearch cluster: " + getClusterName());
  }
  _node.start();
  Client client=_node.client();
  if (_log.isDebugEnabled()) {
    stopWatch.stop();
    _log.debug("Completed startup: " + getClusterName() + " in "+ stopWatch.getTime());
  }
  return client;
}
