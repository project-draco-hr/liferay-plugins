{
  NodeBuilder nodeBuilder=NodeBuilder.nodeBuilder();
  builder.loadFromClasspath(PortletPropsValues.ELASTICSEARCH_EMBEDDED_CONFIG_LOCATION);
  nodeBuilder.settings(builder);
  nodeBuilder.clusterName(getClusterName());
  nodeBuilder.client(false);
  nodeBuilder.data(true);
  _node=nodeBuilder.node();
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
    _log.debug("Starting embedded Elasticsearch cluster " + getClusterName());
  }
  _node.start();
  Client client=_node.client();
  if (_log.isDebugEnabled()) {
    stopWatch.stop();
    _log.debug("Finished starting " + getClusterName() + " in "+ stopWatch.getTime()+ " ms");
  }
  return client;
}
