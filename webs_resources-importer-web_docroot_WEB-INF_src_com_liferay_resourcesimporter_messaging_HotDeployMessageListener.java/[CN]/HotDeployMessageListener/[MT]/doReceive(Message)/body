{
  String command=message.getString("command");
  if (!command.equals("deploy")) {
    return;
  }
  String servletContextName=message.getString("servletContextName");
  ServletContext servletContext=ServletContextPool.get(servletContextName);
  File resourcesDir=new File(servletContext.getRealPath("/WEB-INF/classes/resources-importer"));
  if (!resourcesDir.exists()) {
    return;
  }
  String layoutSetPrototypeName=TextFormatter.format(servletContextName,TextFormatter.J);
  File larFile=new File(resourcesDir,"/archive.lar");
  List<Company> companies=CompanyLocalServiceUtil.getCompanies();
  for (  Company company : companies) {
    if (hasLayoutSetPrototype(company.getCompanyId(),layoutSetPrototypeName)) {
      if (_log.isInfoEnabled()) {
        _log.info("Layout set prototype already exists for company " + company.getWebId());
      }
      continue;
    }
    long companyId=CompanyThreadLocal.getCompanyId();
    try {
      CompanyThreadLocal.setCompanyId(company.getCompanyId());
      Importer importer=null;
      if (larFile.exists()) {
        LARImporter larImporter=getLARImporter();
        larImporter.setLARFile(larFile);
        importer=larImporter;
      }
 else {
        importer=getFileSystemImporter();
      }
      importer.setCompanyId(company.getCompanyId());
      Map<Locale,String> layoutSetPrototypeNameMap=new HashMap<Locale,String>();
      Locale locale=LocaleUtil.getDefault();
      layoutSetPrototypeNameMap.put(locale,layoutSetPrototypeName);
      importer.setLayoutSetPrototypeNameMap(layoutSetPrototypeNameMap);
      importer.setResourcesDir(resourcesDir);
      importer.setServletContextName(servletContextName);
      importer.afterPropertiesSet();
      if (_log.isInfoEnabled()) {
        _log.info("Importing resources from " + servletContextName + " to group "+ importer.getGroupId());
      }
      importer.importResources();
    }
  finally {
      CompanyThreadLocal.setCompanyId(companyId);
    }
  }
}
