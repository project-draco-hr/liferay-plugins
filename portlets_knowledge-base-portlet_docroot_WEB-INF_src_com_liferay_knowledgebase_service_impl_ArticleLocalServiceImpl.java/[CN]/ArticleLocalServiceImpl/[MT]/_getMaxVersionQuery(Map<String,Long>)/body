{
  DynamicQuery subSelect=DynamicQueryFactoryUtil.forClass(Article.class,"article2",PortletClassLoaderUtil.getClassLoader());
  subSelect.setProjection(PropertyFactoryUtil.forName("version").max());
  Property property1=PropertyFactoryUtil.forName("article1.resourcePrimKey");
  Property property2=PropertyFactoryUtil.forName("article2.resourcePrimKey");
  subSelect.add(property1.eqProperty(property2));
  DynamicQuery dynamicQuery=DynamicQueryFactoryUtil.forClass(Article.class,"article1",PortletClassLoaderUtil.getClassLoader());
  for (  Map.Entry<String,Long> entry : params.entrySet()) {
    Property property=PropertyFactoryUtil.forName(entry.getKey());
    dynamicQuery.add(property.eq(entry.getValue()));
  }
  dynamicQuery.add(PropertyFactoryUtil.forName("version").in(subSelect));
  return dynamicQuery;
}
