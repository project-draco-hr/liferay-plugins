{
  User user=userPersistence.findByPrimaryKey(userId);
  Article oldArticle=articlePersistence.findByResourcePrimKey_First(resourcePrimKey,new ArticleVersionComparator());
  validate(title,content);
  long articleId=counterLocalService.increment();
  Article article=articlePersistence.create(articleId);
  article.setResourcePrimKey(oldArticle.getResourcePrimKey());
  article.setGroupId(oldArticle.getGroupId());
  article.setCompanyId(oldArticle.getCompanyId());
  article.setUserId(user.getUserId());
  article.setUserName(user.getFullName());
  article.setCreateDate(oldArticle.getCreateDate());
  article.setModifiedDate(serviceContext.getModifiedDate(null));
  article.setParentResourcePrimKey(parentResourcePrimKey);
  article.setVersion(oldArticle.getVersion() + 1);
  article.setTitle(title);
  article.setContent(content);
  article.setDescription(description);
  article.setPriority(priority);
  articlePersistence.update(article,false);
  if ((serviceContext.getCommunityPermissions() != null) || (serviceContext.getGuestPermissions() != null)) {
    updateArticleResources(article,serviceContext.getCommunityPermissions(),serviceContext.getGuestPermissions());
  }
  updateDisplayOrder(article,parentResourcePrimKey,priority);
  updateAsset(userId,article,serviceContext.getAssetCategoryIds(),serviceContext.getAssetTagNames());
  socialActivityLocalService.addActivity(userId,article.getGroupId(),Article.class.getName(),resourcePrimKey,AdminActivityKeys.UPDATE_ARTICLE,StringPool.BLANK,0);
  Indexer indexer=IndexerRegistryUtil.getIndexer(Article.class);
  indexer.reindex(article);
  updateAttachments(article,dirName);
  notifySubscribers(article,true,serviceContext);
  return article;
}
