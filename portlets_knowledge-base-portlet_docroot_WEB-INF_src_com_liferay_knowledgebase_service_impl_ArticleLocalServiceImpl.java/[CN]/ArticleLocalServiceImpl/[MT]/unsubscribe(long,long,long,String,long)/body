{
  Subscription subscription=subscriptionLocalService.getSubscription(companyId,userId,Article.class.getName(),classPK);
  String[] portletPrimKeys=expandoValueLocalService.getData(companyId,Subscription.class.getName(),"KB","portletPrimKeys",subscription.getSubscriptionId(),new String[0]);
  String portletPrimKey=ArticleConstants.getPortletPrimKey(plid,portletId);
  portletPrimKeys=ArrayUtil.remove(portletPrimKeys,portletPrimKey);
  if (portletPrimKeys.length == 0) {
    subscriptionLocalService.deleteSubscription(subscription);
  }
  expandoValueLocalService.deleteValue(companyId,Subscription.class.getName(),"KB","portletPrimKeys",subscription.getSubscriptionId());
  if (portletPrimKeys.length == 0) {
    return;
  }
  expandoValueLocalService.addValue(companyId,Subscription.class.getName(),"KB","portletPrimKeys",subscription.getSubscriptionId(),portletPrimKeys);
}
