{
  long folderId=counterLocalService.increment();
  String dirName="knowledgebase/cache/attachments/" + folderId;
  DLServiceUtil.addDirectory(companyId,CompanyConstants.SYSTEM,dirName);
  String[] fileNames=DLServiceUtil.getFileNames(companyId,CompanyConstants.SYSTEM,"knowledgebase/cache/attachments");
  if (fileNames.length > 50) {
    Arrays.sort(fileNames);
    for (int i=0; i < fileNames.length - 50; i++) {
      DLServiceUtil.deleteDirectory(companyId,CompanyConstants.SYSTEM_STRING,CompanyConstants.SYSTEM,fileNames[i]);
    }
  }
  if (resourcePrimKey > 0) {
    Article article=articlePersistence.findByResourcePrimKey_First(resourcePrimKey,new ArticleVersionComparator());
    Date now=new Date();
    ServiceContext serviceContext=new ServiceContext();
    for (    String fileName : article.getAttachmentsFileNames()) {
      String shortFileName=FileUtil.getShortFileName(fileName);
      byte[] bytes=DLServiceUtil.getFile(article.getCompanyId(),CompanyConstants.SYSTEM,fileName);
      DLServiceUtil.addFile(companyId,CompanyConstants.SYSTEM_STRING,GroupConstants.DEFAULT_PARENT_GROUP_ID,CompanyConstants.SYSTEM,dirName + StringPool.SLASH + shortFileName,0,StringPool.BLANK,now,serviceContext,bytes);
    }
  }
  return dirName;
}
