{
  int vote=kbFeedbackEntry.getVote();
  int oldScore=kbFeedbackEntry.getScore();
  long articleId=kbFeedbackEntry.getArticleId();
  kbFeedbackEntryPersistence.remove(kbFeedbackEntry);
  KBFeedbackStats kbFeedbackStats=kbFeedbackStatsLocalService.getArticleKBFeedbackStats(articleId);
  int totalScoreEntries=kbFeedbackStats.getTotalScoreEntries();
  int totalVotes=kbFeedbackStats.getTotalVotes() - 1;
  int yesVotes=kbFeedbackStats.getYesVotes();
  double averageScore=0;
  double totalScore=kbFeedbackStats.getAverageScore() * totalScoreEntries;
  if (vote == 1) {
    yesVotes--;
  }
  if (oldScore != 0) {
    totalScoreEntries--;
  }
  if (totalScoreEntries > 0) {
    averageScore=(totalScore - oldScore) / totalScoreEntries;
  }
  kbFeedbackStats.setAverageScore(averageScore);
  kbFeedbackStats.setTotalScoreEntries(totalScoreEntries);
  kbFeedbackStats.setTotalVotes(totalVotes);
  kbFeedbackStats.setYesVotes(yesVotes);
  kbFeedbackStatsPersistence.update(kbFeedbackStats,false);
}
