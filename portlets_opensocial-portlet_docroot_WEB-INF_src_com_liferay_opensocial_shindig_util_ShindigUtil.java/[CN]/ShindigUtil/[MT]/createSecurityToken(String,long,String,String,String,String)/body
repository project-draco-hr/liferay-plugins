{
  String securityTokenType=_containerConfig.getString(ContainerConfig.DEFAULT_CONTAINER,"gadgets.securityTokenType");
  String viewerIdString=String.valueOf(viewerId);
  String securityToken=StringPool.BLANK;
  if (securityTokenType.equals("insecure")) {
    BasicSecurityToken basicSecurityToken=new BasicSecurityToken(ownerId,viewerIdString,appId,domain,appUrl,"0",ContainerConfig.DEFAULT_CONTAINER,activeUrl);
    securityToken=_basicSecurityTokenDecoder.encodeToken(basicSecurityToken);
  }
 else   if (securityTokenType.equals("secure")) {
    String securityTokenKeyPath=_containerConfig.getString(ContainerConfig.DEFAULT_CONTAINER,"gadgets.securityTokenKeyFile");
    File securityTokenKeyFile=new File(securityTokenKeyPath);
    BlobCrypter blobCrypter=new BasicBlobCrypter(securityTokenKeyFile);
    BlobCrypterSecurityToken blobCrypterSecurityToken=new BlobCrypterSecurityToken(blobCrypter,ContainerConfig.DEFAULT_CONTAINER,domain);
    blobCrypterSecurityToken.setOwnerId(ownerId);
    blobCrypterSecurityToken.setViewerId(viewerIdString);
    blobCrypterSecurityToken.setAppUrl(appUrl);
    blobCrypterSecurityToken.setModuleId(0);
    securityToken=blobCrypterSecurityToken.encrypt();
  }
  securityToken=HttpUtil.encodeURL(securityToken);
  return securityToken;
}
