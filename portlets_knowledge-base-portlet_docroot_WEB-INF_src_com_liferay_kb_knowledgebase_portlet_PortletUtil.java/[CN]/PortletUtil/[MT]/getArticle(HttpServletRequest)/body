{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  long plid=themeDisplay.getPlid();
  long userId=themeDisplay.getUserId();
  long resourcePrimKey=ParamUtil.getLong(request,"resourcePrimKey");
  double version=ParamUtil.getDouble(request,"version");
  String title=ParamUtil.getString(request,"title");
  KBArticle article=null;
  if (resourcePrimKey > 0) {
    article=KBArticleServiceUtil.getArticle(resourcePrimKey,version,plid);
  }
 else   if (Validator.isNotNull(title)) {
    try {
      article=KBArticleServiceUtil.getArticle(themeDisplay.getScopeGroupId(),title,version,plid);
    }
 catch (    NoSuchArticleException nsae) {
      int pos=title.lastIndexOf(StringPool.PERIOD);
      if (pos == -1) {
        throw nsae;
      }
      title=title.substring(0,pos);
      article=KBArticleServiceUtil.getArticle(themeDisplay.getScopeGroupId(),title,version,plid);
    }
  }
  KBFeedbackEntry feedbackEntry=null;
  KBFeedbackStats feedbackStats=null;
  if (article != null) {
    try {
      feedbackEntry=KBFeedbackEntryLocalServiceUtil.getFeedbackEntry(article.getResourcePrimKey(),userId);
    }
 catch (    NoSuchFeedbackEntryException nsfee) {
      feedbackEntry=null;
    }
    feedbackStats=KBFeedbackStatsLocalServiceUtil.getArticleFeedbackStats(article.getResourcePrimKey());
  }
  request.setAttribute(KnowledgeBaseKeys.ARTICLE,article);
  request.setAttribute(KnowledgeBaseKeys.FEEDBACK_ENTRY,feedbackEntry);
  request.setAttribute(KnowledgeBaseKeys.FEEDBACK_STATS,feedbackStats);
}
