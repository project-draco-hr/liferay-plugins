{
  PortletPreferences prefs=req.getPreferences();
  String portletHandle=prefs.getValue("portletHandle",StringPool.BLANK);
  String newPortletHandle=portletContext.getPortletHandle();
  if (!portletHandle.equals(newPortletHandle)) {
    try {
      prefs.setValue(newPortletHandle,portletHandle);
    }
 catch (    ReadOnlyException e) {
      _log.error(e.getMessage(),e);
    }
  }
  PortletSession ses=req.getPortletSession();
  ses.setAttribute("portletState",portletContext.getPortletState());
}
