{
  PortletPreferences prefs=req.getPreferences();
  long producerId=GetterUtil.getLong(prefs.getValue("producerId",StringPool.BLANK));
  if (producerId <= 0) {
    return null;
  }
  Producer producer=ProducerServiceUtil.getProducer(producerId);
  WSRPV2MarkupPortType markupService=ServiceFactory.createMarkupService(producer);
  ServiceDescription sd=ProducerModelUtil.getServiceDescription(producer);
  if (sd.getRequiresInitCookie() != CookieProtocol.NONE) {
    BindingProvider bindingProvider=(BindingProvider)markupService;
    bindingProvider.getRequestContext().put(BindingProvider.SESSION_MAINTAIN_PROPERTY,true);
    markupService.initCookie(new InitCookie());
  }
  return markupService;
}
