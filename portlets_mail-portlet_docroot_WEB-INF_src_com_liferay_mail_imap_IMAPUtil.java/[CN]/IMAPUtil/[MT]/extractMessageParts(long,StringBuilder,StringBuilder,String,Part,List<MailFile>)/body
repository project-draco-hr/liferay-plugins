{
  String contentType=messagePart.getContentType().toLowerCase();
  String filename=messagePart.getFileName();
  Object content=messagePart.getContent();
  if (content instanceof Multipart) {
    Multipart multipart=(Multipart)content;
    for (int i=0; i < multipart.getCount(); i++) {
      Part curPart=multipart.getBodyPart(i);
      extractMessageParts(userId,bodyPlain,bodyHtml,contentPath.concat(StringPool.PERIOD).concat(String.valueOf(i)),curPart,mailFiles);
    }
  }
 else   if (Validator.isNull(filename)) {
    if (contentType.startsWith(ContentTypes.TEXT_PLAIN)) {
      bodyPlain.append(content.toString().replaceAll("\r\n","<br />"));
    }
    if (contentType.startsWith(ContentTypes.TEXT_HTML)) {
      bodyHtml.append(HtmlContentUtil.getInlineHtml(content.toString()));
    }
    if (contentType.startsWith(ContentTypes.MESSAGE_RFC822)) {
    }
  }
 else {
    MailFile mailFile=new MailFile(contentPath.concat(StringPool.PERIOD).concat("-1"),filename,messagePart.getSize());
    mailFiles.add(mailFile);
  }
}
