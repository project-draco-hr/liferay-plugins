{
  long[] messageIds=new long[storedMessageIds.length];
  for (int i=0; i < storedMessageIds.length; i++) {
    com.liferay.mail.model.Message storedmessage=MessageLocalServiceUtil.getMessage(storedMessageIds[i]);
    messageIds[i]=storedmessage.getRemoteMessageId();
  }
  List<Message> messages=new ArrayList<javax.mail.Message>();
  Message[] messagesArray=imapFolder.getMessagesByUID(messageIds);
  for (int i=0; i < messagesArray.length; i++) {
    Message message=messagesArray[i];
    if (message != null) {
      messages.add(message);
    }
 else     if (deleteMissingMessages && (messageIds[i] != 0)) {
      MessageLocalServiceUtil.deleteMessage(storedMessageIds[i]);
    }
  }
  return messages;
}
