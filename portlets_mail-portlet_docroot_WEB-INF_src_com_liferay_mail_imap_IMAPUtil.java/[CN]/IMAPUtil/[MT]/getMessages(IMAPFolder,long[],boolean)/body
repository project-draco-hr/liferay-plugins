{
  long[] messageUIDs=new long[messageIds.length];
  for (int i=0; i < messageIds.length; i++) {
    Message storeMessage=MessageLocalServiceUtil.getMessage(messageIds[i]);
    messageUIDs[i]=storeMessage.getRemoteMessageId();
  }
  javax.mail.Message[] allMessages=imapFolder.getMessagesByUID(messageUIDs);
  List<javax.mail.Message> messages=new ArrayList<javax.mail.Message>();
  for (int i=0; i < allMessages.length; i++) {
    javax.mail.Message message=allMessages[i];
    if (message != null) {
      messages.add(message);
    }
 else     if (deleteMissingMessages && (messageUIDs[i] != 0)) {
      MessageLocalServiceUtil.deleteMessage(messageIds[i]);
    }
  }
  return messages;
}
