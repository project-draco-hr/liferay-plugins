{
  javax.mail.Message message=new MimeMessage(_connection.getSession());
  message.setFrom(new InternetAddress(sender,personalName));
  message.addRecipients(javax.mail.Message.RecipientType.TO,to);
  message.addRecipients(javax.mail.Message.RecipientType.CC,cc);
  message.addRecipients(javax.mail.Message.RecipientType.BCC,bcc);
  message.setSentDate(new Date());
  message.setSubject(subject);
  MimeMultipart multipart=new MimeMultipart();
  BodyPart messageBodyPart=new MimeBodyPart();
  messageBodyPart.setContent(body,ContentTypes.TEXT_HTML_UTF8);
  multipart.addBodyPart(messageBodyPart);
  if (mailFiles != null) {
    for (    MailFile mailFile : mailFiles) {
      File file=mailFile.getFile();
      String fileName=mailFile.getFileName();
      if (!file.exists()) {
        continue;
      }
      DataSource dataSource=new FileDataSource(file);
      BodyPart messageAttachmentPart=new MimeBodyPart();
      messageAttachmentPart.setDataHandler(new DataHandler(dataSource));
      messageAttachmentPart.setFileName(fileName);
      multipart.addBodyPart(messageAttachmentPart);
    }
  }
  message.setContent(multipart);
  return message;
}
