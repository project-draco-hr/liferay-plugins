{
  IMAPFolder sourceIMAPFolder=null;
  IMAPFolder destinationIMAPFolder=null;
  try {
    sourceIMAPFolder=openFolder(sourceStoredFolderId);
    sourceIMAPFolder.addMessageCountListener(new IMAPMessageCountListener(_user,_account));
    destinationIMAPFolder=openFolder(destinationStoredFolderId);
    destinationIMAPFolder.addMessageCountListener(new IMAPMessageCountListener(_user,_account));
    List<Message> messages=getMessages(sourceIMAPFolder,messageIds,deleteMissingMessages);
    for (    Message message : messages) {
      destinationIMAPFolder.appendMessages(new Message[]{message});
      message.setFlag(Flags.Flag.DELETED,true);
    }
  }
 catch (  MessagingException me) {
    throw new MailException(me);
  }
 finally {
    closeFolder(sourceIMAPFolder,true);
    closeFolder(destinationIMAPFolder,false);
  }
}
