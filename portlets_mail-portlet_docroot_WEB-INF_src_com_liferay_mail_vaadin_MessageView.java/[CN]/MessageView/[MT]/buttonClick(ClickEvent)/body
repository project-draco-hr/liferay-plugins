{
  Button b=event.getButton();
  Object data=b.getData();
  if (data != null && data instanceof Attachment) {
    final Attachment attachment=(Attachment)data;
    StreamResource r=new StreamResource(new StreamSource(){
      public InputStream getStream(){
        try {
          InputStream is=Controller.get().getMailManager().getAttachment(attachment.getAttachmentId());
          if (is.available() > 0) {
            return is;
          }
        }
 catch (        PortalException e) {
          Controller.get().showError(Lang.get("unable-to-fetch-attachment"),e);
        }
catch (        SystemException e) {
          Controller.get().showError(Lang.get("unable-to-fetch-attachment"),e);
        }
catch (        IOException e) {
          Controller.get().showError(Lang.get("unable-to-fetch-attachment"),e);
        }
        return null;
      }
    }
,attachment.getFileName(),Controller.get().getApplication());
    r.setMIMEType("application/octet-stream");
    if (r.getStream().getStream() != null) {
      Controller.get().getApplication().getMainWindow().open(r);
    }
 else {
      Controller.get().showError(Lang.get("unable-to-fetch-attachment"));
    }
  }
}
